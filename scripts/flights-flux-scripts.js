function getCommentNodes(a){var b=[];if(document.createTreeWalker)for(var c=document.createTreeWalker(a,NodeFilter.SHOW_COMMENT,{acceptNode:function(a){return NodeFilter.FILTER_ACCEPT}},!1);c.nextNode();)b.push(c.currentNode);return b}function collectComments(){if("undefined"!=TLT)for(var a=getCommentNodes(document),b=a.length,c=null,d=0;d<b;++d)c=a[d].nodeValue,c.indexOf("tlAbacusTest")!=-1&&(c=c.split(":")[1],TLT.logCustomEvent("AbacusTest",c))}function tealiumUdoListener(a){utag_data=a,require(["tealium-settings"],function(a){if("undefined"!=typeof a&&"true"===a.tealiumSafeFramesEnabled)require(["tealium-safeframe"],function(a){a.loadUtag(utag_data)});else if(window.utag)window.utag.view(utag_data);else if(!window.utag&&"undefined"!=typeof a){var b="//tags.tiqcdn.com/utag/expedia/"+a.tealiumProfilename+"/"+a.tealiumEnvironment+"/utag.js";"object"==typeof $LAB&&"function"==typeof $LAB.script?$LAB.script(b):!function(a,c,d,e){a=b,c=document,d="script",e=c.createElement(d),e.src=a,e.type="text/java"+d,e.async=!0,a=c.getElementsByTagName(d)[0],a.parentNode.insertBefore(e,a)}()}})}define("templates",["flights","handlebars","configuration","timestamp","operatedByStringBuilder","currency","underscore"],function(a,b,c,d,e,f,g){"use strict";var h={};return h.registerHelpers=function(){b.registerHelper("compressWhitespace",function(a){var b=a.fn(this);return b=b.replace(/>\s+/g,">"),b=b.replace(/\s+</g,"<")}),b.registerHelper("math",function(a,b,c){if("undefined"!=typeof a&&"undefined"!=typeof c&&"undefined"!=typeof b)switch(b){case"+":return a+c;case"*":return a*c;case"/":return a/c;case"-":return a-c;case"%":return a%c;default:return 0}return 0}),b.registerHelper("lookupProp",function(a,b,c){return a[b]&&a[b][c]}),b.registerHelper("if_contains",function(a,b,c){return a&&b&&a.indexOf(b)>-1?c.fn(this):c.inverse(this)}),b.registerHelper("if_and",function(a,b,c){return a&&b?c.fn(this):c.inverse(this)}),b.registerHelper("if_or",function(a,b,c){return a||b?c.fn(this):c.inverse(this)}),b.registerHelper("if_or4",function(a,b,c,d,e){return a||b||c||d?e.fn(this):e.inverse(this)}),b.registerHelper("if_nor",function(a,b,c){return a||b?c.inverse(this):c.fn(this)}),b.registerHelper("if_eq",function(a,b,c){return a===b&&!c.hash.useDoubleEquals||a==b&&!0===c.hash.useDoubleEquals?c.fn(this):c.inverse(this)}),b.registerHelper("if_neq",function(a,b,c){return a!==b?c.fn(this):c.inverse(this)}),b.registerHelper("if_gt",function(a,b,c){return a>b?c.fn(this):c.inverse(this)}),b.registerHelper("if_lt",function(a,b,c){return a<b?c.fn(this):c.inverse(this)}),b.registerHelper("debug",function(b){a.log("===================="),a.log("Current Context"),a.log(this),b&&(a.log("Value"),a.log(b)),a.log("====================")}),b.registerHelper("if_next_layover_exists",function(b,c,d){try{if(void 0!==b[c+1]&&b[c+1].layover||void 0!==b[c+1]&&void 0!==b[c+2]&&b[c+2].layover)return d.fn(this)}catch(b){a.log("if_next_layover_exists: FAILED "+b)}return d.inverse(this)}),b.registerHelper("bargainFareText",function(b,c){return a.ModuleBuilder.Controller.bargainFareText(b,c)}),b.registerHelper("formatPrice",function(e,g){f.init(c.flightPriceDecimalSeparator);var n,q,t,u,v,w,h=b.templates.formattedPrice,i=a.Currency.parsePrice(e),j=b.helpers.loc("views_default_controls_flight_searchresults_flux_offerstrings.addToPackagePrice"),k=b.helpers.loc("views_default_controls_flight_searchresults_flux_offerstrings.subtractFromPackagePrice"),l=b.helpers.stcs("com_expedia_www_domain_config_EarnRewardsGPSConfig_getEarnGiftCardText"),m=c.isFlexibleShoppingEnabled&&"fc"!=a.Model.Wizard.packageType,o=i.wholePart,p=g.hash.isPositiveDelta||!1,r=e.replace("-",""),s=k.replace("{0}",r).trim();return l&&(l=l.replace("{{earnRewards}}",g.hash.earnGPSRewards)),void 0!==i.prefix&&(o=i.prefix+o),p&&(s=j.replace("{0}",o)),void 0!==g.hash.points&&(h=b.templates.formattedPoints,t=g.hash.points,u=g.hash.isPointsAndOverage,v=g.hash.isPointsPerPerson,w="<span class=value>"+g.hash.points+"</span>"),void 0!==g.hash.deltaPrice&&(g.hash.useDeltaPrice=g.hash.deltaPrice>=0,g.hash.deltaPrice<0&&(i.prefix=i.prefix.replace("-","- "))),c.perceivedInstantEnabled&&(q=(new Date).getTime().toString(),n=d.generateViewedDateTimeMarkup(q,void 0!==g.hash.freshnessTime?g.hash.freshnessTime.toString():q,b.templates.freshnessFuzzyDateTimeTemplate)),h({isFlexibleShoppingEnabled:c.isFlexibleShoppingEnabled,displayTaxesAndFees:c.displayTaxesAndFees,earnGiftCardText:l,isRoundTrip:c.route.isRoundTrip,isOneWay:c.route.isOneWay,parsedPrice:i,showFromText:g.hash.showFromText||!1,hidePrice:g.hash.hidePrice||!1,fuzzyFreshnessTime:n,isMultiItemShoppingWithPackagePricing:m,dollarPriceText:g.hash.useDeltaPrice?"+ "+o:o,multiItemShoppingText:s,points:t,isPointsAndOverage:u,isPointsPerPerson:v,pointsMarkup:w,earnGPSRewards:g.hash.earnGPSRewards,earnRewardsLogoEnabled:c.earnRewardsLogoEnabled,showFreeCancellation:c.showFreeCancellationOnListings&&g.data.root.showFreeCancelForOffer})}),b.registerHelper("getListingsOperatedByText",function(a){var c=b.templates.fluxOperatedByTemplate;return c({formattedOperatedByString:e(a)})}),b.registerHelper("if_operatedBy",function(a,b){var c,e,d=a.length;for(c=0;c<d;c+=2)if(e=a[c].carrier,""!==e.operatedBy)return b.fn(this);return b.inverse(this)}),b.registerHelper("getTabDetailsTitle",function(a){var d=[b.helpers.loc("views_default_controls_flight_searchresults_flux_moduledetails.departure"),b.helpers.loc("views_default_controls_flight_searchresults_flux_moduledetails.return"),b.helpers.loc("views_default_controls_flight_searchresults_flux_moduledetails.tripTab")];return"number"!=typeof a?"":c.route.isMultiDest?d[2].replace(/{tripIndex}/i,a+1):d[a]}),b.registerHelper("replaceOBFeeMessagesLink",function(a,c,d,e){var f=b.helpers.loc(c,{},this),g=b.helpers.loc(d),h=b.helpers.uitk_icon({hash:{name:"popup",content:g}});return h=h.toString().replace(/\n/g,""),"url"===a?(f=f.replace("[a]",'<a href="'+e+'" target="_blank" rel="noopener noreferrer" data-click-handler="omnitureClickHandler" data-omniture-rfrr="OBFee.Details">'),f=f.replace("[/a]",h+"</a>")):"empty"===a?(f=f.replace("[a]",""),f=f.replace("[/a]","")):(f=f.replace("[a]",'<a href="javascript:void(0)" feetype="'+a+'" data-click-handler="additionalFeeLink">'),f=f.replace("[/a]",h+"</a>")),f}),b.registerHelper("concat",function(){var a,b="";for(a=0;a<arguments.length;a++)"object"!=typeof arguments[a]&&(b+=arguments[a]);return b}),b.registerHelper("toString",function(a){return a+""}),b.registerHelper("not",function(a){return!a}),b.registerHelper("range",function(a){var b=a.hash,c=b.start||0,d=b.stop||0,e=b.step||1;return g.range(c,d,e)}),b.registerHelper("and",function(){var a=!0,b=arguments.length-1;if(0===b)return!1;for(var c=0;c<b;c++){if(!a)return!1;a=a&&Boolean(arguments[c])}return a}),b.registerHelper("or",function(){var a=!1,b=arguments.length-1;if(0===b)return!1;for(var c=0;c<b;c++){if(a)return!0;a=a||Boolean(arguments[c])}return a}),b.registerHelper("equal",function(a,b,c){return a===b&&!c.hash.useDoubleEquals||a==b&&!0===c.hash.useDoubleEquals}),b.registerHelper("greaterThan",function(a,b){return parseInt(a,10)>parseInt(b,10)}),b.registerHelper("lessThan",function(a,b){return parseInt(a,10)<parseInt(b,10)}),b.registerHelper("replaceSubstringInLocString",function(a){var c=b.helpers.loc(a.hash.locPath,{},this),d=JSON.parse(a.hash.replacements);return g.each(d,function(a,b){c=c.replace(new RegExp(b,"g"),a)}),c}),b.registerHelper("determineLeg",function(a,b,c){var d;return d=0===a?b:c}),b.registerHelper("includePartial",function(a,c){return b.templates[a](c)})},$(function(){h.registerHelpers()}),a.Templates=h,h}),require("templates",function(){}),define("currency",["flights","jquery"],function(a,b){"use strict";function d(){return{prefix:"",wholePart:"",decimalPart:"",suffix:"",formattedWithDecimal:"",formattedWithoutDecimal:""}}function e(b){var c=b.match(a.Model.Currency.leadingSymbolRegex);return c?c.slice(1):["",""]}function f(a){for(var c,d,b=a.length-1;b>0&&!(a[b]>="0"&&a[b]<="9");)b-=1;return c=a.substring(0,b+1),d=a.substring(b+1),[c,d]}function g(b){var g,c=d();return g=e(b),c.prefix=g[0],g=g[1].split(a.Model.Currency.decimalSeparator),c.wholePart=g[0],g.length>1&&(g=f(g[1]),c.decimalPart=a.Model.Currency.decimalSeparator+g[0],c.suffix=g[1]),c.formattedWithDecimal=c.prefix+c.wholePart+c.decimalPart+c.suffix,c.formattedWithoutDecimal=c.prefix+c.wholePart+c.suffix,c}function h(a){var c,b=d();return c=e(a),b.prefix=c[0],c=f(c[1]),b.wholePart=c[0],b.suffix=c[1],b.formattedWithDecimal=b.prefix+b.wholePart+b.decimalPart+b.suffix,b.formattedWithoutDecimal=b.prefix+b.wholePart+b.suffix,b}var c={};return c.parsePrice=function(b){var c=a.Model.Currency;return c.decimalSeparator.length>0&&b.indexOf(c.decimalSeparator)>=0?g(b):h(b)},c.init=function(b){"string"==typeof b&&(a.Model.Currency.decimalSeparator=b)},b(function(){a.Model=a.Model||{},b.extend(a.Model,{Currency:{decimalSeparator:".",leadingSymbolRegex:new RegExp(/^([^\d]*)([\d]+.*)$/)}})}),a.Currency=c,c}),define("globalWizard",["flights","jquery","dctk/dctk","uitk"],function(a,b,c,d){"use strict";function f(a){e.searchParameters.departureAirport=a.departure.airport||"",e.searchParameters.arrivalAirport=a.arrival.airport||"",e.searchParameters.departureDate=a.departure.date||"",e.searchParameters.departDate=a.departure.date||"",e.searchParameters.arrivalDate=a.arrival.date||"",e.searchParameters.adultTraveler=""+a.adultCount,e.searchParameters.childTraveler=""+a.childCount,e.searchParameters.seniorTraveler="",e.searchParameters.preferredAirline=a.preferredAirline||"",e.searchParameters.flightClass=a.seatingClass||"",e.searchParameters.nonstopOnly=a.nonStop,e.searchParameters.refundableFlight=a.refundable,e.searchParameters.nearbyAirportInteraction=!1,e.searchParameters.totalTravelers=a.totalPassengers}var e={};return e.ENDINGTABINDEX=parseInt(b("#refundableFlights").attr("tabIndex"),10)+1,e.searchParameters={},a.Model=a.Model||{},b.extend(a.Model,{Wizard:b.parseJSON(b("#wizardData").html())}),f(a.Model.Wizard),a.Wizard=e,e}),define("analytics",["flights","jquery","dctk/dctk","uitk","configuration","underscore"],function(a,b,c,d,e,f){"use strict";function i(a,c){var f,d=b(c),e=d.data("omnitureRfrr");return void 0===e?(!a&&d.find(".change").is(":visible")?f="FLT.SR.Responsive.Wizard.Cancel":a&&d.find(".cancel").is(":visible")&&(f="FLT.SR.Responsive.Wizard.ChangeSearch"),f):(e.indexOf("INTERACT.OPTIONS")!==-1&&(f=a?"FLT.SR.INTERACT.SHOWOPTIONS":"FLT.SR.INTERACT.HIDEOPTIONS"),e.indexOf("Filter.Airlines")!==-1&&(console.log("BYOT Filter Toggle"),f=a?"FLT.SR."+e+".ShowMore":"FLT.SR."+e+".ShowLess"),e.match(/^Filter.ArrTime.Leg\d$/g)&&(f=a?"FLT.SR."+e.replace("ArrTime","ArrTime.ShowMore"):"FLT.SR."+e.replace("ArrTime","ArrTime.ShowLess")),f)}function j(b){return"object"!=typeof b?void a.log("Invalid newOmnitureData parameter passed to Flights.Analytics saveOmnitureData()."):void(h=b)}function k(b,c){return"string"!=typeof b||"string"!=typeof c?void a.log("Invalid parameter(s) passed to Flights.Analytics saveOmnitureProperty()."):void(h.omnitureProperties[b]=c)}function l(){try{return c.omtr.pageName}catch(b){return a.log("PageName inaccessible in Flights.Analytics getPageName()."),void c.loggingAdapter.logError("Try Catch",b,["origin=Flights.Analytics.getPageName"])}}function m(){d.subscribe("toggle.opened",function(a,b,c){var d=i(!0,b);void 0!==d&&(g.trackAction(d,b[0]),b.uitk_toggle("open"))}),d.subscribe("toggle.closed",function(a,b,c){var d=i(!1,b);void 0!==d&&(g.trackAction(d,b[0]),b.uitk_toggle("close"))}),d.subscribe("off-canvas.stateChanged",function(a,d){"open"===d?g.trackAction("FLT.SR.Filter.AcolButton.Open",b("<div/>")):"closed"===d?(setTimeout(function(){b(".off-canvas-open").removeClass("off-canvas-open"),b(".off-canvas-inner").removeClass("off-canvas-inner")},100),g.trackAction("FLT.SR.Filter.AcolButton.Close",b("<div/>"))):c.loggingAdapter.logMessage("Unexpected Value",["origin=Flights.Analytics.init.subscribe:off-canvas.stateChanged",'message=Expected state to be either "open" or "closed".',"state="+d])})}var h,g={};return g.trackPageLoad=function(b){return b=b||0,"object"!=typeof c||"object"!=typeof h?void a.log("Cannot execute Flights.Analytics.trackPageLoad; problem with dctk or omnitureData."):(g.updateOmnitureProperty("pageName",e.pageName),void c.initOmniture(h))},g.updateOmnitureProperty=function(a,b){k(a,b)},g.updateOmnitureData=function(a){var d=c.omtr.list1.split("|"),e=h.omnitureProperties.list1.split("|"),g=void 0!==a.omnitureProperties.list1?a.omnitureProperties.list1.split("|"):[];return a.omnitureProperties.list1=f.union(d,e,g).join("|"),h=b.extend(!0,h,a)},g.initializeOmnitureData=function(c){var d=b.parseJSON(b("#omnitureJSON").text());return c=c||0,"number"!=typeof c||0>c||"object"!=typeof d||"number"!=typeof c||0>c?void a.log("Invalid DOM data or leg parameter passed to Flights.Analytics.initializeLeg()."):(j(d),void k("pageName",e.pageName))},g.trackAction=function(a,d,e,f){var g={linkTrackVars:"prop16,eVar28,events",prop16:a},h=d instanceof b?d[0]:d,i={pageName:l()};void 0!==e&&(g=b.extend(g,e)),g=b.extend(g,i),"object"==typeof c&&"object"==typeof h&&c.trackAction(a,h,g,f)},g.trackActionWithIncrement=function(a,d){var e=d instanceof b?d[0]:d;"object"==typeof c&&"object"==typeof e&&c.trackAction(a,e,{linkTrackVars:"prop16,eVar28,eVar57,events",linkTrackEvents:"event50",prop16:a,eVar57:"+1"},"event50")},g.updatePageNameForOmniture=function(a){var d=b("#pageId");d.val(a),c.logging.setPageName(a),e.pageName=a},g.trackImpression=function(b,d,e){return void 0===b||"string"!=typeof b?void a.log("TrackImpression failed, mandatory parameter id is undefined"):void("object"==typeof c&&c.trackImpression(b,d,e))},b(function(){m()}),a.Analytics=g,g}),define("timestamp",["flights","jquery","uitk","dctk/dctk","handlebars"],function(a,b,c,d,e){"use strict";function g(a){a.viewedJustNow=!0,a.omnitureRffr="now"}function h(a,b){var c=Math.floor(a/f.ONE_MINUTE_IN_MS);return c<2?b.viewedOneMinuteAgo=!0:b.viewedMinutesAgo=!0,c>=1&&c<=15?b.omnitureRffr="15m":c>15&&c<=30?b.omnitureRffr="30m":c>30&&c<=45?b.omnitureRffr="45m":c>45&&c<=60&&(b.omnitureRffr="1h"),c}function i(a,b){var c=Math.floor(a/f.ONE_HOUR_IN_MS);return c<2?b.viewedOneHourAgo=!0:b.viewedHoursAgo=!0,b.omnitureRffr=c+"h",c}function j(a,b){var c=Math.floor(a/f.ONE_DAY_IN_MS);return c<2?b.viewedYesterday=!0:b.viewedDaysAgo=!0,b.omnitureRffr="yesterday",c}function k(a,b){var c=Math.floor(a/f.ONE_WEEK_IN_MS);return c<2?b.viewedLastWeek=!0:c<4?b.viewedWeeksAgo=!0:b.viewedALongTimeAgo=!0,b.omnitureRffr="yesterday",c}function l(a,b,c){return a<f.ONE_MINUTE_IN_MS?g(b):c=a<f.ONE_HOUR_IN_MS?h(a,b):a<f.ONE_DAY_IN_MS?i(a,b):a<f.ONE_WEEK_IN_MS?j(a,b):k(a,b),c}function m(){return{viewedJustNow:!1,viewedOneMinuteAgo:!1,viewedMinutesAgo:!1,viewedOneHourAgo:!1,viewedHoursAgo:!1,viewedYesterday:!1,viewedDaysAgo:!1,viewedLastWeek:!1,viewedWeeksAgo:!1,viewedALongTimeAgo:!1,viewError:!1}}var f={};return f.ONE_MINUTE_IN_MS=6e4,f.ONE_HOUR_IN_MS=36e5,f.ONE_DAY_IN_MS=864e5,f.ONE_WEEK_IN_MS=6048e5,f.generateViewedDateTimeMarkup=function(a,b,c){var g,e=m(),f=0,h=new Date(parseFloat(a.replace(/[^0-9]/g,""),10)),i=new Date(parseFloat(b.replace(/[^0-9]/g,""),10));try{return void 0===b?c({viewedParameter:0,messageFlags:e}):(g=h-i,f=l(g,e,f),c({viewedParameter:f,messageFlags:e}))}catch(a){return e.viewError=!0,d.loggingAdapter.logError("timestamp.generateViewedDateTimeMarkup",a),c({viewedParameter:a.message,messageFlags:e})}},f}),define("priceAlert",["jquery","flights","fluxClickHandler","i18n","uitk","configuration","analytics","dctk/dctk","experiments","uiModel"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(b){var f,c=b.parent("label"),d=a("#"+b.attr("aria-describedby")),e=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return e.test(b.val())?(c.removeClass("invalid"),b.attr("aria-invalid","false"),d.html("").addClass("visuallyhidden"),!0):(c.addClass("invalid"),b.attr("aria-invalid","true"),f=b.data("validationMsg"),d.html(f).removeClass("visuallyhidden"),!1)}function l(b){r(),e.utils.liveAnnounce(d.priceChangedModal.priceChangeAlertError),a("#priceChangeAlertBtn").addClass("hidden"),t(b)}function m(){return k(a("#emailInputField"))}function n(){z.validSubmit||m()}function o(){a("#emailInputField").attr("value",""),a("#emailInputField").attr("disabled",!0)}function p(){z.timeoutForLoader=null,a("#priceChangeAlertPopUpButtonContainer").addClass("hidden"),a("#priceChangeAlertPopUpLoaderContainer").removeClass("hidden")}function q(){z.timeoutForLoader=setTimeout(p,f.priceAlerts.loaderTimeout)}function r(){z.timeoutForLoader&&clearTimeout(z.timeoutForLoader)}function s(a){void 0!==a.newSoftAccountCreated&&a.newSoftAccountCreated===!0&&"undefined"!=typeof h&&h.onReady(function(){h.trackEvent("o","priceChangeAlertPopUp",{eVar28:"SOFT.ACCOUNT.CREATED",prop16:"SOFT.ACCOUNT.CREATED"})})}function t(b){a("#priceChangeAlertPopUpButtonContainer").addClass("hidden"),a("#priceChangeAlertPopUpLoaderContainer").addClass("hidden"),a("#priceChangeAlertPopUpErrorContainer").removeClass("hidden"),void 0!==b&&a("#popupCreatingYourPriceAlertErrorText").text(b)}function u(b,c){var d;"priceChangeAlertPopupModal"===c.options.modalId&&(this.validSubmit?e.utils.focusElement(a("#priceChangeAlert")):(d=a("#emailInputField").val(),d?g.trackAction("FLT.SR.GetPriceAlerts.Close.Aborted",c):g.trackAction("FLT.SR.GetPriceAlerts.Close.Ignored",c),e.utils.focusElement(a("#priceChangeAlertBtn"))))}function v(b,c){"priceChangeAlertPopupModal"===c.options.modalId&&(x(),a("#priceChangeAlertPopUpButton").removeAttr("disabled"),a("#emailInputField").blur(n))}function w(b){var d,e,c=a(window)[0].location.search.substring(1),f=c.split("&");for(d=0;d<f.length;d++)if(e=f[d].split("="),e[0]===b)return e[1];return""}function x(){a("#emailValidationError").addClass("visuallyhidden"),a("#priceChangeAlertForm label").removeClass("invalid")}function y(c,d){var e=a("#scratchpad-badge-tuid").attr("data-id"),f=a("#scratchpad-badge-guid").attr("data-id"),g=a.parseJSON(a("#omnitureJSON").text()).omnitureProperties.userType,i="unidentified",j=[];j.push("tuid="+e),j.push("guid="+f),"AUTHENTICATED"===g?i="authenticated":"IDENTIFIED"===g&&(i="identified"),j.push("user-state="+i),void 0!==d&&j.push("email-address="+d),h&&h.logging&&h.logging.logMessage&&h.logging.logMessage("ShopperProgram_"+c,j),b.log("Price Alert Diagnostic Report:"),b.log(j)}var z={validSubmit:!1,timeoutForLoader:null,isSubscribedToPriceAlerts:2===f.priceAlerts.variant,initialize:function(a){this.bindEvents(),this.departureAirport=a.departureAirport,this.arrivalAirport=a.arrivalAirport,this.departureDate=a.departureDate,this.arrivalDate=a.arrivalDate,this.dateFormat=a.dateFormat,this.showPriceAlertsModule()},showPriceAlertsModule:function(){this.priceChangeAlertReset(),f.priceAlerts.variant>0&&f.priceAlerts.priceAlertAlternateBehavior?b.vent.on("uiModel.resetViewableOffers",function(a){z.priceAlertAlternateConditions()&&z.showPriceAlertButton()}):f.priceAlerts.variant>0&&z.showPriceAlertButton()},priceAlertAlternateConditions:function(){return!(_.isEmpty(b.collections.legsCollection.first().attributes)||!f.route.isRoundTrip)},hidePriceAlertsModule:function(){f.priceAlerts.variant>0&&a("#priceChangeAlert").addClass("hidden")},bindEvents:function(){b.vent.on("router.selectedLegs",this.hidePriceAlertsModule,this),b.vent.on("router.noSelectedLegs",this.showPriceAlertsModule,this)},signUpForPriceAlerts:function(b,c,g){y("GetPriceAlert"),1!==f.priceAlerts.variant||f.priceAlerts.priceAlertAlternateBehavior?(e.modal.close(),a(".get-price-alert-popup-link").click()):g.subscribeViaScratchpad({success:function(){g.showAddedToPriceAlertsNotification(),e.utils.liveAnnounce(d.priceChangedModal.priceChangeAlertAlreadySubscribed)},error:l})},subscribeViaScratchpad:function(b){var c=this;a(window)[0].Scratchpad.sendNotes(!0).success(function(){c.isSubscribedToPriceAlerts=!0,e.publish("FSR.PriceAlerts.subscribed"),b&&"function"==typeof b.success&&b.success()}).error(function(a,c){console.log("error:",a),console.log(c),b&&"function"==typeof b.error&&b.error()})},createAlert:function(b,c,h){var j=a("#emailInputField").val();m()?f.priceAlerts.priceAlertAlternateBehavior?z.createPriceAlertAlternateMode(j,{departureAirport:z.departureAirport,departureDate:z.departureDate,arrivalAirport:z.arrivalAirport,arrivalDate:z.arrivalDate,dateFormat:z.dateFormat,success:function(a){r(),e.utils.liveAnnounce(d.priceChangedModal.priceChangeAlertAlreadySubscribed),h.showAddedToPriceAlertsNotification(),e.modal.close()},error:function(a){a&&a.errors&&a.errors.error&&a.errors.error[0]&&a.errors.error[0].errorMessage?l(a.errors.error[0].errorMessage):l()}}):(a("#priceChangeAlertPopUpButton").attr("disabled","disabled"),g.trackAction("FLT.SR.GetPriceAlerts.CreateAlert",a("#priceChangeAlertPopUpButton")),h.createPriceAlerts(j,{channelType:"FSRPriceAlertsACol",redirectUrlReferrer:"EML.FLT.SR.GetPriceAlerts.CreateAlert",success:function(a){r(),s(a),"NOT_VALIDATED"===a.validationStatus||"PENDING_VALIDATION"===a.validationStatus?(e.utils.liveAnnounce(d.priceChangedModal.priceChangeAlertCheckYourEmail),h.showCheckYourEmailNotification(),e.modal.close(),i.execute("PRICEALERTS.CHECKEMAILCONFIRM.MODAL",{})):"VALIDATED"===a.validationStatus?(e.modal.close(),e.utils.liveAnnounce(d.priceChangedModal.priceChangeAlertAlreadySubscribed),h.showAddedToPriceAlertsNotification()):l()},error:l})):(a("#emailInputField").select(),e.utils.liveAnnounce(d.priceChangedModal.priceChangeAlertInvalidEmail)),c&&c.preventDefault&&c.preventDefault()},createPriceAlerts:function(b,c){var j,g=this,h="Flights-Search?trip={trip}&leg1={leg1}&leg2={leg2}&passengers={passengers}&mode={mode}&rfrr={rfrr}",i={email:b,type:c.channelType},k=c.redirectUrlReferrer;j=h.replace("{trip}",w("trip")).replace("{leg1}",decodeURIComponent(w("leg1"))).replace("{leg2}",decodeURIComponent(w("leg2"))).replace("{passengers}",w("passengers")).replace("{mode}",w("mode")).replace("{rfrr}",k),i.redirectUri=encodeURI(j),e.utils.liveAnnounce(d.priceChangedModal.priceChangeAlertCreatingYourPriceAlert),this.validSubmit=!0,q(),o(),y("CreateAlert",b),a.ajax({url:"/price-alerts-subscribe",type:"POST",dataType:"json",data:i,timeout:f.priceAlerts.subscribeAjaxTimeout,success:function(a){g.isSubscribedToPriceAlerts=!0,e.publish("FSR.PriceAlerts.created"),c&&"function"==typeof c.success&&c.success(a)},error:function(){c&&"function"==typeof c.error&&c.error()}})},createPriceAlertAlternateMode:function(c,g){q(),e.utils.liveAnnounce(d.priceChangedModal.priceChangeAlertCreatingYourPriceAlert);var h=z.getIsoDateString(b.getDateObj(g.departureDate,g.dateFormat)),i=z.getIsoDateString(b.getDateObj(g.arrivalDate,g.dateFormat)),j=_.min(b.collections.legsCollection.first().attributes,function(a){return a.price.exactPrice}).price.exactPrice,k=JSON.stringify({email:c,origin:g.departureAirport,departureDate:h,destination:g.arrivalAirport,returnDate:i,lowestPrice:j,flightType:"RoundTrip"});a.ajax({url:f.priceAlerts.altPriceAlertEndpoint,type:"POST",dataType:"json",contentType:"application/json",data:k,timeout:f.millisBeforeShowGetPriceAlertTimeout,success:function(a){g&&"function"==typeof g.success&&g.success(a)},error:function(a){if(g&&"function"==typeof g.error){var b;try{b=JSON.parse(a.responseText)}catch(a){}g.error(b)}}})},getIsoDateString:function(a){var b="",c=a.getFullYear(),d=Number(a.getMonth())+1,a=a.getDate();return d<10&&(d="0"+d),a<10&&(a="0"+a),b=c+"-"+d+"-"+a},showPriceAlertButton:function(){var b=a("#priceChangeAlertBtn");e.subscribe("modal.appended",v),e.subscribe("modal.close",this,u),a("#priceChangeAlert").removeClass("hidden"),2===f.priceAlerts.variant&&(b.addClass("hidden"),a("#priceChangeAlertAlreadySubscribed").removeClass("hidden"))},priceChangeAlertReset:function(){window.innerWidth<960&&a("#bCol").prepend(a("#priceChangeAlert").remove()),a(window).resize(function(){window.innerWidth<960?a("#bCol").prepend(a("#priceChangeAlert").remove()):a("#aCol").prepend(a("#priceChangeAlert").remove())})},showCheckYourEmailNotification:function(){a("#priceChangeAlertBtn").addClass("hidden"),a("#priceChangeAlertCheckYourEmail").removeClass("hidden")},showAddedToPriceAlertsNotification:function(){a("#priceChangeAlertBtn").addClass("hidden"),a("#priceChangeAlertAlreadySubscribed").removeClass("hidden")}};return a(function(){c.handlers&&(c.addHandler("signUpForPriceAlerts",z.signUpForPriceAlerts,z),c.addHandler("createAlert",z.createAlert,z))}),b.PriceAlert=z,z}),define("flights",["jquery","uitk","backbone","underscore","dctk/dctk","configuration"],function(a,b,c,d,e,f){"use strict";var g={collections:{},constructors:{},models:{},views:{},logging:{enabled:!0}};return c.$=a,g.vent=d.extend({},c.Events),b.media.lazyBuffer=1e3,g.log=function(a){window.console&&g.logging.enabled&&("object"==typeof a&&"function"==typeof console.dir?console.dir(a):"string"==typeof a&&console.log(a))},g.getDateObj=function(a,b){var d,e,f,h,j,k,l,m,c=/(-|\/|\.|,|\\)/g,g=0,i=new Date;if(b=b||"MM/dd/yy",void 0!==a){for(e=b.match(c),null!==e&&(d=e[0]),a=a.replace(c,d),f=b.split(d),g=f.length,h=a.split(d),m=0;m<g;m+=1)f[m].indexOf("d")>-1?j=parseInt(h[m],10):f[m].indexOf("M")>-1?k=parseInt(h[m],10):f[m].indexOf("y")>-1&&(l=parseInt(h[m],10),(isNaN(l)||l>=1e4)&&(l=i.getFullYear(),k<i.getMonth()&&(l+=1)),l<100&&(l+=2e3));return new Date(l,k-1,j)}return new Date(null)},g.utils={objToStringArray:function(a,b,c){var e,f,d=[];if("object"==typeof a){b="string"==typeof b?b:"",c="number"==typeof c?c:50;for(e in a)a.hasOwnProperty(e)&&(f=a[e],"string"==typeof f||"number"==typeof f||"boolean"==typeof f?d.push((b+e+"="+f.toString().substring(0,c)).replace(/\.| /g,"")):null!==f&&"object"==typeof f&&(d=d.concat(this.objToStringArray(f,e+"-"))));return d}}},Date.prototype.addDays||(Date.prototype.addDays=function(a){var b=new Date(this.valueOf());return b.setDate(b.getDate()+a),b}),Date.prototype.stringFromPattern||(Date.prototype.stringFromPattern=function(a){var d,f,g,b=/(-|\/|\.|,|\\)/g,c=a.match(b),e=[],h=[];if(null===c)return"";for(d=c[0],a=a.replace(b,d),e=a.split(d),g=0;g<e.length;g+=1)f=e[g].toLowerCase(),f.indexOf("d")>-1?h.push(this.getDate()):f.indexOf("m")>-1?h.push(this.getMonth()+1):f.indexOf("y")>-1&&h.push(this.getFullYear());return h.join(d)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/(^\s+)|(\s+$)/g,"")}),Array.prototype.filter||(Array.prototype.filter=function(a){var b,c,f,g,d=[],e=arguments[1];if(null===this||"function"!=typeof a)throw new TypeError;for(b=Object(this),c=b.length>>>0,g=0;g<c;g++)g in b&&(f=b[g],a.call(e,f,g,b)&&d.push(f));return d}),g}),require(["jquery","flights","uitk","applicationView"],function(a,b,c,d){"use strict";a(function(){b.views.applicationView=new d,c.subscribe("mediaquery.matched",function(b,c){"tablet"!==c.key&&"smallTablet"!==c.key||a(".col.a-col").attr("aria-hidden","true"),"desktop"===c.key&&a(".col.a-col").removeAttr("aria-hidden")}),c.mediaquery.publishAgain(),c.subscribe("off-canvas.stateChanged",function(b,c){"open"===c?a(".col.a-col").removeAttr("aria-hidden"):a(".col.a-col").attr("aria-hidden","true")})})}),define("interstitial",["flights","jquery","uitk","i18n","configuration"],function(a,b,c,d,e){"use strict";function p(a,c){!0==a instanceof b&&b.each(a,function(a,d){b(d).find(n).css("width",c+"%")})}function q(a,b,c){return a>0&&b<a&&c>=100*(b+1)/a}var h,f={},g={elements:b(".outbound-interstitial .progress-bar"),duration:15e3,increment:e.perceivedInstantEnabled?.1:1,finalizingPricesPercent:80,stopPercent:90},i=".primary-msg",j=".secondary-msg",l=".ad",m=".progress-bar",n=".fill",o="completed";return f.show=function(a,e){var f=b.extend(e,g);!0==a instanceof b&&b.each(a,function(a,e){function u(a){q(s,t,a)&&(r=n[t+=1],g.find(i).text(r),c.utils.liveAnnounce(r,"assertive")),setTimeout(function(){a<=f.stopPercent?!0!==g.data(o)&&(p(f.elements,a),u(a+f.increment)):a>=f.finalizingPricesPercent&&(h=setInterval(function(){c.utils.liveAnnounce(n[s-1],"assertive")},2e3))},k)}var g=b(e),k=f.duration/(f.stopPercent/f.increment),n=d.interstitial.messages,r="",s=n.length,t=0;g.removeData(o),g.find(i).show(),c.utils.liveAnnounce(n[t],"assertive"),g.show(),g.find(j).show(),g.find(l).show(),g.find(m).show(),u(0)})},f.hide=function(a){clearInterval(h),!0==a instanceof b&&b.each(a,function(a,c){var f=b(c),g=d.interstitial.messages;f.find(i).text(g[g.length-1]),p(f,100),f.data(o,!0),setTimeout(function(){f.hide(),b(".outbound-interstitial").hide(),e.perceivedInstantEnabled&&b(".pi-progress-show").removeClass("pi-progress-show")},250),b(".outbound-spinner").hide()})},a.interstitial=f,f}),define("feedback",["flights","jquery","fluxClickHandler"],function(a,b,c){"use strict";function e(){var d,a=screen.width,c=screen.height,e="/p/info-other/feedback.htm?";return 1===b("#feedbackURL_OL").length&&(e=b("#feedbackURL_OL").attr("data-url")),"undefined"!=typeof OpinionLab_FB&&("undefined"!=typeof OpinionLab_FB.O_HT&&(e+="referer="+OpinionLab_FB.O_HT()),"undefined"!=typeof OpinionLab_FB.O_CV&&(e+="&customvar="+OpinionLab_FB.O_CV()),"undefined"!=typeof OpinionLab_FB.O_PRV&&(e+="&prev="+OpinionLab_FB.O_PRV())),d=window.open(e,"ModalPopUp","toolbar=no,scrollbars=no,location=no,statusbar=no,menubar=no,resizable=no,width=635px,height=280px,screenX="+(a-535)/2+",screenY="+(c-192)/2+",left="+(a-535)/2+",top="+(c-192)/2),d.focus(),e}var d={};return d.showLink=function(){b("#feedbackAndImprovements").removeClass("hide")},b(function(){c.addHandler("showFeedback",e)}),d}),define("ads",["flights","jquery","uitk","dctk/dctk","IntentMediaModule","configuration"],function(a,b,c,d,e,f){"use strict";function i(){var c=[];b("#dcol_content iframe").length>0&&f.ads.enabledInCol===!0&&c.push("DcolAds"),b("#small-adsense-footer").length>0&&f.ads.enabledInFooter===!0&&c.push("FooterAds"),b("#intentMediaAdPlacement div").length>0&&c.push("AcolIntent"),b(".intent-media div").length>0&&c.push("IntentIntercard"),c.length>0&&a.Analytics.trackAction(c.join("|"))}function j(){var a,c=b("#mediaSolutionsTrackingUrlValid"),e=b("#OPMTrackingUrlValid");try{c.attr("src",c.data("src")),e.attr("src",e.data("src")),require(["expads"],function(c){"undefined"!=typeof expAdsCsa&&(a=b.parseJSON(b("#afsConfigurationData").html()),a&&(a.product="flights",c.adSenseContainers=c.adSenseContainers||{},c.adSenseContainers.adsense_dcol_container=function(b){f.path.isFlightOnly&&(a.adLayout="sellerFirst"),expAdsCsa.setAfsConfiguration(a);var c=[];c.push(expAdsCsa.get_csa_dcol_adblock(b,"3","140px")),c.push(expAdsCsa.get_csa_footer_adblock("medium-adsense-footer-content-section1","2","305px")),c.push(expAdsCsa.get_csa_footer_adblock("medium-adsense-footer-content-section2","2","305px")),expAdsCsa.call(c)},c.adSenseContainers["small-adsense-footer"]=function(b){a.adLayout=null,expAdsCsa.setAfsConfiguration(a);var c=[];c.push(expAdsCsa.get_csa_footer_adblock("small-adsense-footer-content-section1","2","305px")),c.push(expAdsCsa.get_csa_footer_adblock("small-adsense-footer-content-section2","2","305px")),expAdsCsa.call(c)})),c.ensureVisibleAdsAreLoaded(),c.extensions.clingyAds.init('div[data-omniture-rfrr="Dcol.Ad.Bottom"]',"#dcol_content",'div[data-omniture-rfrr="Dcol.Adsense"]',"footer")})}catch(a){d.loggingAdapter.logError("Try Catch",a,["origin=flights.ads.showAds","errorSrc=FLUX"])}}var g={},h=new e({desktopPosition:function(){return f.ads.intentMedia.placementPosition},mobilePosition:function(){return f.ads.intentMedia.placementPosition}});return g.show=function(){j(),i(),g.refreshIntentMedia(),(f.path.isFlightHotel||f.path.isFlightHotelCar||f.path.isFlightCar)&&f.ads.isInlineBannerEnabled&&g.loadInlineBanner(),f.path.isFlightOnly&&f.route.isRoundTrip&&g.loadInlineBanner("flight"),f.ads.isReplaceWSWUbyDcolAds&&g.replaceWSWUbyDcolAds()},g.refreshIntentMedia=function(){f.ads.intentMedia.suppress||(h.insertIntentMediaListingPlaceholders(),h.refresh())},g.loadInlineBanner=function(a){require(["expads","inlineBannerModule"],function(b,c){
c.insertInlineBanners(a),b.ensureVisibleAdsAreLoaded()})},g.replaceWSWUbyDcolAds=function(){var a;b("#dcol_content:visible").length&&(a=b("#alertBox:visible").children().length?b("#alertBox").offset():b("#sortBar").offset(),b("#dcol_content").offset({top:a.top}))},a.vent.on("filtersView.filterSelected",function(){b(".inline-banner").remove(),require(["expads"],function(a){f.ads.refreshDisplayAdsOnFilter===!0&&a.refresh()}),f.ads.isReplaceWSWUbyDcolAds&&g.replaceWSWUbyDcolAds()}),a.vent.on("uiModel.resetViewableOffers",function(){g.refreshIntentMedia(),(f.path.isFlightHotel||f.path.isFlightHotelCar||f.path.isFlightCar)&&f.ads.isInlineBannerEnabled&&g.loadInlineBanner(),f.path.isFlightOnly&&f.route.isRoundTrip&&g.loadInlineBanner("flight")}),a.vent.on("router.selectedLegs router.noSelectedLegs",function(){require(["expads"],function(a){a.refresh()})}),a.vent.on("discovery.rendered discovery.closeModule",function(){f.ads.isReplaceWSWUbyDcolAds&&g.replaceWSWUbyDcolAds()}),g}),require(["jquery","adtoolkit/experiments","expads"],function(a,b,c){"use strict";var h,d="DFPNativeImageLinksStandAloneFSR",e="DFPNativeImageLinksPkgFSR",f=document.getElementById("native_ad"),g=document.getElementById("gtFooterContainer");null!==g&&null!==f&&(b.hasExperiment(d)?h=b.getExperimentByName(d):b.hasExperiment(e)&&(h=b.getExperimentByName(e)),void 0!==h&&(a(window).width()<1024?(h.exposureLog(),1===h.bucket?f.style.display="block":g.style.display="block"):g.style.display="block")),c.utils.showParentDivForNonEmptyAdUnit("dfp-module-header","CF")}),define("IntentMediaModule",["jquery"],function(a){"use strict";function b(b){var c=b.target,d=b.index,e="IntentMedia"+("Desktop"===c?"Result":c)+"Ad"+d,f="Inline.Intent."+c+".Ad"+d,g="segment intent-media intent-media-ad-"+c.toLowerCase();return a("#"+e).remove(),a("<li/>").addClass(g).attr({id:e,"data-click-handler":"omnitureClickHandler","data-omniture-rfrr":f})}function c(){var b;b=window.innerWidth<726?"phone":window.innerWidth<960?"tablet":window.innerWidth<1176?"mid_screen":"full_screen",a.extend(window.IntentMediaProperties,{screen_size:b})}function d(){a(window).resize(function(){c()})}var e=function(e){c(),d();var f=[{index:1,position:e.desktopPosition,target:"Desktop"},{index:1,position:e.mobilePosition,target:"Mobile"}];return{insertIntentMediaListingPlaceholders:function(){var j,c=a("#flightModuleList").find(".flight-module:not(.hide)"),d=c.last(),e=c.length,g=function(a,b){e>a-1&&c.eq(a-1).after(b)},h=function(a,b){e<=a-1&&d.after(b)},i=0;if(e>0)for(i=f.length-1;i>=0;i-=1)j=b(f[i]),g(f[i].position(),j),h(f[i].position(),j)},refresh:function(){"undefined"!=typeof IntentMedia&&IntentMedia.Event.trigger("IntentMediaRefresh")}}};return e}),define("fluxClickHandler",["flights","jquery","uitk","dctk/dctk"],function(a,b,c,d){"use strict";var e={};return e.touchmove=!1,e.handlers={},e.defaultElementQuery=".click-handler-range",e.elementQuery=e.defaultElementQuery,e.disableAllInput=function(){b("*").off()},e.setElementQuery=function(a){e.elementQuery=a},e.registerHandler=function(){b(document).on("touchmove",e.elementQuery,function(a){e.touchmove=!0}),b(document).on(c.clickEvent,e.elementQuery,function(a){e.dispatchHandler(a),"touchend"===a.type&&(e.touchmove=!1)})},e.addHandler=function(a,b,c){e.handlers[a]={handler:b,context:c}},e.dispatchHandler=function(a){var h,i,b=!1,c=a.srcElement||a.target,d=c.attributes["data-click-handler"],f=void 0!==c.attributes["data-stop-propagate"]&&"true"===c.attributes["data-stop-propagate"].value,g=void 0!==c.attributes["data-prevent-default"]&&"true"===c.attributes["data-prevent-default"].value;if(g&&a.preventDefault(),f&&a.stopPropagation(),void 0===d)for(i=c.parentNode;void 0!==i&&i!=document;){if(d=i.attributes["data-click-handler"],void 0!==d){c=i;break}i=i.parentNode}if(void 0!==d){h=d.nodeValue;for(var j=h.split(","),k=0;k<j.length;k++){var l=j[k],m=e.handlers[l].handler,n=e.handlers[l].context;void 0!==m&&(m(c,a,n),b=!0)}"undefined"!=typeof TLT&&b&&TLT.processDOMEvent(a)}},e.preventInadvertentTriggerOnIpad=function(a,c,d){var f=-1<navigator.userAgent.indexOf("iPad"),g=void 0!==b.browser.safari,h=void 0!==a&&"click"===a.type,i=void 0!==a&&"touchend"===a.type;if(d="boolean"!=typeof d||d,f&&g){if(h)return a.stopPropagation(),void a.preventDefault();i&&!e.touchmove&&"function"==typeof c&&c()}else d&&"function"==typeof c&&c()},e.init=function(){e.registerHandler()},b(function(){e.init()}),a.ClickHandler=e,e}),define("selectFlight",["flights","jquery","fluxClickHandler","forceChoiceModalView","uitk","dctk/dctk","configuration","progress","underscore","experiments","detectizr","sitebrand","i18n"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n=b.browser,o=navigator.userAgent,p=b("#originalContinuationId").text(),q=o.indexOf("iPad")>-1,r=void 0!==n.safari,t=(e.createBrowserStorage("session"),{isSplitTicket:!1,isPackageable:!1,crossSellModel:void 0,router:void 0,selectedOutboundSuperlatives:void 0,flightSelectClickHandler:function(c,d){var h=b(c).data();return void 0===h.tripId?void a.log("Error in selectFlight(tripId = "+h.tripId+")"):void(h.isCached&&j.getVariant(13327)>0||(!0===g.view.isByot&&require(["setupRouter"],function(a){t.router=a()}),t.isSplitTicket=h.isSplitTicket,t.isPackageable=h.isPackageable,t.shouldMoveToNextLeg(h)?(t.selectedOutboundSuperlatives=h.superlatives,t.moveToNextLeg(h.leg0NaturalKey)):(f.logging.logTrxEvent("returnLegSelected",["clEventName01=FLUX_TimeToUDP","clEventTime01="+((new Date).getTime()-f.logging.pageStartTime)]),j.execute("FSR_FC_EB_Ch_Fi",h),t.shouldShowForcedChoiceModal(h)?t.showForcedChoiceModal(h):(g.isFlexibleShoppingEnabled===!0&&e.publish("results.complete",{contentId:".site-content-wrap"}),t.redirectToUDP(h))),e.publish("Flights.Selected.Flight"),d.stopPropagation()))},shouldMoveToNextLeg:function(a){return!0!==a.bargainFare&&g.view.isByot&&0===t.router.getNextLegToView()},moveToNextLeg:function(a){t.router.navigate(t.router.getFluxFragmentPrefix()+a,{trigger:!0})},getForbiddenCarriers:function(){var a=g.xsell.hotel.forcedChoice.forbiddenAirlines;return a&&a.length?a.split(","):void 0},isAirlineEligible:function(a,b){if(void 0===b)return!0;var c=void 0!==a.outboundAirlineCodes?a.outboundAirlineCodes.split(","):void 0,d=void 0!==a.inboundAirlineCodes?a.inboundAirlineCodes.split(","):void 0;return void 0===c||void 0===d||!(i.intersection(c,b).length>=1)&&!(i.intersection(d,b).length>=1)},getDurationOfTripInDays:function(){var b=a.getDateObj(a.Model.Wizard.departure.date,a.Model.Wizard.calendar.dateFormat),c=a.getDateObj(a.Model.Wizard.arrival.date,a.Model.Wizard.calendar.dateFormat),d=c-b;return Math.floor(d/864e5)},shouldShowForcedChoiceModal:function(a){var b="mobile"===k.device.type;return!!t.isCrossSellEnabled(a)&&(j.execute("MIS_BundledSavings_Attach_MVP_Mobile"),j.execute("MIS_BundledSavings_Attach_MVP"),!(g.xsell.hotel.forcedChoice.enabled===!1||b||g.xsell.bundledSaving.enabled===!0))},isCrossSellEnabled:function(a){var c=void 0!==b.browser.msie&&0===b.browser.version.indexOf("8."),d=this.getDurationOfTripInDays(),e={outboundAirlineCodes:a.outboundAirlinecodes||void 0,inboundAirlineCodes:a.inboundAirlinecodes||void 0},f=this.isAirlineEligible(e,this.getForbiddenCarriers())===!0;return c===!1&&g.route.isRoundTrip&&!a.bargainFare&&a.hasFare&&d>0&&d<=26&&f===!0},showForcedChoiceModal:function(a){var c=new d(a,t.crossSellModel,{useAlertnateXsellChoice:"1"===l.siteid});return b("#xSellHotelForcedChoice").scrollTop(),c},redirectToUDP:function(a){var n,c=a.tripId,d=a.bargainFare,f=a.addHotelPackage||!1,i=b("#flightRouteType").val(),j=b("#progressAlert img"),k=e.createBrowserStorage("session").readItem("xsellchoicekey")||"normal",o=a.hasFare,p=a.resultToken,s=a.legIndexes,u=g.udp.openInNewTab&&g.path.isFlightOnly;g.isFlexibleShoppingEnabled===!0?e.publish("results.changed",{contentId:".site-content-wrap",scrollToTop:!0,message:"<p>"+m.searching.interstitial.packageInterstitial+"</p>",screenReaderMsg:m.searching.interstitial.packageInterstitial,showLoader:!1,disable:!0}):h.show("#udpAlertTitle"),q&&r&&setTimeout(function(){h.hide()},5e3),g.xsell.bundledSaving.enabled===!0&&t.isCrossSellEnabled(a)?k="showbundledsavingonly":"1"===l.siteid&&"2"===i&&(k="showhotelbanneronly"),o||d?(n=t.flightDetailsUrl(k,f,c,a.isSplitTicket,a.superlatives,a.isCached),n=t.addPackageDetailsUrlParameters(n,a)):n=t.flightDetailsUrlForCTP(k,f,s,p,a.isSplitTicket),g.loyalty.partnerPointsEnabled&&(n=t.addPartnerLoyaltyUrlParameters(n,a)),u?window.open(n,"_blank").opener=null:t.openUrlInSameTab(n),h.hide(),j.prop("src",j.prop("src"))},flightDetailsUrl:function(a,b,c,d,e,f){var g=void 0!==t.selectedOutboundSuperlatives?t.selectedOutboundSuperlatives:e,h=f?"Flight-Details-PI":"Flight-Search-Details";return""===g&&(g="NA"),""===e&&(e="NA"),h+"?c="+p+"&tripId1= &offerId="+encodeURIComponent(c)+"&leg1="+g+"&leg2="+e+"&xsellchoice="+a+"&addHotelPackage="+b+"&isSplitTicket="+d},flightDetailsUrlForCTP:function(a,b,c,d,e){return"/Flight-Select?c="+p+"&rt="+d+"&legs="+c+"&xsellchoice="+a+"&addHotelPackage="+b+"&isSplitTicket="+e},addPackageDetailsUrlParameters:function(a,b){return b.hotelData&&(a=a+"&hotelData="+encodeURIComponent(b.hotelData)),b.carData&&(a=a+"&carData="+encodeURIComponent(b.carData)),a},addPartnerLoyaltyUrlParameters:function(a,b){return b.rewardId&&(a=a+"&rewardId="+encodeURIComponent(b.rewardId)),a},openUrlInSameTab:function(a){window.location.assign(a)}});return b(function(){c.addHandler("select-flight",t.flightSelectClickHandler),a.vent.on("crossSellModel.updated",function(a){t.crossSellModel=a.crossSellModel})}),t}),define("scratchpadModal",["flights","jquery","uitk","handlebars","configuration","analytics","fluxClickHandler","i18n","priceAlert","scratchpadModalPriceAlerts","experiments"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l={model:{},searchParameters:null,initialize:function(b){this.model.sessionStorage=c.createBrowserStorage("session"),a.vent.on("wizardView.beforeSearchIsSent",this.updateNumberOfSearches,this),this.searchParameters=b,this.maybeLaterBannerEnabled=e.scratchpadModal.maybeLaterBannerEnabled,j.initialize({priceAlertVariant:e.priceAlerts.variant,parentView:this}),l.initializeStorage(),c.subscribe("modal.close",this,this.onModalClose)},onModalClose:function(a,b){"scratchpadOptin"!==b.options.modalId||i.isSubscribedToPriceAlerts||this.optScratchpadLater(null,null,this)},optScratchpadLater:function(a,d,e){var f=e;f.model.sessionStorage.saveAsJSON("scratchpadOptinStatus",f.model.userScratchpadOptinActivity.MAYBE_LATER),f.shouldShowMaybeLaterBannerWithEventsOnFSR()&&this.maybeLaterBannerEnabled&&f.showOptinAlertLater(),c.utils.liveAnnounce(h.sorting.accessibility.sortedByPrice),c.utils.focusElement(b("#wizardSearch"))},showMaybeLaterModuleBanner:function(){var a=this.model.sessionStorage.readJSONAsObject("scratchpadOptinStatus"),b=this.model.sessionStorage.readJSONAsObject("userClosedAlertBox");this.maybeLaterBannerEnabled&&this.isUserNotOptedIn()&&this.model.userScratchpadOptinActivity.MAYBE_LATER===a&&b!==!0&&this.shouldShowMaybeLaterBannerWithEventsOnFSR()&&l.showOptinAlertLater()},showOptinModal:function(a){var d,e=b("#send-me-notes-button"),g=b("#scratchpadOptin");c.modal.close(),g.attr("aria-hidden","true"),g.click(),f.trackActionWithIncrement("FLT.SR.ScratchpadModal.Display",b("#scratchpadOptin.modal-wrap")),e.attr("data-click-handler","createPriceAlertScratchpadModal,omnitureClickHandler"),d=b("#scratchpadOptin.modal-wrap button.modal-close"),d.length>0&&(d.attr("data-click-handler","omnitureClickHandler"),a||d.attr("data-omniture-rfrr","ScratchpadModalClose.Close"))},showOptinAlertLater:function(){var a=b("div#alertBox");0!==a.length&&(a.empty(),a.append(this.model.scratchpadOptinLaterAlert),a.removeClass("hide"),b("#scratchpadOptinLaterAlert button span.alt").length>0&&b("#scratchpadOptinLaterAlert button span.alt").html(h.scratchpadOptinAlertCloseButtonText.accessibility.closeButtonText))},showOptinAlertSuccess:function(){i.isSubscribedToPriceAlerts&&i.showAddedToPriceAlertsNotification()},afterSearchSuccess:function(){var a=this.model.sessionStorage.readJSONAsObject("numberOfSearches"),c=this.model.sessionStorage.readJSONAsObject("scratchpadOptinStatus");this.showModal(a,this.model,c)?(l.showOptinModal(!1),b("#scratchpadOptin-title").length>0&&b("#scratchpadOptin-title").attr("aria-live","assertive")):l.showMaybeLaterModuleBanner()},updateNumberOfSearches:function(a){var b=this.model.sessionStorage.readJSONAsObject("numberOfSearches");this.isDifferentSearch(a)&&this.model.sessionStorage.saveAsJSON("numberOfSearches",b+1)},initializeStorage:function(){var a,c,e;b.extend(this.model,{userScratchpadOptinActivity:{NO_ACTION:"NO_ACTION",OPTED_IN:"OPTED_IN",OPTED_OUT:"OPTED_OUT",MAYBE_LATER:"LATER"},SHOW_SCRATCHPAD_MODAL_ON_SEARCHCOUNT:2,REMOVE_OPTIN_SUCCESS_ALERT_ON_SEARCHCOUNT:3}),this.model.sessionStorage.doesKeyExist("numberOfSearches")||this.model.sessionStorage.saveAsJSON("numberOfSearches",1),this.model.sessionStorage.doesKeyExist("scratchpadOptinStatus")||this.model.sessionStorage.saveAsJSON("scratchpadOptinStatus",this.model.userScratchpadOptinActivity.NO_ACTION),this.model.sessionStorage.doesKeyExist("userClosedAlertBox")||this.model.sessionStorage.saveAsJSON("userClosedAlertBox",!1),c=this.model.sessionStorage.readJSONAsObject("numberOfSearches"),a=this.model.sessionStorage.readJSONAsObject("scratchpadOptinStatus"),c>=this.model.SHOW_SCRATCHPAD_MODAL_ON_SEARCHCOUNT&&b.inArray(a,[this.model.userScratchpadOptinActivity.NO_ACTION,this.model.userScratchpadOptinActivity.MAYBE_LATER])===-1&&(this.model.sessionStorage.saveAsJSON("numberOfSearches",0),this.model.sessionStorage.saveAsJSON("scratchpadOptinStatus",this.model.userScratchpadOptinActivity.NO_ACTION),this.model.sessionStorage.saveAsJSON("userClosedAlertBox",!1)),this.model.scratchpadOptinLaterAlert=d.templates.scratchpadOptinLaterAlertTmpl,e=b("#send-me-notes-button"),e.length>0&&(e.attr("data-click-handler","createPriceAlertScratchpadModal,omnitureClickHandler"),e.attr("data-omniture-rfrr","ScratchpadSendSearches.Select"))},removeAlertBox:function(){var a=b("div#alertBox");a.length>0&&(a.empty(),a.addClass("hide")),this.model.sessionStorage.saveAsJSON("userClosedAlertBox",!0)},gotoScratchpadLinkHandler:function(){document.location.href="/scratchpad"},onUpdateOptinStatus:function(a,d){d?a&&(this.model.sessionStorage.saveAsJSON("scratchpadOptinStatus",this.model.userScratchpadOptinActivity.OPTED_IN),b("#OptInValue").length>0&&b("#OptInValue").val("yes"),c.modal.close(),i.isSubscribedToPriceAlerts=!0):a&&c.modal.close()},urlParam:function(a){var b=new RegExp("[?&amp;]"+a+"=([^&amp;#]*)").exec(window.location.href);return null!==b&&b[1]?decodeURIComponent(b[1]):null},isUserOptedIn:function(){return b("#OptInValue").length>0&&"2"===b("#OptInValue").val()},isUserNotOptedIn:function(){return b("#OptInValue").length>0&&("3"===b("#OptInValue").val()||"1"===b("#OptInValue").val()||"0"===b("#OptInValue").val()&&e.scratchpadModal.optinEnabled)},showModal:function(a,b,c){return this.isUserNotOptedIn()&&a===this.model.SHOW_SCRATCHPAD_MODAL_ON_SEARCHCOUNT&&this.model.userScratchpadOptinActivity.MAYBE_LATER!==c},isDifferentSearch:function(a){return this.searchParameters.departure.airport!==a.legSearchInfoList[0].departureLocation||(this.searchParameters.arrival.airport!==a.legSearchInfoList[0].arrivalLocation||(this.searchParameters.departure.date!==a.legSearchInfoList[0].departureDate||(this.searchParameters.arrival.date!==a.legSearchInfoList[0].arrivalDate||(this.searchParameters.numberOfAdults!==a.travelerCategoryInfo.adultCount||(this.searchParameters.numberOfChildren!==a.travelerCategoryInfo.childCount||(this.searchParameters.preferredAirline!==a.airlinePreferenceCode||(this.searchParameters.nonStopOnly!==a.nonstopOnly||this.searchParameters.refundableOnly!==a.refundableFlightsOnly)))))))},shouldShowMaybeLaterBannerWithEventsOnFSR:function(){var a=k.getVariant(10538);return 1!==a&&3!==a}};return b(function(){g.addHandler("removeAlertBox",l.removeAlertBox,l),g.addHandler("gotoScratchpadLinkHandler",l.gotoScratchpadLinkHandler,l)}),a.ScratchpadModal=l,l}),define("omnitureClickHandler",["flights","jquery","analytics","fluxClickHandler","globalWizard"],function(a,b,c,d,e){"use strict";function f(a,d){var f=b(a),g=f.attr("data-omniture-rfrr"),h=g;void 0!==g&&(g.indexOf("NEARBY")!==-1&&(e.searchParameters.nearbyAirportInteraction=!0),"FLT.SR."!==h.substring(0,7)&&"PKG.FSR."!==h.substring(0,8)&&(h="FLT.SR."+h),c.trackAction(h,f[0]))}return b(function(){d.addHandler("omnitureClickHandler",f)}),{}}),require(["omnitureClickHandler"]),define("progress",["flights","jquery","uitk"],function(a,b,c){"use strict";var d={},e={primaryText:"",secondaryText:"",showAd:!1,showSearchHistoryMsg:!1};return d.element="#progressAlert",d.showUntilEvent=function(a,b){"string"==typeof a&&(c.subscribe(a,function(){d.hide()}),d.show(b))},d.show=function(a){var c=b("<div />").attr("id","progressMask");c.appendTo("body").show(),b(d.element).show(),b(a).show()},d.hide=function(){b(d.element).hide().find("h3").hide(),b("#progressMask").remove()},d.fadePage=function(){b(".site-content").addClass("page-fade")},d.unfadePage=function(){setTimeout(function(){b(".site-content").removeClass("page-fade"),b(d.element).hide().find("h3").hide()},510)},d.showOnPageInterstitial=function(a){c.publish("results.changed",{disable:!0,message:a,showLoader:!1}),b("#bCol").addClass("overlay"),b("#bCol :button").attr("disabled",!0)},d.showInterstitial=function(a){var c=b.extend({},e,a),d=b("#interstitial"),f=b("#flightModuleList");d.removeClass("progressive-interstitial"),b("#noflightsfoundfilter").hide(),d.find(".progress-bar").hide(),""!==c.primaryText&&d.find(".primary-msg").text(c.primaryText).show(),""!==c.secondaryText&&d.find(".secondary-msg").text(c.secondaryText).show(),c.showAd===!0&&d.find(".ad").show(),c.showSearchHistoryMsg===!0&&d.find(".search-msg").show(),d.find(".loader").css("display","inline-block"),b("#feedbackAndImprovements").hide(),f.hide(),d.show()},d.hideInterstitial=function(){var a=b("#interstitial"),d=b("#flightModuleList");a.hide(),d.show(),b("#feedbackAndImprovements").show(),a.find(".primary-msg, .secondary-msg").text(""),a.find(".ad, .search-msg").hide(),c.publish("results.complete"),b("#bCol").removeClass("overlay"),b("#bCol :button").removeAttr("disabled")},a.Progress=d,d}),define("routeHappyCollection",["flights","backbone","underscore","uiModel","sitebrand","experiments","dctk/dctk"],function(a,b,c,d,e,f,g){"use strict";function h(a){g.logging.logMessage("RouteHappyAjaxFailed",{statusCode:a.xhr.status,responseText:a.xhr.responseText})}function j(a){var d={id:a.id,legs:new b.Collection};if(a.overviewList)return c.each(a.overviewList.overview,function(a){"SCORE"===a.name&&(d.rating={score:a.value,description:a.description})}),c.each(a.legContentList.legContent,function(a){d.legs.push(k(a))}),d}function k(a){var b={id:a.id};return c.each(a.overviewList.overview,function(a){"SCORE"===a.name&&(b.rating={score:a.value,description:a.description})}),b.amenities=l(a),b}function l(a){var b=a.segmentContentList.segmentContent,d={entertainmentCount:0,wifiCount:0,powerCount:0,segmentCount:0};return c.each(b,function(a){d.segmentCount+=1,c.each(a.amenityList.amenity,function(a){if(a.availability)switch(a.name){case"ENTERTAINMENT":d.entertainmentCount+=1;break;case"WIFI":d.wifiCount+=1;break;case"POWER":d.powerCount+=1}})}),d}function m(){var l,r,s,b=a.collections.legsCollection.models[0].attributes,f=0,g={},h={},i={},j={},k={},m=[],o={},p={},q={};q=d.viewableOffers.models,g.messageInfo={},g.experimentInfo={},g.messageInfo.tpid=e.tpid,g.messageInfo.eapid=e.eapid,g.messageInfo.tuid=-1,g.experimentInfo.id=null,g.experimentInfo.groupId=null,g.experimentInfo.value=null,g.richInfoList={},g.richInfoList.richInfo=[],j.id="1",j.searchContext={},q.length>0&&"undefined"!==q[0].attributes&&"undefined"!==q[0].attributes.legIds&&q[0].attributes.legIds.length>1?j.searchContext.tripGeometry="ROUNDTRIP":j.searchContext.tripGeometry="ONEWAY",j.searchContext.flightCriteria={},j.searchContext.flightCriteria.airTravelerCategoryList={},j.searchContext.flightCriteria.airTravelerCategoryList.airTravelerCategory=[],h.airTravelerCategoryCode="adult",h.airTravelerCategoryCount=a.Wizard.searchParameters.adultTraveler,i.airTravelerCategoryCode="child",i.airTravelerCategoryCount=a.Wizard.searchParameters.childTraveler,j.searchContext.flightCriteria.airTravelerCategoryList.airTravelerCategory.push(h),j.searchContext.flightCriteria.airTravelerCategoryList.airTravelerCategory.push(i),j.odlist={},j.odlist.od=[],c.each(q,function(a){var d=a.attributes,e=d.legIds[0],g=d.legIds[1];!0!==a.get("bargainOffer")&&(k={},o={},k.id=d.naturalKey,k.legList={},k.legList.leg=[],c.each(b,function(a){if(a.naturalKey===e||a.naturalKey===g){var b={};a.naturalKey===e?b.id=e:b.id=g,b.airFareCategoryCode=a.price.flightFareTypeCode,b.airProviderCode=a.carrierSummary.airProviderId,o.id=b.id,o.isClickToPrice=!d.price.hasFare,b.segmentList={},b.segmentList.segment=[],c.each(a.timeline,function(a){r=void 0,s=void 0,a.segment&&(p={},r=a.departureTime.travelDate,"string"==typeof r&&r.indexOf("/")>-1&&(s=r.split("/"),r=(parseInt(s[2],10)+2e3).toString()+"-"+s[0]+"-"+s[1]),p.id=""+f,p.carrierCode=a.carrier.airlineCode,p.operatingCarrierCode=""!==a.carrier.operatedByAirlineCode?a.carrier.operatedByAirlineCode:a.carrier.airlineCode,p.flightNumber=a.carrier.flightNumber,p.bookingCode=$.trim(a.carrier.bookingCode),p.flightCriteria={},p.flightCriteria.origin=a.departureAirport.code,p.flightCriteria.destination=a.arrivalAirport.code,p.flightCriteria.date=r,l=a.carrier.cabinClass,p.flightCriteria.cabinClass=n(l),b.segmentList.segment.push(p),f+=2)}),k.legList.leg.push(b),f=0}}),j.odlist.od.push(k),m[k.id]=o)}),g.richInfoList.richInfo.push(j);var u={};return u.requestObject=g,u.ctpObject=m,u}function n(a){var b={1:"FIRST",2:"BUSINESS",3:"ECONOMY",5:"PREMIUM_COACH"};return void 0===b[a]?"COACH":b[a]}var i=b.Collection.extend({url:"/flights/getrichcontent/v4",parse:function(a,b){var e,d=[];return"object"!=typeof a||null===a.richInfoContentList||void 0===a.richInfoContentList?(h(b),[]):(e=a.richInfoContentList.richInfoContent[0].odcontentList.odcontent,c.each(e,function(a){var b=j(a);void 0!==b&&d.push(b)}),d)},fetchRouteHappy:function(){var b=this.getRequest(),c=b.requestObject;c.richInfoList.richInfo[0]&&c.richInfoList.richInfo[0].odlist&&c.richInfoList.richInfo[0].odlist.od&&c.richInfoList.richInfo[0].odlist.od.length>0&&this.fetch({data:JSON.stringify(c),type:"POST",contentType:"application/json",timeout:5e3,success:function(b){return a.vent.trigger("routeHappyCollection.fetchRouteHappy.success",b),b},error:function(a,b,c){h(c)}})},getRequest:m,getCabinClass:n});return i}),define("legsCollection",["flights","legModel","backbone","underscore"],function(a,b,c,d){"use strict";function f(a,b){d.each(a,function(a){var c=b.get(a);void 0!==c&&(c.isSelected=!0)})}var e={};return c.Collection.extend({model:b,initialize:function(){var a=this;a.listenTo(this,"change",function(){f(e,this.models[0])})}})}),define("offersCollection",["offerModel","backbone"],function(a,b){"use strict";return b.Collection.extend({model:a})}),define("airlineFiltersCollection",["airlineFiltersModel","backbone"],function(a,b){"use strict";return b.Collection.extend({model:a})}),define("airportFiltersCollection",["airportFilterModel","backbone"],function(a,b){"use strict";return b.Collection.extend({model:a})}),define("legModel",["flights","backbone"],function(a,b){"use strict";return b.Model.extend({})}),define("offerModel",["flights","backbone"],function(a,b){"use strict";return b.Model.extend({})}),define("paginationModel",["flights","configuration","backbone","i18n"],function(a,b,c,d){"use strict";return c.Model.extend({defaults:{topLink:!0,totalNumberOfResults:100,currentFirstResult:1,currentPageNumber:1,numberOfResultsPerPage:b.pagination.numOffersPerPage,messageTemplate:d.paging.accessibility.searchingForPage,name:"Pagination"}})}),define("singlePageModel",["backbone","jquery"],function(a,b){"use strict";return a.Model.extend({initialize:function(){this.set(JSON.parse(b("#singlePageModel").html()))}})}),define("ajaxErrorModel",["flights","backbone"],function(a,b){"use strict";var c=b.Model.extend({defaults:{options:{}},ERROR_CODES:{NO_FLIGHTS_FOUND:"NFF",TIMEOUT:"timeout",UNKNOWN_ERROR:"ERR",MIS_ERROR:"MIS ERR"},FAILING_PRODUCT:{12940:"flight",13365:"hotel",13497:"car"},resetToDefaults:function(){this.clear({silent:!0}).set(this.defaults)}});return new c}),define("cacheModel",["flights","backbone"],function(a,b){"use strict";return b.Model.extend({cache:{},putEntry:function(a,b){this.cache[a]=b},getCachedEntry:function(a){return this.cache[a]},containsEntry:function(a){return void 0!==this.cache[a]}})}),define("filtersModel",["backbone","underscore"],function(a,b){"use strict";function c(a){return{nonstop:"0","1stop":"1","2stop":"2"}[a]}function d(a){return{EARLYMORNING:"em",MORNING:"m",AFTERNOON:"a",EVENING:"e"}[a]}function e(a){return b.chain(a.filterSet).where({checked:!0}).pluck(a.pluckValue).map(a.mapFunction).value().join(",")}function f(a){var c={};return b.each(a.filterSet,function(d,f){c[a.filterKey+f]=e(b.extend(a,{filterSet:d}))}),c}return a.Model.extend({retrieveActiveFilters:function(){var a,g,h,i,j={};return g=e({filterSet:this.get("airlineFilters"),pluckValue:"airlineCode",mapFunction:function(a){return a}}),h=e({filterSet:this.get("stopFilters"),pluckValue:"filterName",mapFunction:c}),i=f({filterSet:this.get("arrivalAirportFilters"),filterKey:"fad",pluckValue:"airportCode",mapFunction:function(a){return a}}),b.extend(j,f({filterSet:this.get("arrivalTimeFilters"),filterKey:"fr",pluckValue:"filterName",mapFunction:d})),b.extend(j,f({filterSet:this.get("departureTimeFilters"),filterKey:"fd",pluckValue:"filterName",mapFunction:d})),a={fa:g,fs:h},b.extend(a,i),b.extend(a,j),b.extend(a,this.get("legFilters")),b.omit(a,function(a){return""===a})}})}),define("stopFiltersModel",["backbone"],function(a){"use strict";return a.Model.extend({defaults:{0:{count:0,enabled:!1,price:{amount:0,formatted:""}},1:{count:0,enabled:!1,price:{amount:0,formatted:""}},2:{count:0,enabled:!1,price:{amount:0,formatted:""}}}})}),define("airlineFiltersModel",["backbone"],function(a){"use strict";return a.Model.extend({})}),define("airportFilterModel",["backbone"],function(a){return a.Model.extend({})}),define("filterItemModel",["backbone"],function(a){"use strict";return a.Model.extend({})}),define("sortBarModel",["i18n","backbone","configuration"],function(a,b,c){"use strict";return b.Model.extend({retrieveActiveSort:function(){return{type:this.get("type"),direction:this.get("direction")}},defaults:{interstitialMessage:a.sorting.interstitial.generic,type:c.loyalty.partnerPointsEnabled?"so":"sp",direction:"asc"}})}),define("applicationViewLogging",["flights","dctk/dctk"],function(a,b){"use strict";function d(a,b,c){var d=!0,e=0;if(void 0!==b&&b.length>0){for(var f=0;f<b.length;f++)b[f].name.indexOf("GulfstreamRequest")>-1&&(d=!1,e=b[f].value);a.push("resultsFromCache="+d),e>0&&c>e&&a.push("totalNonGSTime="+(c-e))}}var c={lastRetrievedOmnitureData:null,getNavStartTime:function(){var a;return window.performance&&window.performance.timing?a=window.performance.timing.navigationStart:b.logging.pageStartTime&&(a=b.logging.pageStartTime),a},getNowTime:function(){return(new Date).getTime()},logEvent:function(a,c,d){b.logging.logTrxEvent("flightSearch",["clEventName01="+a,"clEventTime01="+(d-c)])},logEventForAjax:function(a,b,c,d){var e,f;window.performance&&"function"==typeof window.performance.getEntriesByName&&(f=window.location.protocol+"//"+window.location.host+b,e=window.performance.getEntriesByName(f),e.length&&e[0].startTime&&e[0].responseEnd&&(c=e[0].startTime,d=e[0].responseEnd)),this.logEvent(a,c,d)},generateListingOmnitureString:function(a){var b="";return b+=(a.splitTicket?"Y":"N")+"|",b+=(a.bargainOffer?"Y":"N")+"|",b+=a.price.flightFareTypeCode+"-"+a.price.flightFareTypeValue+"|",b+=a.legs[0].stops+"|",b+=a.bestValue?"bestValue":a.cheapest?"cheapest":a.shortest?"shortest":""},logPerformanceModelResults:function(e,f){var g,h,i,k,l,j=[];return void 0===e||void 0===e.metaData||void 0===e.metaData.map?void a.log("`response` is undefined."):(l=e.metaData.map.performanceModel,void 0===l||null===l?void a.log("`response` is invalid: `performanceModel` is undefined."):void 0===e.content||null===e.content.omniture?void a.log("`response` is invalid: property `content` is undefined or `omniture` is null."):void 0===f?void a.log("`options` is undefined."):(g=l.entries,h=e.content.omniture.json,i=f.data.is,""!=h?(h=JSON.parse(h),this.lastRetrievedOmnitureData=h):h=this.lastRetrievedOmnitureData,j.push("totalTime="+l.totalTime),j.push("tag="+l.tag),j=c.buildPerfEventLogArray(g,j),k=c.formatAbacusList(h),j.push("abacusBuckets="+k),j.push("isInitialSearch="+(1===i)),d(j,g,l.totalTime),j.push("staticPage=false"),void b.logging.logTrxEvent("performanceMetrics",j)))},buildPerfEventLogArray:function(a,b){for(var c=b||[],d=0;d<a.length;d++)c.push(a[d].name+"="+a[d].value);return c},formatAbacusList:function(a){return null===a?null:a.omnitureProperties.list1.replace(/\|/g,":")}};return c}),define("applicationView",["backbone","marionette","underscore","flights","jquery","uitk","dctk/dctk","applicationViewLogging","legsCollection","singlePageModel","filtersView","filtersModel","paginationView","paginationModel","ajaxErrorView","sortBarView","sortBarModel","staleDataModalView","feedback","analytics","xSellBannerView","scratchpadModal","cacheModel","i18n","configuration","airAttachModel","crossSellModel","universalDataObjectAjaxUtils","flightDeltaView","progress","priceAlert","cachedOfferListView","experiments","liveAnnounceDispatcher","wizardView","wizardModel","uiModel","offersCollectionView","pageCriteriaController","pageNameTracker","mixedCabinClassMessageView","sitebrand"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P){"use strict";function Q(a,b,c){var d=b.get("departureAirportCode"),e=b.get("arrivalAirportCode"),f=b.get("departureISODate"),h=b.get("arrivalISODate"),i=c.attributes.travelerPreferences.get("numberOfAdults"),j=c.attributes.travelerPreferences.get("numberOfChildren"),k=g._eapid,l=g._tpid;g.logging.logTrxEvent("jsonCacheResult",["exactCacheHit="+(a?1:0),'originAirport="'+d+'"','destinationAirport="'+e+'"','departureDate="'+f+'"','returnDate="'+h+'"','adultCount="'+i+'"','childCount="'+j+'"',"eapid="+k,"tpid="+l])}return a.View.extend({model:K,singlePageModel:new j,fetchTimeout:30,interstitial:{$acol:e("#acol-interstitial"),$outboundSpinner:e("#outboundSpinner"),$pi:e("#pi-interstitial")},fetchOrigin:"InitialSearch",disableFormControls:function(){this._setFormControlState("disable")},enableFormControls:function(){this._setFormControlState("enable")},_setFormControlState:function(a){var b=[this.sortBarView,this.paginationView,this.filtersView];e.each(b,function(b,c){void 0!==c&&"function"==typeof c[a]&&c[a]()})},fetchCached:function(a){var c,m,n,o,p,b=this,i=b.singlePageModel.get("isPriceChanged"),j=b.singlePageModel.get("emailTime"),k=b.singlePageModel.get("emailPrice"),l=h.getNowTime();b.disableFormControls(),m=e("#cachedResultsJson").html(),""===m?(t.updateOmnitureProperty("prop63","FLT.SR.Cache.Miss"),Q(!1,b.singlePageModel,b.wizardView.model)):(b.interstitial.$outboundSpinner.hide(),n=JSON.parse(m),o=b.helpers.extractContent(n),b.helpers.updateLegsCollection(o.legs),2!==G.getVariant(13347)&&b.helpers.updateFilters(b.filtersView,o.summary),G.execute("FILTERS_EXPERIMENTS",{legs:o.legs,offers:o.offers}),p="siteid-locale-dlc-rlc-dd-rd"===n.metaData.map.contentTitle,Q(p,b.singlePageModel,b.wizardView.model),y.perceivedInstantEnabled&&!0===p?(K.addCacheInfo(o,{isCached:!0,freshness:n.metaData.map.timeStampMs}),K.loadContentModel(o),f.utils.liveAnnounce(x.sorting.accessibility.sortedByPrice),K.setCacheType("Cache.ExactMatch"),
!y.shouldRenderCachedOffersServerSide&&g&&g.ewePerformance&&(g.ewePerformance.mark("renderCachedOffers"),g.ewePerformance.markPageUsable()),G.execute("FSR_CachedListings_InfoCombos")):(c=b.helpers.getProcessedOffers(o.index,o.offers,n.metaData.map.timeStampMs,void 0,void 0,o.partnerLoyaltyDataMap),F.setOffers({offers:c}),"true"===i&&""!==j&&""!==k&&b.helpers.updateTimeAndPriceDiffToOmnitureProperty(b.flightDeltaView.getCheapestPriceOfCurrentSearch(o),j,k)),d.vent.trigger("applicationView.cachedResultsComplete",o),h.logEvent("FLUX_TimeToDisplayCachedResults",h.getNavStartTime(),h.getNowTime()),h.logEvent("FLUX_CachedResultsRenderedDuration",l,h.getNowTime()),a&&a.callbacks&&"function"==typeof a.callbacks.success&&a.callbacks.success(b)),a&&a.callbacks&&"function"==typeof a.callbacks.complete&&a.callbacks.complete(b),G.execute("FSR_Redesigned_Filters_Update_For_v2",{appView:b,cachedContent:o}),G.execute("Delayed_Wizard_Experiments",b.wizardView)},helpers:{getProcessedOffers:function(a,b,c,d,f,g){var h=0,i=!0,j=[],k=this;return e.each(a,function(a,e){var l=b[e];l.index=h,h+=1,l.freshnessTime=c,l.resultNumber=h,l.firstNonEbf=i&&!l.bargainOffer,l.firstNonEbf&&(i=!1),l.packageable&&f&&(l=k.setPackagedAnchorPrice(l,f.perPersonPrice)),l.resultToken=d,g&&g[e]&&(l.partnerLoyaltyValue=g[e][0]),j.push(l)}),j},setPackagedAnchorPrice:function(a,b){var c=a;return c.price.anchoredPrice=b,c},updateLegsCollection:function(a){d.collections.legsCollection.set(a),d.collections.legsCollection.trigger("change")},updateTimeAndPriceDiffToOmnitureProperty:function(a,b,c){var d=c-Math.round(a),e=(new Date).getTime(),f=parseInt((e-b)/6e4,10),g=f+"|"+d;t.updateOmnitureProperty("prop62",g)},updateFilters:function(a,b){"object"==typeof b&&"object"==typeof b.filters&&y.filters.enabled&&a.model.set(b.filters)},extractContent:function(a){return void 0===a.content?a:(this.updateOmnitureWithCacheType(a.metaData),JSON.parse(a.content))},updateOmnitureWithCacheType:function(a){var c,d,b={"siteid-locale-dlc-rlc-ddw-rdw":"FLT.SR.Cache.PartialMatch.ODDepartureAndReturnDay","siteid-locale-dlc-rlc-ddw":"FLT.SR.Cache.PartialMatch.ODDepartureDay","siteid-locale-dlc-rlc":"FLT.SR.Cache.PartialMatch.ODOnly","siteid-locale-dlc-alc-ddw":"FLT.SR.Cache.PartialMatch.ODDepartureDay","siteid-locale-dlc-alc":"FLT.SR.Cache.PartialMatch.ODOnly","siteid-locale-dlc-rlc-dd-rd":"FLT.SR.Cache.ExactMatch"},e="FLT.SR.Cache.Unknown";void 0===a&&null===a||(c=a.map,d=c.contentTitle,void 0!==b[d]&&(e=b[d]),t.updateOmnitureProperty("prop63",e))}},initializeRouteHappy:function(){var a=this;require(["routeHappyView","routeHappyCollection","seatAmenitiesView"],function(b,c,e){a.routeHappyCollection=new c,a.routeHappyView=new b({renderOnEachUpdate:!0,useLegLevelInfo:!0===y.route.isRoundTrip,getOfferElement:function(b){return a.offersCollectionView.getOfferElement(b)}}),(y.route.isRoundTrip||y.route.isOneWay)&&(a.seatAmenitiesView=new e({getOfferElement:function(b){return a.offersCollectionView.getOfferElement(b)}})),d.vent.on("uiModel.resetViewableOffers",function(b){d.vent.once("routeHappyCollection.fetchRouteHappy.success",function(c){a.routeHappyView.renderRouteHappyInfo(b,c),a.seatAmenitiesView&&a.seatAmenitiesView.render(c)}),a.routeHappyCollection.fetchRouteHappy()})})},initializeFilters:function(){var a=this;a.filtersModel=new l,y.filters.enabled&&(a.filtersView=new k({appView:a,singlePageModel:a.singlePageModel,filtersModel:a.filtersModel,shouldSaveCheckedState:!y.view.isByot}))},createChildViews:function(){var a=this,b=e.parseJSON(e("#wizardData").html()),c=1===G.getVariant(13634),d=G.getVariant(13633)>=1;a.wizardView=new I({model:new J(b),routeTypeSwitch:{enabled:!y.isFCShoppingMode,showOneway:!0,showRoundtrip:!0,showMultiDest:y.wizard.showMultiDestRadioButton},showNearbyAirports:!y.isFCShoppingMode&&y.wizard.showGDSFlightExtraOptions&&y.wizard.airAsiaGDS,showRefundable:!y.isFCShoppingMode,showAdditionalOptions:y.wizard.showAdditionalOptions,showToggleSummaryAdditionalOptions:y.wizard.showGDSFlightExtraOptions,airportsDropDown:{enabled:!y.wizard.airAsiaGDS,options:window.dropDownJSON},showNonstop:!0,showPreferredAirlines:!0,showPreferredCabinClass:!0,airportFieldClearButtonEnabled:!0,showWizardForPackages:y.isFCShoppingMode,renderOnInit:!d&&!c}),a.ajaxErrorView=new o({appView:a}),a.sortBarModel=new q,a.sortBarView=new p({appView:a,model:a.sortBarModel}),a.paginationModel=new n,a.paginationView=new m({appView:a,model:a.paginationModel}),G.execute("FSR_Redesigned_Filters",a),a.initializeFilters(),G.execute("FSR_Mobile_FilterFlyOut",{viewDependencies:{appView:a,singlePageModel:a.singlePageModel,filtersModel:a.filtersModel,shouldSaveCheckedState:!y.view.isByot}}),a.pageCriteriaController=new M({filtersModel:a.filtersModel,sortModel:a.sortBarModel,paginationModel:a.paginationModel,routerEnabled:y.view.isByot}),y.loyalty.partnerPointsEnabled&&y.loyalty.displayPointsMessaging&&require(["partnerLoyaltyMessagingView"],function(b){a.partnerLoyaltyMessagingView=new b}),a.flightDeltaView=new C,!0===y.view.isByot&&require(["setupRouter","selectedDepartureModel","selectedDepartureView","PageTitleModel","PageTitleView"],function(b,c,d,e,f){var g=b();y.isFlexibleShoppingEnabled||(a.selectedDepartureView=new d({model:new c,router:g})),a.pageTitleView=new f({model:new e({useChangeMessaging:y.userSelectsChangeFlight})})}),a.mixedCabinClassMessageView=new O({selectedCabin:parseInt(b.travelerPreferences.seatingClass,10),cabinClassList:b.travelerPreferences.seatingClassList}),y.loyalty.partnerPointsEnabled&&y.loyalty.partnerPointsToggle&&require(["partnerLoyaltyToggleModel","partnerLoyaltyToggleView"],function(b,c){a.partnerLoyaltyToggleView=new c({model:new b})}),y.priceTrends.enabled&&require(["priceTrendsView"],function(b){a.priceTrendsView=new b})},setupCrossSellModels:function(){var a=this;a.crossSellModel=new A,a.airAttachModel=new z({singlePageModel:a.singlePageModel,crossSellModel:a.crossSellModel})},setupPageNameTracker:function(a,b,c){N.trackPageName(b,c),!0===y.view.isByot&&N.trackByotPageName(b,c)},updateOmniture:function(a){"ACCEPT"===a.omniture.status&&t.updateOmnitureData(e.parseJSON(a.omniture.json)),t.updateOmnitureProperty("prop52",h.generateListingOmnitureString(a.offer)),a.offer.discount>0?t.updateOmnitureProperty("events","event12,event54,event203"):t.updateOmnitureProperty("events","event12,event54")},setupCrossSellForLiveOffers:function(a,b){var c=this;y.xsell.hotel.enabled&&(c.xSellBannerView=new u({model:a,searchResultsModel:b,href:y.xsell.hotel.defaultHref,bannerText:y.xsell.hotel.defaultBannerText}),y.xsell.hotel.livePricing.enabled&&c.xSellBannerView.isEnabled()&&c.airAttachModel.getResults(b))},notifyPageModel:function(){if(y.isFlightUrgencyEnabled&&!y.isMobilePerfComparison)if(y.isFSREventsEnabled)G.execute("EVENTSONFSR.MODAL",{});else{var a=this;require(["flightNotifier"],function(b){b.notify({dtla:a.singlePageModel.get("arrivalAirportCode"),clientId:y.isFlexibleShoppingEnabled?"pkgfsr":"fsr",brandName:P.brandname})})}},setupDomRefresh:function(a){var b=this;b.listenTo(a,"dom:refresh",function(){b.enableFormControls()})},fetchLiveOffers:function(a){var b=this,c=K.getCacheType();E.initialize({departureAirport:b.wizardView.model.attributes.trips.first().get("departure").get("code"),departureDate:b.wizardView.model.attributes.trips.first().get("departure").get("date").get("shortFormat"),arrivalAirport:b.wizardView.model.attributes.trips.first().get("arrival").get("code"),arrivalDate:b.wizardView.model.attributes.trips.first().get("arrival").get("date").get("shortFormat"),dateFormat:d.Model.Wizard.calendar.dateFormat}),b.setupPageNameTracker(y,d,K),h.logEvent("FLUX_uiModel_AjaxStartTime",h.getNavStartTime(),h.getNowTime()),G.execute("PERCEIVED_INSTANT_ON_RT"),K.getPage(function(e){f.utils.liveAnnounce(x.sorting.accessibility.sortedByPrice),!1===e.isEmpty()&&b.setupCrossSellForLiveOffers(a.crossSellModel,K),f.publish("Flights.ModuleBuilder.Controller.renderComplete"),b.notifyPageModel(),d.vent.trigger("applicationView.initialSearchSuccess",{appView:b}),b.staleDataModalView=new r({model:K}),s.showLink(),y.isMobilePerfComparison||require(["ads"],function(a){a.show()}),E.priceChangeAlertReset(),g&&g.ewePerformance&&(g.ewePerformance.mark("renderLiveOffers"),"Cache.ExactMatch"!==c&&g.ewePerformance.markPageUsable()),t.updateOmnitureProperty("prop1",b.paginationView.model.get("totalNumberOfResults").toString()),t.trackPageLoad(),h.logEvent("FLUX_uiModel_TotalSearchTime_success",h.getNavStartTime(),h.getNowTime())})},makeInitialRequest:function(){var a=this;g&&g.ewePerformance&&g.ewePerformance.mark("pageDataRequested"),window.promiseCache?window.promiseCache.then(function(b){e("#originalContinuationId").text(b.continuousSessionId),e("#cachedResultsJson").text(b.cachedJson),a.fetchCached({origin:a.fetchOrigin+"Cached",callbacks:{complete:function(){y.shouldRenderCachedOffersServerSide&&a.setupInitialOffers(),a.sortBarView.enable()}}})}):a.fetchCached({origin:a.fetchOrigin+"Cached",callbacks:{complete:function(){y.shouldRenderCachedOffersServerSide&&a.setupInitialOffers(),a.fetchLiveOffers({crossSellModel:a.crossSellModel})}}})},setupFlightModules:function(a){var c=new b.Application;c.on("before:start",function(){var a=b.LayoutView.extend({el:".site-content",regions:{flightModuleList:"#flightModuleList"}});c.regions=new a}),c.start(),c.regions.flightModuleList.show(a)},setupInitialOffers:function(){var b,c,d,a=this;!0===y.view.isByot&&(require(["setupRouter"],function(a){b=a()}),d=e("#listings-header")),c=new L({collection:K.viewableOffers,router:b,$listingsHeader:d}),a.setupFlightModules(c),a.setupDomRefresh(c),a.offersCollectionView=c},initialize:function(){var a=this;d.vent.trigger("applicationView.applicationStart"),G.execute("FSR_Mobile_ColumnStyleListings"),G.execute("FSRMobileSlimListings",{}),g&&g.ewePerformance&&g.ewePerformance.mark("applicationStart"),y.shouldRenderCachedOffersServerSide||a.setupInitialOffers(),a.createChildViews(),d.collections.legsCollection=new i,y.xsell.hotel.enabled&&a.setupCrossSellModels(),v.initialize({departure:{airport:a.wizardView.model.attributes.trips.first().get("departure").get("airport"),date:a.wizardView.model.attributes.trips.first().get("departure").get("date").get("shortFormat")},arrival:{airport:a.wizardView.model.attributes.trips.first().get("arrival").get("airport"),date:a.wizardView.model.attributes.trips.first().get("arrival").get("date").get("shortFormat")},numberOfAdults:a.wizardView.model.attributes.travelerPreferences.get("numberOfAdults"),numberOfChildren:a.wizardView.model.attributes.travelerPreferences.get("numberOfChildren"),preferredAirline:a.wizardView.model.attributes.travelerPreferences.get("preferredAirline"),nonStopOnly:a.wizardView.model.attributes.travelerPreferences.get("nonstopOnly"),refundableOnly:a.wizardView.model.attributes.travelerPreferences.get("refundableOnly")}),t.initializeOmnitureData(),a.makeInitialRequest(),y.routeHappyEnabled&&a.initializeRouteHappy(),H.initialize(),d.vent.trigger("applicationView.initialized",{appView:a}),G.execute("BAGGAGECALCULATOR.MODAL",{}),G.execute("REASSURANCEINXSELL.MODAL",{}),G.execute(G.events.FLUX_INITIALIZE,{})}})}),define("cachedOfferListView",["flights","jquery","uitk","cachedOfferView","offersCollection","backbone","configuration","uiModel","experiments"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){if(!("number"!=typeof a||"number"!=typeof b||a>=b))return a+Math.floor(Math.random()*(b-a+1))}return new(f.View.extend({tagName:"ul",collection:new e,config:{chunkSize:3,baseTimeout:25,animationSpeed:750},hide:function(){this.$el.hide()},initialize:function(){var c=this;c.setElement(b("#cachedOfferList")),c.listenTo(c.collection,"change",function(){c.render()}),c.listenTo(h,"responseError",c.hide),c.listenTo(h,"noFlightsFound",c.hide),c.listenTo(a.vent,"uiModel.resultsFetchFailure",c.hide)},setOffers:function(a){i.execute("FSR_Rewritten_Cached_Offer_List_View",this),g.view.isByot&&_.each(a.offers,function(a){a.legIds=[a.legIds[0]]}),this.collection.set(a.offers),this.collection.trigger("change")},render:function(){var e,f,h,c=this,g=[],k=c.collection.last(c.collection.length).reverse();if(c.$el.empty(),i.execute("FSR_OW_PARTIAL_MATCH_NO_ANIMATION",{cachedOfferCollection:k,container:c.$el}),!(i.getVariant(13326)>0)){for(_.each(k,function(a){var b,c={model:a},e=a.get("bargainOffer");e||(b=new d(c),g.push(function(a){return function(){return a.el}}(b.render())))}),e=0,h=c.config.baseTimeout;e<g.length;e+=c.config.chunkSize,h+=j(1e3,1500))f=g.slice(e,e+c.config.chunkSize).reverse(),setTimeout(function(d){return function(){var e=b("<div />");b.each(d,function(a,b){e.append(b())}),b(e).hide().prependTo(c.$el).slideDown(c.config.animationSpeed),c.collection.trigger("cacheChunkRendered",{}),a.vent.trigger("cachedOfferListView.cacheChunkRendered",{cachedOfferListView:c,config:c.config})}}(f),h);b("#cachedResultsJson").attr("data-test-id","cacheRendered")}}}))}),define("listItemView",["flights","jquery","underscore","backbone","loyaltyPointsCollection","loyaltyPointsView","flexibleShoppingLoyaltyEarnView","experiments","sitebrand","basicEconomyView","detectizr"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a){var b;return a.freeFlightPromotionContent&&a.freeFlightPromotionContent.sticker&&(b=a.freeFlightPromotionContent.sticker),null!==b&&("SuperSaverPromotion"===b||"FreeFlightPromotion"===b)}function m(a){var b;return!(!a.freeFlightPromotionContent||!a.freeFlightPromotionContent.sticker||(b=a.freeFlightPromotionContent.sticker,"SuperSaverPromotion"!==b))}function n(a){var b=[];return void 0!==a&&(a.bestValue&&b.push("BV"),a.cheapest&&b.push("CP"),a.shortest&&b.push("ST")),b.join()}function o(a){var b=[];return a.bestPrice&&b.push("BP"),a.bestDuration&&b.push("BD"),a.bestTimeOfDay&&b.push("BTOD"),b.join("|")}function p(a){var b=!1,d=!a.bargainOffer;return c.each(a.legs,function(a){a.price.feesMessage&&a.price.feesMessage.isShowFreeCancellation&&a.price.feesMessage.matchDataAirProvider&&d&&(b=!0)}),b}return d.View.extend({id:function(){return"flight-module-"+this.model.get("naturalKey").replace(/;/g,"_")},tagName:"li",loyaltyView:null,createLoyalty:function(a){a.naturalKey=a.naturalKey.replace(/::/g,":"),e.isLoyaltyOfferEnabled&&(e.isFlexibleShoppingEnabled?(this.loyaltyView=new g({model:e,offer:a,el:this.el,loyaltyInfo:e.loyaltyInfo}),h.execute("OrbitzPromoTimer",a)):this.loyaltyView=new f({model:e,offer:a,el:this.el,loyaltyInfo:e.loyaltyInfo}))},createBasicEconomy:function(a){var b="mobile"===k.device.type,c="80001"===i.siteid;if((!c||!b)&&void 0!==a.legs[0].basicEconomy&&a.legs[0].basicEconomy.enabled){var d=this.$el.find(".basic-economy-main");this.basicEconomyView=new j({$basicEconomyElement:d,rules:a.legs[0].basicEconomy.rules})}},attributes:{"data-is-split-ticket":"splitTicket","data-discount":"discount","data-is-packageable":"packageable"},getFullOfferModel:function(c){var d={legs:[]},e=[];b.extend(!0,d,c.model.toJSON()),b.each(d.legIds,function(b,c){var f=a.collections.legsCollection.models[0].get(c);return void 0===f?"continue":(d.legs[b]=f,void e.push(f.identity.index))}),d.naturalKey=d.naturalKey.replace(/:/g,"::"),d.numLegs=d.legs.length,d.superlatives=n(d),d.dpsDimensions=o(d),d.freeFlightPackagePromotionSticker=l(d),d.freeFlightPackagePromotionSuperSaverType=m(d);var f=["1255","1256","1257","2000","2001","2002","2004","2023"],g=i.siteid;return f.indexOf(g)>-1&&(d.freeFlightPackagePromoRed=!0),void 0===d.legIndexList&&(d.legIndexList=e.join(",")),d},getNestedAttributesFromOffer:function(a,b,d){return c.chain(a.legs).pluck(b).pluck(d).value().join(",")},getMarkup:function(a,b){return this.template({module:a,showFreeCancelForOffer:b})},render:function(){var d,a=this.getFullOfferModel(this),c=p(a),e=this;return b.each(e.attributes,function(a,b){e.$el.attr(a,e.model.get(b))}),d=this.getMarkup(a,c),this.$el.html(d),this.createBasicEconomy(a),this.createLoyalty(a),this}})}),define("standardOfferView",["backbone","jquery","handlebars","listItemView","standardOfferDetailsView","baggageFeeView","configuration","underscore"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){return void 0===a||null===a||""===a}function j(a){var b,c,d;if(b=g.isFlexibleShoppingEnabled===!0,c=[],b){if(c.push("PKG.FSR.Select"),!a.bestPick)return c[0];a.defaultFlight?c.push("DPS"):c.push("NonDPS"),a.dpsDimensions&&c.push(a.dpsDimensions)}else{if(c.push("Select"),a.isCached)return c.push("CachedPrice.ExactMatch"),c.join(".");a.price.hasFare===!1&&c.push("CTP"),a.bestValue?c.push("BestValue"):a.cheapest?c.push("Cheapest"):a.shortest&&c.push("Shortest"),d=a.legs[0].carrierSummary.noOfTicketsLeft,a.legs[0].carrierSummary.displayUrgencyMessage===!0&&void 0!==d&&c.push("Urgency"+a.legs[0].carrierSummary.noOfTicketsLeft)}return c.join(".")}function k(a,b){h.each(a.legs,function(a,c){b.push("leg"+c+"-natural-key:"+l(a.naturalKey))})}function l(a){return a.replace(/:/g,"::")}return d.extend({className:function(){var a=["flight-module","segment","offer-listing"];return this.model.get("bestPick")&&a.push("best-pick"),a.join(" ")},events:{"click a.open-bag-fee":"openBaggageFeeLink"},initialize:function(a){this.template=c.templates.standardOffer,d.prototype.initialize.call(this,a);var b=this.model;this.standardOfferDetailsView=new e({model:b,el:this.el}),this.baggageFeeView=new f({model:{offer:b},el:this.el})},openBaggageFeeLink:function(a){this.baggageFeeView.baggageFeeLinkHelper(a)},getDataAttributes:function(a){var c,d;return d={"test-id":"select-button","bargain-fare":"false","click-handler":"select-flight,omnitureClickHandler","prevent-expand":"true","omniture-rfrr":j(a),"trip-id":a.isEpcPinnedListingOffer?a.originalNaturalKey:a.naturalKey,"offer-index":a.index,"has-fare":"object"==typeof a.price&&a.price.hasFare===!0,"leg-indexes":a.legIndexList,superlatives:a.superlatives,"outbound-airlinecodes":a.legs[0]?a.legs[0].carrierSummary.airlineCodes:void 0,"inbound-airlinecodes":a.legs[1]?a.legs[1].carrierSummary.airlineCodes:void 0,"is-cached":a.isCached===!0,"result-token":a.resultToken},i(a.hotelId)||(d["hotel-data"]=a.hotelId),i(a.carData)||(d["car-data"]=a.carData),void 0!==a.price&&a.price.pricedFlight&&b.extend(!0,d,{"air-provider-id":this.getNestedAttributesFromOffer(a,"carrierSummary","airProviderId"),"flight-fare-type-code":this.getNestedAttributesFromOffer(a,"price","flightFareTypeCode"),"flight-fare-type-value":this.getNestedAttributesFromOffer(a,"price","flightFareTypeValue"),"is-split-ticket":a.splitTicket,discount:a.discount,"is-packageable":a.packageable}),c=h.chain(d).keys(d).map(function(a){var b=d[a];return void 0!==b&&null!==b||(b=""),a+":"+b}),k(a,c),c.join("|").value()},getStandardOfferClasses:function(a){var b=["flex-card-offer"];return a.isCached&&b.push("flex-card-offer-cached"),b.join(" ")},getPartnerLoyaltyBrandedFareName:function(a){var b=0,c=a.legs.length;for(b=0;b<c;b+=1)if(a.legs[b].partnerLoyaltyBrandedFare&&a.legs[b].partnerLoyaltyBrandedFare.brandedFareName)return a.legs[b].partnerLoyaltyBrandedFare.brandedFareName;return""},getMarkup:function(a,b){return this.template({module:a,showFreeCancelForOffer:b,isMultiDestination:g.route.isMultiDest,isByot:g.view.isByot,useTripStrings:g.route.isMultiDest,isFlexibleShoppingWithPackagePricing:g.isFlexibleShoppingWithPackagePricing,isOfferPlacementBelowSelectButton:g.loyalty.isOfferPlacementBelowSelectButton,shouldDisplayFareType:g.displayFareType&&a.brandedFare&&a.brandedFare.brandedFareName,shouldDisplayFareTypeForLeg:g.displayFareTypeForLeg,partnerLoyaltyBrandedFareName:this.getPartnerLoyaltyBrandedFareName(a),shouldDisplayFeeMessage:g.displayOBFees&&g.obFeeThinListing,showObFeeMessageFFOP:g.showObFeeMessageFFOP,shouldUseHandBaggageOnlyMessage:g.baggageFee.useHandBaggageOnlyMessage,shouldUseMultipleBagFeeStrings:g.baggageFee.useMultipleBagFeeStrings,shouldUseThinListingBaggageFeeLink:g.baggageFee.useThinListingBaggageFeeLink,partnerLoyaltyPointsPerPerson:g.loyalty.partnerLoyaltyPointsPerPerson,dualPricingDisplayForCardFeesEnabled:g.dualPricingDisplayForCardFeesEnabled,isFromPriceTextEnabled:g.isFromPriceTextEnabled,partnerPointsEnabled:g.loyalty.partnerPointsEnabled,standardOfferClasses:this.getStandardOfferClasses(a),dataAttributes:this.getDataAttributes(a)})}})}),define("baggageFeeView",["flights","jquery","backbone","configuration"],function(a,b,c,d){"use strict";function e(c){var f,e=c.get("legs")||[];return e.length>0?b.each(e,function(a,c){c=b.extend(c,{distanceUnit:d.roundTrip.distanceUnit,showOnTimeLink:d.roundTrip.showOnTimeLink,onTimeLink:d.roundTrip.onTimeLink})}):b.each(c.get("legIds"),function(c,g){f=b.extend(a.collections.legsCollection.models[0].get(g),{distanceUnit:d.roundTrip.distanceUnit,showOnTimeLink:d.roundTrip.showOnTimeLink,onTimeLink:d.roundTrip.onTimeLink}),e.push(f)}),b.each(e,function(a,c){b.extend(c,{selected:0===a})}),e}function f(a){return void 0===a||null===a}return c.View.extend({inlineAjaxUrl:"/api/flight/bagfeesmcfilterbyac",externalPageUrl:"/Flights-BagFeesFilterByAC?",initialize:function(){this.model.legs=e(this.model.offer),this.model.fareBasisDetails=this.model.offer.get("fareBasisDetails")},constructBaggageFeeURL:function(a,b){var k,d=(this.externalPageUrl,[]),e=b.legs[a],g=b.fareBasisDetails[e.naturalKey],h=e.timeline[0].carrier.operatedByAirlineCode,i=e.timeline[0].carrier.airlineCode,j=e.timeline[0].departureTime.travelDate;return d.push("originapt="+e.departureLocation.airportCode),d.push("destinationapt="+e.arrivalLocation.airportCode),d.push("cabinclass="+g.cabinCategoryCodes[0]),d.push("mktgcarrier="+e.timeline[0].carrier.airlineCode),d.push("bookingclass="+g.bookingCodes[0]),f(g.fareBasisCode)||d.push("farebasis="+g.fareBasisCode),"string"!=typeof i||""===i||"string"==typeof h&&""!==h||(h=i),"string"!=typeof h||""===h||"string"==typeof i&&""!==i||(h=i),"string"==typeof j&&j.indexOf("/")>-1&&(k=j.split("/"),j=(parseInt(k[2],10)+2e3).toString()+"-"+k[0]+"-"+k[1]),d.push("opcarrier="+h),d.push("traveldate="+j),d.push("flightnumber="+e.timeline[0].carrier.flightNumber),d.join("&")},baggageFeeLinkHelper:function(a){window.open(this.externalPageUrl+this.constructBaggageFeeURL(this._getLegIndex(a),this.model))},_getLegIndex:function(a){return void 0!==b(a.target).data("legIndex")?b(a.target).data("legIndex"):b(a.target).parent().data("legIndex")}})}),define("cachedOfferView",["flights","jquery","handlebars","listItemView","configuration"],function(a,b,c,d,e){"use strict";return d.extend({className:"flight-module segment offer-listing cached-offer",initialize:function(a){var b=this;b.template=c.templates.fluxCachedOfferTemplate},getMarkup:function(a,b){return this.template({module:a,showFreeCancelForOffer:b,shouldDisplayFareType:e.displayFareType&&a.brandedFare&&a.brandedFare.brandedFareName,partnerLoyaltyValue:a.partnerLoyaltyValue,partnerPointsEnabled:e.loyalty.partnerPointsEnabled,partnerLoyaltyPointsPerPerson:e.loyalty.partnerLoyaltyPointsPerPerson})}})}),define("bargainOfferView",["backbone","jquery","handlebars","listItemView","sitebrand","configuration"],function(a,b,c,d,e,f){"use strict";function g(a){var c,b=a.legs[0],d="",e="",f=b.nonDelta;return b.hotwireMarketing&&(c=b.departureTime.hour,f?(d=c>=0&&c<3?"departureTime_12a_3a":c>=3&&c<6?"departureTime_3a_6a":c>=6&&c<9?"departureTime_6a_9a":c>=9&&c<12?"departureTime_9a_12p":c>=12&&c<15?"departureTime_12p_3p":c>=15&&c<18?"departureTime_3p_6p":c>=18&&c<21?"departureTime_6p_9p":"departureTime_9p_12a",e=0===b.stops?"nonstop":1===b.stops?"oneStop":"multipleStops"):(d=c>=6&&c<22?"bargain_fare_day_time":"bargain_fare_night_time",e=b.stops<2?"bargain_trip_stops":"bargain_trip_multiple_stops")),{bargainFareTextKey:d,numStopsKey:e,delta:!f}}function h(a){var b="",c=a.legs[0]?a.legs[0].carrierSummary:void 0;return a.bargainOffer&&(b+=".EBF"),a.bestValue?b+=".BestValue":a.cheapest?b+=".Cheapest":a.shortest&&(b+=".Shortest"),c&&c.displaySeatUrgency&&(b+=".Urgency"+c.noOfTicketsLeft),b}function i(a){var b,c;return c=this,b={testId:"select-button",clickHandler:"select-flight,omnitureClickHandler",omnitureTail:h(a),airProviderIds:c.getNestedAttributesFromOffer(a,"carrierSummary","airProviderId"),flightFareTypeCodes:c.getNestedAttributesFromOffer(a,"price","flightFareTypeCode"),flightFareTypeValues:c.getNestedAttributesFromOffer(a,"price","flightFareTypeValue")}}return d.extend({className:"ebf-module flight-module segment offer-listing",template:c.templates.bargainoffer,render:function(){var c,a=this.getFullOfferModel(this),d=f.displayBrandNameForBargainFare?e.brandname:"",h=this;return b.each(h.attributes,function(a,b){h.$el.attr(a,h.model.get(b))}),c=this.template({module:a,dataAttributes:i.call(this,a),brandName:d,hotwireTextKeys:g(a)}),this.$el.html(_.unescape(c.replace(/&#x3D;/gi,"="))),this.createLoyalty(a),this}})}),define("filterItemView",["flights","handlebars","backbone","underscore","configuration","analytics"],function(a,b,c,d,e,f){"use strict";return c.View.extend({tagName:"label",ariaFilterLabel:"",ariaFilterLegendId:"",categoryTitle:"",filterType:"",className:"check filter-option",attributes:{},template:b.templates.filterItemTemplate,events:{'click input[type="checkbox"]:checked':"logOmniture",'click input[type="checkbox"]:not(:checked)':"logOmnitureDisable"},initialize:function(b){this.label=b.label,this.ariaFilterLegendId=b.ariaFilterLegendId,this.categoryId=b.categoryId,this.ariaText=b.ariaText,this.filterType=b.filterType,this.input=b.input,this.showCount=b.showCount||!1,this.categoryTitle=b.categoryTitle;var c=this;!0===b.appendLegToName&&require(["setupRouter"],function(b){var d=b();a.vent.on("uiModel.resetViewableOffers",function(a){if("object"!=typeof a||"client"!==a.source){var b=c.input.name;b=b.replace(/\d+/g,""),b+=d.getNextLegToView(),c.input.name=b,c.render()}})}),this.listenTo(this.model,"change:formattedPrice",this.updateFormattedPrice),this.listenTo(this.model,"change:totalCount",this.updateFilterVisibility),this.listenTo(this.model,"change:checked",this.updateCheckedState),this.render(),this.listenTo(a.vent,"uiModel.fetching",function(a){"Cache.ExactMatch"!==a.cacheType&&"InitialSearch"===a.fetchOrigin&&this.$el.find("input").prop("disabled",!0)})},render:function(){return this.createAriaFilterLabelStrings(),this.$el.html(this.template(d.extend(d.clone(this.model.toJSON()),{label:this.label,input:this.input,showCount:this.showCount,checked:this.model.get("checked"),categoryTitle:this.categoryTitle,isTotalCountOne:this.isTotalCountOne(),isFlexibleShopping:e.isFlexibleShoppingEnabled}))),this.$el.find(".a11y-filters-tag").attr("id",this.ariaFilterLabel+"-flights-checkbox"),this.$el.find("input").attr("aria-labelledby",this.ariaFilterLegendId+"-legend "+this.ariaFilterLabel+"-flights-checkbox"),this.delegateEvents(),this},createAriaFilterLabelStrings:function(){"airports"===this.filterType?this.ariaFilterLabel=this.label.substr(0,3):"stops"===this.filterType&&"Nonstop"!==this.label?this.ariaFilterLabel=this.label.substr(0,1)+"-stop":"airlines"===this.filterType?this.ariaFilterLabel=this.label.replace(/\W/g,"-"):"flight-time"===this.filterType?this.ariaFilterLabel=this.categoryId+"-"+this.label.match(/\w+/,""):this.ariaFilterLabel=this.label},isTotalCountZero:function(){return 0===this.model.get("totalCount")},isTotalCountOne:function(){return 1===this.model.get("totalCount")},updateFilterVisibility:function(){this.isTotalCountZero()?this.hide():this.show()},updateCheckedState:function(){this.$el.find("input").attr("checked",this.model.get("checked")||!1)},updateFormattedPrice:function(){this.$el.find(".from-price").text(this.model.get("formattedPrice"))},hide:function(){this.$el.hide(),this.$el.attr("aria-hidden",!0)},show:function(){this.$el.css({display:""}),this.$el.attr("aria-hidden",!1)},logOmniture:function(a){f.trackAction(this.input.data.omnitureRfrr,a.target)},logOmnitureDisable:function(a){f.trackAction(this.input.data.omnitureRfrr+".Disable",a.target)}})}),define("toggleView",["uitk","handlebars","jquery","backbone"],function(a,b,c,d){"use strict";return d.View.extend({parameters:{transition:"fade"},initialize:function(a){this.template=b.templates.toggleTemplate,this.parameters=c.extend(!0,{},this.parameters,a.parameters)},render:function(){return this.$el.html(this.template(this.parameters)),this},appendMarkupToContainer:function(a){this.$el.find(".toggle-pane").append(a)}})}),define("filtersView",["jquery","flights","handlebars","filterPillsView","airportFiltersView","stopFiltersView","uitk","i18n","filtersModel","airlineFiltersView","timeFiltersView","configuration","backbone","underscore","uiModel","experiments"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";var q=!0,r=function(){0===o.viewableOffers.length?this.$el.hide():this.$el.show()};return m.View.extend({el:a("#columnAFilter"),$categoriesContainer:a("#filterContainer"),$loader:a("#columnAFilter .filtersLoaderContainer"),fetchOrigin:"Filter",events:{'change input[type="checkbox"]':"requestFilteredResults"},getAjaxData:function(){var a,c,b={};return c=this.$categoriesContainer.find("input:disabled").prop("disabled",!1),a=this.$categoriesContainer.find("input").serialize(),c.prop("disabled",!0),""!==a.trim()&&n.each(a.split("&"),function(a){var c=a.split("="),d=c[0],e=decodeURIComponent(c[1]);void 0!==e&&void 0===b[d]?b[d]=e:b[d]+=","+e}),b},requestFilteredResults:function(c){var e,d=this,i=void 0===c?"":c.currentTarget.id,j=h.filters.interstitial.generic;void 0!==c&&(j=a(c.currentTarget).data("interstitialMessage")||h.filters.interstitial.generic),0===this.$categoriesContainer.find('input[type="checkbox"]:checked').length?(g.utils.liveAnnounce(h.filters.accessibility.announceFilteringOff,"polite"),e=h.filters.accessibility.announceClearFilteringComplete):(g.utils.liveAnnounce(h.filters.accessibility.announceFilteringOn,"polite"),e=h.filters.accessibility.announceFilteringComplete),this.filterPillsView.render(),this.appView.ajaxErrorView.hide(),b.vent.trigger("filtersView.filterSelected",{filter:d.getAjaxData(),interstitialMessage:j}),b.vent.once("uiModel.resetViewableOffers",function(){g.utils.liveAnnounce(e),a("#"+i).focus()}),l.route.isOneWay&&(2===p.getVariant(13031)&&(this.changeAirlineFilters=a.noop),this.changeArrivalAirportFilters(),this.changeDepartureTimeFilters(),this.changeArrivalTimeFilters(),this.changeAirlineFilters(),this.changeStopFilters())},initialize:function(a){var s,c=a.singlePageModel.get("arrivalCity"),g=a.singlePageModel.get("departureCity"),n=h.filters.time.departure,p=h.filters.time.arrival,t=this;this.model=a.filtersModel||new i,this.appView=a.appView,"boolean"==typeof a.shouldSaveCheckedState&&(q=a.shouldSaveCheckedState),t.listenTo(o,"change:summary",function(a){var c=a.get("summary");c&&c.filters&&t.model.set(c.filters),b.vent.trigger("filtersView.summaryUpdated")}),s=l.route.isOneWay?n.oneWayCategoryTitle:n.categoryTitle.replace("{0}",g),this.filterPillsView=new d({filtersView:this,model:this.model}),this.arrivalAirportFiltersView=new e({id:"arrivalAirports",leg:0,isArrival:!0}),this.stopFiltersView=new f,this.airlineFiltersView=new j,this.departureTimeFilters=[new k({id:"outbound-departure-times",model:new m.Model,configuration:{categoryTitle:s,earlyMorning:{label:n.earlyMorning.label,input:{id:"leg0-earlymorning-departure",name:"fd0",value:"em",data:{omnitureRfrr:"FLT.SR.Filter.DeptTime.EarlyMorning.Leg0",pillLabel:this._getTimeFilterPillStrings(n.earlyMorning.outbound.pill),interstitialMessage:h.filters.interstitial.time}}},morning:{label:n.morning.label,input:{id:"leg0-morning-departure",name:"fd0",value:"m",data:{omnitureRfrr:"FLT.SR.Filter.DeptTime.Morning.Leg0",pillLabel:this._getTimeFilterPillStrings(n.morning.outbound.pill),interstitialMessage:h.filters.interstitial.time}}},afternoon:{label:n.afternoon.label,input:{id:"leg0-afternoon-departure",name:"fd0",value:"a",data:{omnitureRfrr:"FLT.SR.Filter.DeptTime.Afternoon.Leg0",pillLabel:this._getTimeFilterPillStrings(n.afternoon.outbound.pill),interstitialMessage:h.filters.interstitial.time}}},evening:{
label:n.evening.label,input:{id:"leg0-evening-departure",name:"fd0",value:"e",data:{omnitureRfrr:"FLT.SR.Filter.DeptTime.Evening.Leg0",pillLabel:this._getTimeFilterPillStrings(n.evening.outbound.pill),interstitialMessage:h.filters.interstitial.time}}}}}),new k({id:"inbound-departure-times",model:new m.Model,configuration:{categoryTitle:n.categoryTitle.replace("{0}",c),earlyMorning:{label:n.earlyMorning.label,input:{id:"leg1-earlymorning-departure",name:"fd1",value:"em",data:{omnitureRfrr:"FLT.SR.Filter.DeptTime.EarlyMorning.Leg1",pillLabel:n.earlyMorning.inbound.pill,interstitialMessage:h.filters.interstitial.time}}},morning:{label:n.morning.label,input:{id:"leg1-morning-departure",name:"fd1",value:"m",data:{omnitureRfrr:"FLT.SR.Filter.DeptTime.Morning.Leg1",pillLabel:n.morning.inbound.pill,interstitialMessage:h.filters.interstitial.time}}},afternoon:{label:n.afternoon.label,input:{id:"leg1-afternoon-departure",name:"fd1",value:"a",data:{omnitureRfrr:"FLT.SR.Filter.DeptTime.Afternoon.Leg1",pillLabel:n.afternoon.inbound.pill,interstitialMessage:h.filters.interstitial.time}}},evening:{label:n.evening.label,input:{id:"leg1-evening-departure",name:"fd1",value:"e",data:{omnitureRfrr:"FLT.SR.Filter.DeptTime.Evening.Leg1",pillLabel:n.evening.inbound.pill,interstitialMessage:h.filters.interstitial.time}}}}})],this.arrivalTimeFilters=[new k({id:"outbound-arrival-times",model:new m.Model,configuration:{categoryTitle:p.categoryTitle.replace("{0}",c),toggleParameters:{useToggle:!l.view.isByot,omnitureRfrr:"Filter.ArrTime.Leg0",contentId:"outboundArrivalTimeToggleLeg0",id:"arrivalTimeToggleLinkLeg0",expandText:p.toggle.expandText.replace("{0}",c),expandAriaText:p.toggle.expandText.replace("{0}",c),collapseText:p.toggle.collapseText.replace("{0}",c),collapseAriaText:p.toggle.collapseText.replace("{0}",c),isOpened:!1},earlyMorning:{label:p.earlyMorning.label,ariaText:p.earlyMorning.outbound.aria,input:{id:"leg0-earlymorning-arrival",name:"fr0",value:"em",data:{omnitureRfrr:"FLT.SR.Filter.ArrTime.EarlyMorning.Leg0",pillLabel:this._getTimeFilterPillStrings(p.earlyMorning.outbound.pill),interstitialMessage:h.filters.interstitial.time}}},morning:{label:p.morning.label,ariaText:p.morning.outbound.aria,input:{id:"leg0-morning-arrival",name:"fr0",value:"m",data:{omnitureRfrr:"FLT.SR.Filter.ArrTime.Morning.Leg0",pillLabel:this._getTimeFilterPillStrings(p.morning.outbound.pill),interstitialMessage:h.filters.interstitial.time}}},afternoon:{label:p.afternoon.label,ariaText:p.afternoon.outbound.aria,input:{id:"leg0-afternoon-arrival",name:"fr0",value:"a",data:{omnitureRfrr:"FLT.SR.Filter.ArrTime.Afternoon.Leg0",pillLabel:this._getTimeFilterPillStrings(p.afternoon.outbound.pill),interstitialMessage:h.filters.interstitial.time}}},evening:{label:p.evening.label,ariaText:p.evening.outbound.aria,input:{id:"leg0-evening-arrival",name:"fr0",value:"e",data:{omnitureRfrr:"FLT.SR.Filter.ArrTime.Evening.Leg0",pillLabel:this._getTimeFilterPillStrings(p.evening.outbound.pill),interstitialMessage:h.filters.interstitial.time}}}}}),new k({id:"inbound-arrival-times",model:new m.Model,configuration:{categoryTitle:p.categoryTitle.replace("{0}",g),toggleParameters:{useToggle:!l.view.isByot,omnitureRfrr:"Filter.ArrTime.Leg1",contentId:"inboundArrivalTimeToggleLeg1",id:"arrivalTimeToggleLinkLeg1",expandText:p.toggle.expandText.replace("{0}",g),expandAriaText:p.toggle.expandText.replace("{0}",g),collapseText:p.toggle.collapseText.replace("{0}",g),collapseAriaText:p.toggle.collapseText.replace("{0}",g),isOpened:!1},earlyMorning:{label:p.earlyMorning.label,ariaText:p.earlyMorning.inbound.aria,input:{id:"leg1-earlymorning-arrival",name:"fr1",value:"em",data:{omnitureRfrr:"FLT.SR.Filter.ArrTime.EarlyMorning.Leg1",pillLabel:p.earlyMorning.inbound.pill,interstitialMessage:h.filters.interstitial.time}}},morning:{label:p.morning.label,ariaText:p.morning.inbound.aria,input:{id:"leg1-morning-arrival",name:"fr1",value:"m",data:{omnitureRfrr:"FLT.SR.Filter.ArrTime.Morning.Leg1",pillLabel:p.morning.inbound.pill,interstitialMessage:h.filters.interstitial.time}}},afternoon:{label:p.afternoon.label,ariaText:p.afternoon.inbound.aria,input:{id:"leg1-afternoon-arrival",name:"fr1",value:"a",data:{omnitureRfrr:"FLT.SR.Filter.ArrTime.Afternoon.Leg1",pillLabel:p.afternoon.inbound.pill,interstitialMessage:h.filters.interstitial.time}}},evening:{label:p.evening.label,ariaText:p.evening.inbound.aria,input:{id:"leg1-evening-arrival",name:"fr1",value:"e",data:{omnitureRfrr:"FLT.SR.Filter.ArrTime.Evening.Leg1",pillLabel:p.evening.inbound.pill,interstitialMessage:h.filters.interstitial.time}}}}})],this.listenTo(this.model,"change",this.hideLoader),this.listenTo(this.model,"change:stopFilters",this.changeStopFilters),this.listenTo(this.model,"change:airlineFilters",this.changeAirlineFilters),l.route.isMultiDest||(this.listenTo(this.model,"change:arrivalAirportFilters",this.changeArrivalAirportFilters),this.listenTo(this.model,"change:departureTimeFilters",this.changeDepartureTimeFilters),this.listenTo(this.model,"change:arrivalTimeFilters",this.changeArrivalTimeFilters)),this.listenTo(b.vent,"uiModel.resultsFetchSuccess.InitialSearch",r),this.listenTo(o,"responseError.InitialSearch",r),this.listenTo(b.vent,"uiModel.resultsFetchFailure.InitialSearch",r),this.render(),l.view.isByot&&(require(["setupRouter"],function(a){t.router=a()}),this.closeExpandedFiltersOnPageChange(),this.showTimeFiltersForSelectedLeg(),this.listenTo(b.vent,"router.noSelectedLegs",t.showTimeFiltersForSelectedLeg),this.listenTo(b.vent,"router.noSelectedLegs",t.closeExpandedFiltersOnPageChange),this.listenTo(b.vent,"router.selectedLegs",t.showTimeFiltersForSelectedLeg),this.listenTo(b.vent,"router.selectedLegs",t.closeExpandedFiltersOnPageChange),this.listenTo(b.vent,"uiModel.resultsFetchSuccess.InitialSearch",t.showTimeFiltersForSelectedLeg))},closeExpandedFiltersOnPageChange:function(){0!==this.router.getNextLegToView()&&1!==this.router.getNextLegToView()||(this.airlineFiltersView.toggle.parameters.isOpened=!1)},showTimeFiltersForSelectedLeg:function(){var b=a("#outbound-departure-times"),c=a("#outbound-arrival-times"),d=a("#inbound-departure-times"),e=a("#inbound-arrival-times");void 0!==this.router&&(b.hide(),c.hide(),d.hide(),e.hide(),0===this.router.getNextLegToView()?b.show():1===this.router.getNextLegToView()&&d.show())},changeArrivalAirportFilters:function(){var a=this.model.get("arrivalAirportFilters");this._saveCheckedState("arrivalAirportFilters",!1,function(a,b){return"airportRowContainer_"+a.airportCode}),this.arrivalAirportFiltersView.collection.reset(a),this.arrivalAirportFiltersView.collection.set(a)},changeStopFilters:function(){this._saveCheckedState("stopFilters",!1,function(a,b){return"stopFilter_stops-"+b}),this.stopFiltersView.model.set(this.model.get("stopFilters"))},changeAirlineFilters:function(){this._saveCheckedState("airlineFilters",!1,function(a,b){return"airlineRowContainer_"+a.airlineCode.replace("/","\\/")}),this.airlineFiltersView.collection.reset(this.model.get("airlineFilters")),this.airlineFiltersView.collection.set(this.model.get("airlineFilters"))},changeDepartureTimeFilters:function(){var a=this;this._saveCheckedState("departureTimeFilters",!0,function(a,b){return"leg"+b+"-"+a.filterName.toLowerCase()+"-departure"}),n.each(this.model.get("departureTimeFilters"),function(b,c){a.departureTimeFilters[c].model.set(b)})},changeArrivalTimeFilters:function(){var a=this;this._saveCheckedState("arrivalTimeFilters",!0,function(a,b){return"leg"+b+"-"+a.filterName.toLowerCase()+"-arrival"}),n.each(this.model.get("arrivalTimeFilters"),function(b,c){a.arrivalTimeFilters[c].model.set(b)})},render:function(){var b,a=Math.min(this.departureTimeFilters.length,this.arrivalTimeFilters.length);if(this.$categoriesContainer.empty(),this.$categoriesContainer.append(this.stopFiltersView.render(!0).el),this.$categoriesContainer.append(this.airlineFiltersView.render(!0).el),l.route.isMultiDest)return this;for(b=0;b<a;b++)this.$categoriesContainer.append(this.departureTimeFilters[b].render().el),l.route.isOneWay||this.$categoriesContainer.append(this.arrivalTimeFilters[b].render().el);var c=l.route.isOneWay||l.view.isByot;return c&&this.$categoriesContainer.append(this.arrivalAirportFiltersView.render(!0).el),this},showLoader:function(){this.$categoriesContainer.empty(),this.$loader.show()},hideLoader:function(){this.$loader.hide()},disable:function(){this.$el.find('input[type="checkbox"]').prop("disabled",!0),a(".sort-bar-column .off-canvas-btn").prop("disabled",!0)},enable:function(){this.$el.find('input[type="checkbox"][class!="disabled"]').prop("disabled",!1),a(".sort-bar-column .off-canvas-btn").prop("disabled",!1)},_saveCheckedState:function(b,c,d){!1!==q&&(c?n.each(this.model.get(b),function(b,c){n.each(b,function(b,e){n.extend(b,{checked:a("#"+d(b,c)).is(":checked")})})}):n.each(this.model.get(b),function(b,c){n.extend(b,{checked:a("#"+d(b,c)).is(":checked")})}))},_getTimeFilterPillStrings:function(a){return l.route.isOneWay||l.view.isByot?a.singleLeg:a.multiLeg}})}),define("filterPillsView",["jquery","flights","handlebars","backbone","underscore","analytics","experiments"],function(a,b,c,d,e,f,g){"use strict";return d.View.extend({pillTemplate:c.templates.filterPillTemplate,el:"#flightSearchResultDiv",$activeFilters:a(".active-filters"),$pillsList:a(".active-filters ul.filters"),events:{"click li.filter":"removeFilter"},initialize:function(a){var c=this;c.model=a.model,c.filtersView=a.filtersView,c.listenTo(c.model,"change",c.render),b.vent.on("router.noSelectedLegs router.selectedLegs",function(){b.vent.once("uiModel.resetViewableOffers",function(){c.render.call(c)})})},render:function(){var c,b=this;c=a(g.getVariant(12623)>0?"#filterContainer fieldset:not(#airlines) input:checked":"#filterContainer input:checked"),this.$pillsList.empty(),0===c.length?this.hide():(this.show(),e.each(c,function(c){var d=a(c),e=d.data("omnitureRfrr").indexOf(".Disable")===-1?".Disable.FilterPill":".FilterPill";b.$pillsList.append(b.pillTemplate({name:d.attr("name"),value:d.attr("value"),label:d.data("pillLabel"),omnitureRfrr:d.data("omnitureRfrr")+e}))}))},removeFilter:function(b){var g,c=a(b.target).closest(".filter"),d=c.data("filterName"),e=c.data("filterValue");!1===this.$el.hasClass("disabled")&&(this.hide(),this.filtersView.appView.ajaxErrorView.$el.addClass("hide"),g=a('#filterContainer input[name="'+d+'"][value="'+e+'"]'),g.attr("checked",!1),this.filtersView.requestFilteredResults({target:g,currentTarget:{id:g.prop("id")}})),f.trackAction(c.data("omnitureRfrr"),c)},hide:function(){this.$activeFilters.hide()},show:function(){this.$activeFilters.show()},disable:function(){this.$el.addClass("disabled")},enable:function(){this.$el.removeClass("disabled")}})}),define("stopFiltersView",["handlebars","filterItemView","i18n","stopFiltersModel","filterItemModel","backbone","configuration"],function(a,b,c,d,e,f,g){"use strict";return f.View.extend({id:"stops",tagName:"fieldset",filterType:"stops",className:"filter-set",ariaFilterLegendId:"stops",template:a.templates.filterCategoryTemplate,model:new d,categoryTitle:c.filters.stops.categoryTitle,showPriceColumn:!0,minFiltersToShow:1,initialize:function(){this.nonStopInputView=new b({model:new e,categoryTitle:c.filters.stops.categoryTitle,ariaFilterLegendId:"stops",filterType:"stops",label:c.filters.stops.nonstop,ariaText:c.filters.stops.nonstopAriaText,input:{id:"stopFilter_stops-0",name:"fs",value:"0",data:{omnitureRfrr:"FLT.SR.Filter.Stops.0",pillLabel:c.filters.stops.nonstop,interstitialMessage:c.filters.interstitial.stops}},showCount:!0,showPrice:!0,appendLegToName:g.view.isByot}),this.oneStopInputView=new b({model:new e,categoryTitle:c.filters.stops.categoryTitle,ariaFilterLegendId:"stops",filterType:"stops",label:c.filters.stops.onestop,ariaText:c.filters.stops.onestopAriaText,input:{id:"stopFilter_stops-1",name:"fs",value:"1",data:{omnitureRfrr:"FLT.SR.Filter.Stops.1",pillLabel:c.filters.stops.onestop,interstitialMessage:c.filters.interstitial.stops}},showCount:!0,showPrice:!0,appendLegToName:g.view.isByot}),this.twoStopInputView=new b({model:new e,categoryTitle:c.filters.stops.categoryTitle,ariaFilterLegendId:"stops",filterType:"stops",label:c.filters.stops.variableStops.replace("{0}","2+").replace("\\{0\\}","2+"),ariaText:c.filters.stops.twostopAriaText,input:{id:"stopFilter_stops-2",name:"fs",value:"2",data:{omnitureRfrr:"FLT.SR.Filter.Stops.2+",pillLabel:c.filters.stops.variableStops.replace("{0}","2+").replace("\\{0\\}","2+"),interstitialMessage:c.filters.interstitial.stops}},showCount:!0,showPrice:!0,appendLegToName:g.view.isByot}),this.listenTo(this.model,"change:0",this.changeNonStopModel),this.listenTo(this.model,"change:1",this.changeOneStopModel),this.listenTo(this.model,"change:2",this.changeTwoStopModel),this.render(!0)},changeNonStopModel:function(){this.nonStopInputView.model.set(this.model.get("0")),this.render()},changeOneStopModel:function(){this.oneStopInputView.model.set(this.model.get("1")),this.render()},changeTwoStopModel:function(){this.twoStopInputView.model.set(this.model.get("2")),this.render()},render:function(a){return a?this:(this.$el.html(this.template({ariaFilterLegendId:this.ariaFilterLegendId,categoryTitle:this.categoryTitle,showPriceColumn:this.showPriceColumn})),this.$el.append(this.nonStopInputView.render().el),this.$el.append(this.oneStopInputView.render().el),this.$el.append(this.twoStopInputView.render().el),this)}})}),define("airlineFiltersView",["handlebars","i18n","airlineFiltersCollection","filterItemView","filterItemModel","toggleView","configuration","backbone","underscore","experiments","jquery","analytics","flights"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n=[];return h.View.extend({id:"airlines",tagName:"fieldset",filterType:"airlines",className:"filter-set",omnitureRfrr:"FLT.SR.Filter.Airlines",ariaFilterLegendId:"airlines-included",collection:new c,categoryTemplate:a.templates.filterCategoryTemplate,categoryTitle:b.filters.airlines.categoryTitle,showPriceColumn:!0,minFiltersToShow:1,toggle:{filtersToShow:g.filters.numAirlinesToShow,parameters:{omnitureRfrr:"Filter.Airlines",contentId:"airlineToggleContainer",paneTag:"span",id:"airlineToggleLink",expandText:b.filters.airlines.toggle.expandText,expandAriaText:b.filters.airlines.toggle.expandAriaText,collapseText:b.filters.airlines.toggle.collapseText,collapseAriaText:b.filters.airlines.toggle.collapseAriaText,isOpened:!1}},events:{"click .toggle-trigger":"updateToggle","change input[id^=airlineRowContainer]":"setStateOfSelectAllCheckbox","change #select-all-airline":"toggleAllCheckboxState"},updateToggle:function(){this.toggle.parameters.isOpened=!this.toggle.parameters.isOpened},initialize:function(){this.listenTo(this.collection,"reset",this.resetViews),this.listenTo(this.collection,"add",this.addView),this.selectAllState=!1,this.selectAllStateV2=!1,m.vent.on("filtersView.summaryUpdated",this.selectAllCheckboxes,this)},addView:function(a){var c=a.get("airlineCode"),f=a.get("filterName"),h="FLT.SR.Filter.Airlines";a.get("checked")&&(h+=".Disable"),n.push(new d({model:new e(a.attributes),ariaFilterLegendId:this.ariaFilterLegendId,categoryTitle:this.categoryTitle,filterType:this.filterType,label:f,ariaText:b.filters.airlines.ariaText.replace("{0}",a.get("count")).replace("{1}",f).replace("{2}",a.get("formattedPrice")),input:{id:"airlineRowContainer_"+c,name:"fa",value:c,data:{omnitureRfrr:h,pillLabel:f,interstitialMessage:b.filters.interstitial.airline}},showCount:!0,showPrice:!0,appendLegToName:g.view.isByot})),g.filters.showAirlines&&this.render()},resetViews:function(){n=[]},getItemViews:function(){return n},render:function(a){if(a)return this;var b=this;return this.$el.html(this.categoryTemplate({ariaFilterLegendId:this.ariaFilterLegendId,categoryTitle:this.categoryTitle,showPriceColumn:this.showPriceColumn})),i.each(n,function(a,c){a.model.trigger("change"),c<b.toggle.filtersToShow?b.$el.append(a.render().el):(0===b.$el.find("#"+b.toggle.parameters.contentId).length&&(b.toggleView=new f({parameters:b.toggle.parameters}),b.$el.append(b.toggleView.render().el)),b.toggleView.appendMarkupToContainer(a.render().el))}),this.populateSelectAllforAirlineFilter(),this},populateSelectAllforAirlineFilter:function(){j.getVariant(12623)>0&&(k("#airlines")&&0==k("#airline-included-select-all").length&&j.execute("GROFSRAirlineFiltersSelectAll",{}),k("#select-all-airline").prop("checked",this.selectAllState))},toggleAllCheckboxState:function(a){this.selectAllState=k("#select-all-airline").prop("checked"),k("#airlines input[type=checkbox]").prop("checked",k("#select-all-airline").prop("checked")),k("#select-all-airline").prop("checked")&&l.trackAction("FLT.SR.Filter.SelectAll",this)},selectAllCheckboxes:function(){var a=2==j.getVariant(12623)&&!this.selectAllStateV2;a&&(k("#airlines input[type=checkbox]").prop("checked",!0),this.selectAllStateV2=!0,this.selectAllState=!0)},setStateOfSelectAllCheckbox:function(a){var b=a.target.checked&&k("#airlines input[id^=airlineRowContainer]:checked").length==k("#airlines input[id^=airlineRowContainer]").length;j.getVariant(12623)>0&&(k("#select-all-airline").prop("checked",b),this.selectAllState=b)}})}),define("airportFiltersView",["handlebars","i18n","airportFiltersCollection","filterItemView","filterItemModel","configuration","backbone","underscore","experiments"],function(a,b,c,d,e,f,g,h,i){"use strict";return g.View.extend({tagName:"fieldset",className:"filter-set",filterType:"airports",ariaFilterLegendId:"airports-included",categoryTitle:b.filters.airports.categoryTitle,categoryTemplate:a.templates.filterCategoryTemplate,collection:new c,showPriceColumn:!0,minFiltersToShow:2,itemViews:[],initialize:function(a){this.leg=a.leg,this.isArrival=a.isArrival,this.listenTo(this.collection,"reset",this.resetViews),this.listenTo(this.collection,"add",this.addView),this.render(!0)},addView:function(a){var c=a.get("filterName"),g=a.get("airportCode"),h="FLT.SR.Filter.Airports";i.getVariant(13331)>0&&(h="FLT.SR.Filter.Airports.Arrival"),a.get("checked")&&(h+=".Disable"),this.itemViews.push(new d({model:new e(a.attributes),ariaFilterLegendId:this.ariaFilterLegendId,categoryTitle:this.categoryTitle,filterType:this.filterType,label:c,ariaText:b.filters.airports.ariaText.replace("{0}",a.get("count")).replace("{1}",a.get("formattedPrice")),showCount:!0,input:{id:"airportRowContainer_"+g,name:(this.isArrival?"fad":"fao")+this.leg,value:g,data:{omnitureRfrr:h,pillLabel:c,interstitialMessage:b.filters.interstitial.generic}},appendLegToName:f.view.isByot})),this.render()},resetViews:function(){this.itemViews=[],this.render()},render:function(a){var b=this;return b.$el.hide().attr("aria-hidden",!0),a?b:(b.minFiltersToShow<=b.itemViews.length&&(b.$el.html(b.categoryTemplate({ariaFilterLegendId:b.ariaFilterLegendId,categoryTitle:b.categoryTitle,showPriceColumn:b.showPriceColumn})),h.each(b.itemViews,function(a){b.$el.append(a.render().el)}),b.$el.show().attr("aria-hidden",!1)),b)}})}),define("timeFiltersView",["handlebars","filterItemView","filterItemModel","toggleView","backbone"],function(a,b,c,d,e){"use strict";function f(a){return a instanceof e.View?a.render().el:""}function g(a,b){"object"==typeof b&&a instanceof e.View&&a.model.set(b)}return e.View.extend({tagName:"fieldset",className:"filter-set",filterType:"flight-time",ariaFilterLegendId:"flight-time",categoryTemplate:a.templates.filterCategoryTemplate,showPriceColumn:!1,minFiltersToShow:1,events:{"click .toggle-trigger":"updateToggle"},updateToggle:function(){this.toggleParameters.isOpened=!this.toggleParameters.isOpened},initialize:function(a){this.categoryTitle=a.configuration.categoryTitle,this.toggleParameters=a.configuration.toggleParameters,this.ariaFilterLegendId+="-"+a.id,this.earlyMorningInputView=new b({model:new c,categoryId:a.id,ariaFilterLegendId:"flight-time-"+a.id,filterType:"flight-time",label:a.configuration.earlyMorning.label,input:a.configuration.earlyMorning.input,showCount:!1,showPrice:!1}),this.morningInputView=new b({model:new c,categoryId:a.id,ariaFilterLegendId:"flight-time-"+a.id,filterType:"flight-time",label:a.configuration.morning.label,input:a.configuration.morning.input,showCount:!1,showPrice:!1}),this.afternoonInputView=new b({model:new c,categoryId:a.id,ariaFilterLegendId:"flight-time-"+a.id,filterType:"flight-time",label:a.configuration.afternoon.label,input:a.configuration.afternoon.input,showCount:!1,showPrice:!1}),this.eveningInputView=new b({model:new c,categoryId:a.id,ariaFilterLegendId:"flight-time-"+a.id,filterType:"flight-time",label:a.configuration.evening.label,input:a.configuration.evening.input,showCount:!1,showPrice:!1}),this.listenTo(this.model,"change",this.changeModels)},_foreachView:function(a){var b=[this.earlyMorningInputView,this.morningInputView,this.afternoonInputView,this.eveningInputView];_.each(b,function(b){a(b)})},changeModels:function(){var a={};_.each(this.model.toJSON(),function(b,c){var d=b.filterName;"string"==typeof d&&(a[b.filterName.toLowerCase()]=b)}),g(this.earlyMorningInputView,a.earlymorning),g(this.morningInputView,a.morning),g(this.afternoonInputView,a.afternoon),g(this.eveningInputView,a.evening),this.render()},render:function(){var c,e,a=this,b=0;return this._foreachView(function(a){b+=a.model.get("totalCount")>=1?1:0}),this.minFiltersToShow<=b&&(c=this.categoryTemplate({ariaFilterLegendId:this.ariaFilterLegendId,categoryTitle:this.categoryTitle,showPriceColumn:this.showPriceColumn}),"object"==typeof this.toggleParameters&&this.toggleParameters.useToggle===!0?(e=new d({parameters:_.extend({},this.toggleParameters)}),this.$el.html(e.render().el),e.appendMarkupToContainer(c),this._foreachView(function(a){e.appendMarkupToContainer(f(a))})):(this.$el.html(c),this.$el.addClass("always-shown").html(c),this._foreachView(function(b){a.$el.append(f(b))}))),this}})}),define("paginationView",["flights","jquery","handlebars","analytics","uitk","i18n","configuration","backbone","paginationModel"],function(a,b,c,d,e,f,g,h,i){"use strict";var j;return h.View.extend({tagName:"div",template:c.templates.pagination,render:function(){var a,c;return a=this.model.toJSON(),delete a.currentPageNumber,c=this.template(a),this.$el=b(c),this.$el.insertAfter(this.appView.offersCollectionView.$el),this.$el.uitk_pagination(),this},fetchOrigin:"Pagination",getAjaxData:function(a,b){return b||!1!==g.pagination.enabled&&!a?{cz:this.model.defaults.numberOfResultsPerPage}:{}},clear:function(){this.$el&&this.$el.length>0&&this.$el.remove()},reset:function(){this.clear(),this.render()},subscribeToClickEventsAndReportPagination:function(a){var c=b("body");c.on(e.clickEvent,".pagination-next",function(){d.trackAction("FLT.SR.Pagination.NextPage",b(this),{prop1:a.model.get("totalNumberOfResults")}),d.trackAction("FLT.SR.Pagination.Page."+a.model.get("currentPageNumber"),b(this),{prop1:a.model.get("totalNumberOfResults")})}),c.on(e.clickEvent,".pagination-prev",function(){d.trackAction("FLT.SR.Pagination.PreviousPage",b(this),{prop1:a.model.get("totalNumberOfResults")}),d.trackAction("FLT.SR.Pagination.Page."+a.model.get("currentPageNumber"),b(this),{prop1:a.model.get("totalNumberOfResults")})}),c.on(e.clickEvent,".backToTop",function(){d.trackAction("FLT.SR.Pagination.TopOfPage",b(this),{prop1:a.model.get("totalNumberOfResults")})}),c.on(e.clickEvent,"button.pagination-label",function(){var c,e,f;d.trackAction("FLT.SR.Pagination.Page."+b(this).val(),b(this),{prop1:a.model.get("totalNumberOfResults")}),c=parseInt(b(this).val(),10),e=Math.ceil(a.model.get("totalNumberOfResults")/a.model.get("numberOfResultsPerPage")),f=b("#paginationControl").data("show-always-first-last"),c===e&&d.trackAction("FLT.SR.Pagination.Page.Last",b(this),{prop1:e,prop2:f?"showFirstAndLastEnabled":"showFirstAndLastDisabled"})})},updateUiAndModel:function(a,b){window.scrollTo(0,0),a.lastPageNumber=b.pageNumber-1,e.utils.liveAnnounce(f.paging.accessibility.searchingForPage.replace("{0}",b.pageNumber),"polite"),a.model.set({currentPageNumber:b.pageNumber,currentFirstResult:(b.pageNumber-1)*g.pagination.numOffersPerPage+1})},disableViewMethodsWhenPaginationIsDisabled:function(a){b("#paginationControl").hide(),a.show=b.noop,a.hide=b.noop,a.disable=b.noop,a.enable=b.noop,a.reset=b.noop,a.render=function(){return this},a.listenTo(a.appView.model,"change:offers",function(b){a.model.set({numberOfResultsPerPage:_.keys(b.get("offers")).length})})},initialize:function(b){var c=this;c.appView=b.appView,this.model=b.model||new i,!0===g.pagination.enabled?(e.subscribe("pagination.pageChanged",function(a,b){c.updateUiAndModel(c,b)}),this.subscribeToClickEventsAndReportPagination(c),this.listenToOnce(this.model,"change",this.reset),this.listenTo(a.vent,"uiModel.resultsFetchSuccess",this.updateTotalFilteredResults),this.listenTo(a.vent,"uiModel.fetching",this.hide),a.vent.once("uiModel.resultsFetchSuccess."+c.fetchOrigin,function(){e.utils.liveAnnounce(f.paging.accessibility.searchingResultsNowOnPage.replace("{0}",c.model.get("currentPageNumber")))})):this.disableViewMethodsWhenPaginationIsDisabled(c)},updateTotalFilteredResults:function(a){var b=a.response.content.filteredCount;return 0===b?void this.clear():(this.model.set("totalNumberOfResults",b),void this.reset())},show:function(){b("#paginationControl").show()},hide:function(){b("#paginationControl").hide()},disable:function(){var a=b("#paginationControl");j=a.find("button:disabled"),a.find("button").attr("disabled","disabled")},enable:function(){var a=b("#paginationControl");a.find("button").removeAttr("disabled"),j instanceof b&&j.attr("disabled","disabled")}})}),define("ajaxErrorView",["flights","jquery","underscore","dctk/dctk","uitk","handlebars","analytics","ajaxErrorModel","i18n","backbone","pageCriteriaModel","configuration","sitebrand"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(a,b){b.push("errorSrc=FLUX."+a),d.loggingAdapter.logMessage("ajax"+a,b)}return j.View.extend({model:h,templates:{filtersNoFlightsFound:f.templates.filtersNoFlightsFoundTemplate,noFlightsFound:f.templates.noFlightsFound,timeout:f.templates.timeoutError,unknownError:f.templates.genericError,multiItemError:f.templates.multiItemErrorTemplate},prop36:{filtersNoFlightsFound:"FLT.SR.NoFlightsAvailable.Filter",noFlightsFound:"FLT.SR.NoFlightsAvailable",timeout:function(a){return"FLT.SR."+a+".TimeoutError"},unknownError:"FLT.SR.FlightSearchError"},events:{"click .try-again":"tryAgain"},hide:function(){this.$el.addClass("hide")},tryAgain:function(){this.hide(),e.utils.liveAnnounce(i.searching.accessibility.searchRetry,"polite"),k.set("interstitialMessage",i.searching.interstitial.retry,{silent:!0}).trigger("change")},render:function(){var r,u,v,w,x,y,d=b("#columnAFilter .filtersLoaderContainer"),f=this.model.ERROR_CODES,h=this.model.FAILING_PRODUCT,j=a.collections&&a.collections.offersCollection&&a.collections.offersCollection.length||0,l=a.Model&&a.Model.Wizard&&"fhc"===a.Model.Wizard.packageType,m=this.model.get("errorStatus")||"",o=this.model.get("logData")||[],p=this.model.get("options"),q="No Flights Found",s="",t="";return""===m?void this.$el.addClass("hide"):(u=k.get("fetchOrigin"),this.appView.offersCollectionView.$el.empty(),m===f.NO_FLIGHTS_FOUND?"Filter"===u?(r=b(this.templates.filtersNoFlightsFound()),void 0!==this.appView.selectedFiltersView?r.find("#applied-filters").html(this.appView.selectedFiltersView.$el.clone(!0)):r.find("#applied-filters").html(b(".active-filters .filters").clone(!0)),q=f.NO_FLIGHTS_FOUND+" Filtered "+q,t=this.prop36.filtersNoFlightsFound):(r=this.templates.noFlightsFound(this.generateNoFlightsFoundTemplateData()),q=f.NO_FLIGHTS_FOUND+" "+q,t=this.prop36.noFlightsFound):m===f.TIMEOUT?(r=this.templates.timeout({origin:p.origin}),q=f.TIMEOUT+" "+q,s=i.error.accessibility.timeoutRetry,t=this.prop36.timeout(p.origin)):(l?(r=this.templates.multiItemError({failingProduct:h[m]}),m=f.MIS_ERROR):(r=this.templates.unknownError(),m=f.UNKNOWN_ERROR),y=b.grep(o,function(a,b){var c=-1<a.toLowerCase().indexOf("eventname");return c}),x=0<y.length,v=!0===x?y[0]:"eventName="+this.prop36.unknownError,w=v.split("=")[1],q=m+" "+q,t=w),c.defer(function(){g.updateOmnitureProperty("prop36",t),g.trackPageLoad()}),n(m,o),d.hide(),this.$el.html(r).removeClass("hide"),this.appView.paginationView.hide(),e.utils.liveAnnounce(b(r).find(".announce-able").text()+" "+s),a.log(q+": totalModules = "+j),this)},generateNoFlightsFoundMessage:function(){var b=a.Model.Wizard,c="searchedXAirlinesNo",d="1"===b.seatingClass,e="2"===b.seatingClass,f="5"===b.seatingClass;return b.nonStop&&(c+="NonStop"),b.refundable&&(c+="Refundable"),b.preferredAirline&&(c+="PreferredAirline"),(d||e||f)&&(c+="PreferredCabin"),c+=l.route.isMultiDest?"FlightsForCurrentSearch":"WithAirports"},generateNoFlightsFoundTemplateData:function(){var e,b=a.Model.Wizard,d=this.appView.singlePageModel,f=c.find(b.airlines,function(a){return a.code===b.preferredAirline});return"1"===b.seatingClass?e="firstClass":"2"===b.seatingClass?e="businessClass":"5"===b.seatingClass&&(e="premiumEconomyClass"),{noFlightsFoundMessage:this.generateNoFlightsFoundMessage(),arrivalLocationCode:d.get("arrivalAirportCode"),arrivalCityName:d.get("arrivalCity"),departureLocationCode:d.get("departureAirportCode"),departureCityName:d.get("departureCity"),departureDate:d.get("departureDateStr"),isAirAsiaGo:"AirAsiaGo"===m.brandname,preferredAirlineName:b.preferredAirline&&f.name,numberOfAirlines:l.noFlightsFoundError.numberOfAirlines,removePreferencesURL:l.noFlightsFoundError.removePreferencesURL,seatingClass:e}},initialize:function(a){var c=this;c.appView=a.appView,c.setElement(b("#ajax-error")),e.subscribe("pagination.pageChanged",function(){c.hide()}),this.listenTo(this.model,"change",this.render)}})}),define("sortBarView",["flights","jquery","uitk","analytics","i18n","configuration","backbone","sortBarModel","uiModel","pageCriteriaModel"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function m(){var a=b("#sortBar").find(".sort-bar-column button"),c=a.find(".visuallyhidden"),d=c.text();c.text(" "+d),c.removeClass("visuallyhidden"),a.addClass("btn-primary btn-sub-action").removeClass("btn-secondary btn-utility")}function n(a){b.each(k,function(b,c){a.removeClass(b+"-sort")})}var l,k={price:"sp",duration:"st",departuretime:"sd",leg0departuretime:"sd0",leg1departuretime:"sd1",arrivaltime:"sa",leg0arrivaltime:"sa0",leg1arrivaltime:"sa1",stops:"st"};return g.View.extend({sortType:"sp",sortDirection:"asc",fetchOrigin:"Sort",initialize:function(c){var d=this;d.appView=c.appView,d.setElement(b("#sortBar")),d.hideSortByText(),m(),l=void 0,d.listenTo(j,"change",d.disable),d.listenTo(i.viewableOffers,"reset",d.enable),d.listenTo(i,"noFlightsFound",d.disable),d.model=c.model||new h,f.view.isByot&&(this.listenTo(a.vent,"router.noSelectedLegs",d.resetToDefaultSort),this.listenTo(a.vent,"router.selectedLegs",d.resetToDefaultSort))},events:{"change select":"requestSortedResults"},hideSortByText:function(){this.$el.hasClass("no-label")&&this.$el.removeClass("no-label").find(".inline-label").addClass("visuallyhidden")},getAjaxData:function(){var a={};return a[this.sortType]=this.sortDirection,a},requestSortedResults:function(){var b=this,g=b.$el.find("select").val(),h=b.$el.find("select option:selected"),i=h.text(),j=h.data("omnitureRfrr"),m=h.data("interstitialMessage")||e.sorting.interstitial.generic,o=g.split(":"),p=o[0],q=o[1];b.sortType=k[p],b.sortDirection=q,n(b.appView.offersCollectionView.$el),d.trackAction(j,h),c.utils.liveAnnounce(e.sorting.accessibility.sortingStart.replace("{0}",i),"polite"),a.vent.once("uiModel.resetViewableOffers",function(){var a=e.sorting.accessibility.sortingEnd;f.view.isByot&&require(["setupRouter"],function(a){l=""===a().getCurrentFragment()?0:1}),0===l&&(a=e.sorting.accessibility.announceDeparturePage),1===l&&(a=e.sorting.accessibility.announceReturnPage),c.utils.liveAnnounce(a.replace("{0}",i),"polite"),b.appView.offersCollectionView.$el.addClass(p+"-sort")}),b.model.set({
interstitialMessage:m,type:b.sortType,direction:b.sortDirection})},disable:function(){this.$el.find("select").attr("disabled","disabled")},disableOffCanvasToggle:function(){this.$el.find(".sort-bar-column button").attr("disabled","disabled")},enable:function(){this.$el.find("select").removeAttr("disabled")},enableOffCanvasToggle:function(){this.$el.find(".sort-bar-column button").removeAttr("disabled")},resetToDefaultSort:function(){var b=this,c="price-sort";b.$el.find("option:selected").prop("selected",!1),b.$el.find("option:first").prop("selected","selected"),b.model.clear({silent:!0}).set(b.model.defaults,{silent:!0}),b.sortType=b.model.get("type"),b.sortDirection=b.model.get("direction"),n(b.appView.offersCollectionView.$el),a.vent.once("uiModel.resultsFetchSuccess",function(){b.appView.offersCollectionView.$el.addClass(c)})}})}),define("staleDataModalView",["jquery","uitk","analytics","i18n","backbone"],function(a,b,c,d,e){"use strict";function f(a){a.find(".btn-label").text(d.sessionmodal.refreshSearch)}function g(a){a.attr({"data-omniture-rfrr":"SessionTimeout.Refresh","data-click-handler":"omnitureClickHandler"})}function h(a,b,c){a.click(function(){b.modalWrap.hide(),c.reloadStartUrl()})}return e.View.extend({initialize:function(){var c=this;b.subscribe("modal.appended",function(b,d){"modalSessionExpiredModalContent"===a(d.modalHtml).attr("id")&&c.handleSessionExpiredPopupTabbing()}),c.listenTo(c.model,"stale",c.renderModal),c.listenTo(c.model,"stale",function(){window.isStaleModeEnabled=!0})},reloadStartUrl:function(){var b=a("#sessionExpiredModalContent").data("researchurl"),c=window.location.href.split("#");b||(b=c[0]),window.location.href=b},renderModal:function(){var e,j,i={content:"sessionExpiredModalContent",modalId:"modalSessionExpiredModalContent",title:d.sessionmodal.countdownModalTimer,dataAttributes:"click-handler:sessionExpiredModal",classes:"click-handler-range",footer:!0,dismiss:!1,ajax:!1};return b.modal.close(),j=b.modal.create(i),c.updateOmnitureProperty("prop16","FLT.SR.SessionTimeout"),c.trackAction("FLT.SR.SessionTimeout",a("#modalSessionExpiredModalContent")),e=j.modalWrap.find(".modal-footer .modal-close"),g(e),f(e),h(e,j,this),j},handleSessionExpiredPopupTabbing:function(){setTimeout(function(){var b,c;a(".modal-wrap .modal-body").length>0&&(b=a("#footerModalCloseButton"),c=a("#modalSessionExpiredModalContent-title"),c.focus(),b.on("keydown",function(a){9!==a.keyCode||a.shiftKey||(a.preventDefault(),b.focus())}),c.on("keydown",function(a){9===a.keyCode&&a.shiftKey&&(a.preventDefault(),b.focus())}))},300)}})}),define("forceChoiceModalView",["flights","analytics","backbone","fluxClickHandler","handlebars","jquery","progress","uitk","experiments","configuration"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=function(a,b,c,d,e){return"/Flight-Search-Details?c="+f("#originalContinuationId").text()+"&tripId1= &offerId="+encodeURIComponent(c)+"&leg1="+e+"&leg2="+e+"&xsellchoice="+a+"&addHotelPackage="+b+"&isSplitTicket="+(1===i.getVariant(12942)?"false":d)};return c.View.extend({template:e.templates.xSellHotelForceChoice,modalInstance:void 0,initialize:function(c,e,g){this.selectedFlightData=c,this.crossSellModel=e,this.useAlternateXsellChoice=g&&g.useAlternateXsellChoice,this.render(),d.addHandler("xSellChoiceAddHotelNow",this.addHotelNowHandler,this),d.addHandler("forcedChoiceNoThanks",this.noThanksHandler,this),b.trackActionWithIncrement("FLT.SR.XSell.PKG.ForcedChoice.ModalDisplayed",f("#xSellHotelForcedChoice")),this.handleForcedChoicePopupTabbing(document.activeElement),this.listenTo(a.vent,"router.noSelectedLegs",this.closeModal)},render:function(){var b="",c=" ";this.$el.html(this.template(this.getModalContent())),i.execute("FORCED.CHOICE.SPLIT.TICKET",{modalContent:this.$el,selectedFlightData:this.selectedFlightData}),f("#forcedChoiceNoThanks").data(this.selectedFlightData),f("#xsellAddHotelNow").data(this.selectedFlightData),this.modalInstance=h.modal.create({content:this.$el,modalId:"xSellHotelForcedChoice",title:c,classes:b,closeBtn:!1,dismiss:!1}),c=f("#forcedChoiceModalTitle").html(),this.modalInstance.updateContent(this.$el.html(),c),a.vent.trigger("forcedChoiceModal.rendered")},getModalContent:function(){var a=this.selectedFlightData.tripId;return a&&(a=a.split(":").join("::")),{buttonData:this.selectedFlightData,defaultTitle:j.xsell.hotel.defaultBannerText,forcedChoiceLegalDisclaimer:j.xsell.hotel.forcedChoice.legalDisclaimer,defaultHref:j.xsell.hotel.defaultHref,tripId:a}},addHotelNowHandler:function(a,c,d){var e=f(a).data(),g=function(a){return a===!0||"string"==typeof a&&"true"===a.trim().toLowerCase()};d.closeModal(),g(e.isSplitTicket)&&1!==i.getVariant(12942)?(b.trackAction("FLT.SR.XSell.PKG.ForcedChoice.AddHotelNow.SplitTicket",f(a)),window.open(e.packageurl,"_blank").opener=null):g(e.isPackageable)?d.redirectToUDP(e,d.useAlternateXsellChoice):window.open(e.packageurl,"_blank").opener=null},noThanksHandler:function(a,b,c){var d=f(a).data(),e=h.createBrowserStorage("session");e.saveItems({xsellchoicekey:d.xsellchoice}),c.closeModal(),c.redirectToUDP(d,c.useAlternateXsellChoice)},closeModal:function(){void 0!==this.modalInstance&&this.modalInstance.close()},handleForcedChoicePopupTabbing:function(a){var b,c,d=f(".modal-wrap .xsell-aria-hidden");d.length>0&&(d.attr("aria-hidden","false"),c=d.children().first(),f(".modal-wrap .modal-title").focus(),b=f(".modal-wrap .btn-close"),b.on("click",function(){setTimeout(function(){f(a).focus()},600)}),b.on("keydown",function(a){9!==a.keyCode||a.shiftKey||(a.preventDefault(),c.focus())}),c.on("keydown",function(a){9===a.keyCode&&a.shiftKey&&(a.preventDefault(),b.focus())}))},redirectToUDP:function(a,b){var e,c=h.createBrowserStorage("session").readItem("xsellchoicekey")||"normal",d=a.addHotelPackage||!1;g.show("#udpAlertTitle"),navigator.userAgent.indexOf("iPad")>-1&&void 0!==f.browser.safari&&setTimeout(function(){g.hide()},5e3),b&&(c="showhotelbanneronly"),e=k(c,d,a.tripId,a.isSplitTicket,a.superlatives),this.windowNavigator.doRedirect(e)},windowNavigator:{doRedirect:function(a){j.udp.openInNewTab?window.open(a,"_blank").opener=null:this.openUrlInSameTab(a),g.hide()},openUrlInSameTab:function(a){window.location.assign(a)}}})}),define("xSellBannerView",["flights","jquery","handlebars","analytics","uitk","configuration","crossSellOfferView","backbone","underscore"],function(a,b,c,d,e,f,g,h,i){"use strict";function n(a){d.trackAction(l,a),m.saveItem(j,"true")}function o(a){var b,c;return"object"==typeof a&&(b=a.superlatives||[],b.length>0&&(c=i.findWhere(b,{superlativeType:"CHEAPESTXSELLOFFER"}))),c}var j="crossSell.isClosed",k="FLT.SR.XSell.PKG",l="FLT.SR.XSell.Close",m={STORAGE_TYPE:"session",uitkBrowserStorage:null,createUITKBrowserStorageIfNeeded:function(){function a(a){return"function"==typeof e.createBrowserStorage?e.createBrowserStorage(a):null}this.uitkBrowserStorage=this.uitkBrowserStorage||a(this.STORAGE_TYPE)},deleteItem:function(a){this.createUITKBrowserStorageIfNeeded(),"function"==typeof this.uitkBrowserStorage.deleteItem&&this.uitkBrowserStorage.deleteItem(a)},doesKeyExist:function(a){return this.createUITKBrowserStorageIfNeeded(),"function"==typeof this.uitkBrowserStorage.doesKeyExist&&this.uitkBrowserStorage.doesKeyExist(a)},readItem:function(a){return this.createUITKBrowserStorageIfNeeded(),"function"==typeof this.uitkBrowserStorage.readItem?this.uitkBrowserStorage.readItem(a):null},saveItem:function(a,b){this.createUITKBrowserStorageIfNeeded(),"function"==typeof this.uitkBrowserStorage.saveItem&&this.uitkBrowserStorage.saveItem(a,b.toString())},readItemAsJSON:function(a){return this.createUITKBrowserStorageIfNeeded(),"function"==typeof this.uitkBrowserStorage.readJSONAsObject?this.uitkBrowserStorage.readJSONAsObject(a):null},saveItemAsJSON:function(a,b){this.createUITKBrowserStorageIfNeeded(),"function"==typeof this.uitkBrowserStorage.saveAsJSON&&this.uitkBrowserStorage.saveAsJSON(a,b)}};return h.View.extend({template:c.templates.xSellBannerTemplate,crossSellOfferView:void 0,cheapestCrossSellOffer:void 0,initialize:function(c){var d=this;d.cheapestCrossSellOffer=o(c.searchResultsModel.get("summary")),d.href=c.href,d.bannerText=c.bannerText,d.isEnabled()&&d.render(),f.xsell.hotel.livePricing.enabled&&d.listenTo(d.model,"crossSellModel.updated",function(){var a;require(["setupRouter"],function(b){a=b()}),void 0!==a&&0!==a.getNextLegToView()||(d.updateBanner(),d.bindUserInteractionEvents())}),d.listenTo(a.vent,"router.noSelectedLegs",d.updateBanner),d.listenTo(a.vent,"router.selectedLegs",function(){b("#xsell-banner-default, #xsell-disclaimer").hide(),d.crossSellOfferView&&d.crossSellOfferView.empty()})},render:function(){var a=this.template({xsellHref:this.href,xsellMessage:this.bannerText});return b(a).insertAfter("#sortBar"),f.xsell.hotel.livePricing.enabled||b("#xsell-disclaimer").show(),this},showLivePriceBanner:function(){var a;b("#xsell-banner-default .xsell-link").attr("href",this.model.get("crossSellUrl")),a=this.model.get("saving"),b("#xsell-banner-default .xsell-description-livepricing").find(" .saving").text(a),b("#xsell-banner-default .xsell-description-livepricing").removeClass("hidden").fadeIn(),b("#xsell-banner-default").removeClass("hidden").fadeIn(),f.xsell.car.enabled||b("#xsell-disclaimer").hide()},showGenericBanner:function(){b("#xsell-banner-default .xsell-description").removeClass("hidden").fadeIn(),b("#xsell-banner-default").removeClass("hidden").fadeIn(),b("#xsell-disclaimer").show(),f.xsell.hotel.livePricing.threshold&&this.model.get("savingValue")<f.xsell.hotel.livePricing.threshold?d.trackImpression("FLT.SR.GenericBannerDisplayed.Threshold"):d.trackImpression("FLT.SR.GenericBannerDisplayed")},bindUserInteractionEvents:function(){var a=this,c=b("#xsell-banner-default");c.on(e.clickEvent,"button.btn-close",function(){n(this),c.hide(),f.xsell.car.enabled||c.hide()}),c.on(e.clickEvent,".xsell-link",function(){f.xsell.hotel.livePricing.enabled&&a.model.doesLivePricingExist()?a.model.logOmnitureClickTrackData("FLT.SR.XSell.PKG.Live.Pricing",this):d.trackAction(k,this)})},updateBanner:function(){this.isEnabled()&&(this.model.doesLivePricingExist()?(f.xsell.hotel.livePricing.brandedDealEnabled&&void 0!==this.cheapestCrossSellOffer&&this.setupCrossSellOfferView(),f.xsell.hotel.livePricing.brandedDealEnabled&&void 0!==this.crossSellOfferView?this.crossSellOfferView.render():this.showLivePriceBanner()):this.showGenericBanner())},setupCrossSellOfferView:function(){var a=this,c=a.cheapestCrossSellOffer,d=f.view.isByot;void 0!==c&&(c.offer.legs=[],b.each(c.offer.legIds,function(a,b){c.offer.legs[a]=c.legs[b]}),d===!0&&(c.offer.legs=[c.offer.legs[0]]),a.crossSellOfferView=new g({crossSellOffer:c.offer,crossSellModel:a.model}))},isEnabled:function(){return!m.doesKeyExist(j)}})}),define("standardOfferDetailsView",["flights","uitk","jquery","handlebars","standardBaggageFeeView","analytics","configuration","i18n","backbone","loyaltyPointsCollection","flightDetailsLoyaltyEarnView","sitebrand"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){var j,n,o,r,s,d=this.model,f=d.attributes,h=d.get("naturalKey"),i=c('div[data-offer-natural-key="'+h+'"]').siblings(".details-holder"),k="flight-details-tabs",l=!0,m=g.showFreeCancellationInDetails,p="object"==typeof f.partnerLoyaltyData&&f.partnerLoyaltyData.length>0,q=p?f.partnerLoyaltyData:[],t=function(a){if(a.paybackEnabled!==!1)return a.isFlexibleShopping===!1?"pb_flight_search_results_message":a.ab10895status===!0?"Payback2XPointsPromoContent":"pb_flight_search_results_message_MIS"},u=function(a){var b="";return b+=1===a?"singleTraveler":"multiTraveler",b+=g.route.isOneWay?"OneWayPricing":g.route.isMultiDest?"MultiDestPricing":"RoundtripPricing",g.removeFeesFromTitleLegalese&&(b+="NoFeesText"),b};this.standardBaggageFeeView=new e({model:{offer:d},el:this.el}),j=this.standardBaggageFeeView.model.legs,1===j.length&&(k=k.concat(" hide-tabs")),c.each(j,function(a,b){b.tabId="offer-leg"+a+"-details",b.legAttributes="leg-index:"+a+"|click-handler:omnitureClickHandler|omniture-rfrr:FLT.SR.Details.Leg"+a+"|test-id:leg-details-tab",b.selected=(0===a).toString(),b.price.feesMessage.isShowBestPriceGuarantee||(l=!1),b.price.feesMessage.isShowFreeCancellation||(m=!1)}),s={offer:f,legs:j,classes:k,selectedCabinClass:a.Wizard.searchParameters.flightClass,totalPassengers:a.Wizard.searchParameters.totalTravelers,testAndLearn:{brandedDeals:{isNotCrossSellOffer:!(g.xsell.hotel.livePricing.brandedDealEnabled&&h.indexOf("crossselloffer")>-1)}},showBestPriceGuarantee:l,showFreeCancellation:m,obFeeThinListing:g.obFeeThinListing,showBestPriceGuaranteeAndFreeCancellation:!g.route.isMultiDest,loyalty:{enabled:g.loyalty.enabled,showPoints:!g.loyalty.isTaapAgentOnNectarSite&&(g.loyalty.enabled||!g.route.isMultiDest&&g.loyalty.nectarEnabled),showMessaging:g.loyalty.showMessaging,programName:g.loyalty.programName,logoUrl:g.loyalty.detailsLogoUrl,nectar:{promo2XEnabled:g.loyalty.nectar2XPromoEnabled,enabled:g.loyalty.nectarEnabled,sterlingEnabled:g.loyalty.nectarSterlingEnabled,points:g.loyalty.nectarPoints,creditWindowDays:g.loyalty.nectarCreditWindowDays},payback:{enabled:g.loyalty.paybackEnabled,points:g.loyalty.paybackPoints,staticEarnMessageEnabled:g.loyalty.staticEarnMessageEnabled,ab10895status:g.loyalty.ab10895status},tooltipContentLocStringId:t({paybackEnabled:g.loyalty.paybackEnabled,ab10895status:g.loyalty.ab10895status,isFlexibleShopping:!g.path.isFlightOnly})},isFlexibleShopping:!g.path.isFlightOnly,freeCancellationTooltip:g.freeCancellationTooltip,totalPriceMessageLocStringId:u(a.Wizard.searchParameters.totalTravelers),freeCancellationLink:g.freeCancellationLink,showObFeeMessageFFOP:g.showObFeeMessageFFOP},p===!0&&(void 0!==b.avion&&(o=b.avion),s.partnerLoyalty=p,void 0===o?s.avionPricing=!1:(s.avion=o,s.avionPricing=!0,s.partnerLoyaltyDataNonAvion=q[1],s.totalPriceMessageLocStringIdAvion="PartnerLoyalty_Avion"+s.totalPriceMessageLocStringId),s.partnerLoyaltyData=q[0],s.totalPriceMessageLocStringId="PartnerLoyalty_"+s.totalPriceMessageLocStringId),n=this.template(s),r=c(n),r.insertAfter(i),this.createLoyalty(r,d),b.publish("FSR.Details.Opened",f.index)}function n(a){var d=[];return c.each(a.timeline,function(a,c){var e;return c.layover?"continue":(e=b.utils.createLocalizedDate(c.departureTime.date,l.locale).date,void d.push({fromAirportCode:c.departureAirport.code,toAirportCode:c.arrivalAirport.code,duration:{hours:c.duration.hours,minutes:c.duration.minutes},flightNumber:c.carrier.flightNumber,airCode:c.carrier.planeCode,airline:c.carrier.airlineName,airlineCode:c.carrier.airlineCode,equipmentType:c.carrier.plane,bookingCode:c.carrier.bookingCode,date:e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}))}),d}return i.View.extend({template:d.templates.moduleDetailsTemplate,events:{"click .flight-details-link":"toggleFlightDetails","click .tab [data-leg-index]":"showLegMarkupByIndex","click .seat-map-link":"showSeatMap","keypress .flight-details-link":"toggleFlightDetailsWithKeyPress"},toggleFlightDetailsWithKeyPress:function(a){32===a.keyCode&&(a.preventDefault(),this.toggleFlightDetails(a))},showLegMarkupByIndex:function(a){var f,d=c(a.currentTarget),e=d.data("leg-index");this.$el.find('.details-confidence-messaging[data-leg-index="'+e+'"]').show(),this.$el.find('.details-confidence-messaging:not([data-leg-index="'+e+'"])').hide(),0===e&&(f=h.standardofferdetails.accessibility.departureDetailsDisplayed),1===e&&(f=h.standardofferdetails.accessibility.returnDetailsDisplayed),g.route.isMultiDest&&(f=h.standardofferdetails.accessibility.tripIndexDetailsDisplayed.replace("{{tripIndex}}",e+1)),b.utils.liveAnnounce(f,"polite")},toggleFlightDetails:function(a){a.preventDefault();var d=c(this.el).find(".flight-details-link"),e="open",f=d.hasClass(e);f?(this._hideFlightDetails(),d.removeClass(e).attr("aria-expanded","false"),b.utils.liveAnnounce(h.standardofferdetails.accessibility.detailsCollapsed,"polite")):(this._showFlightDetails(),d.addClass(e).attr("aria-expanded","true"),b.utils.liveAnnounce(h.standardofferdetails.accessibility.detailsExpanded,"polite"))},_showFlightDetails:function(){var a=this.model.get("naturalKey"),b="FLT.SR.DetailsExpand";g.xsell.hotel.livePricing.brandedDealEnabled&&a.indexOf("crossselloffer")>-1&&(b="FLT.SR.DifferentiatedListing.DetailsExpand"),m.call(this),this.$el.addClass("open"),this.$el.find('.details-confidence-messaging:not([data-leg-index="0"])').hide(),this.$el.find(".hide-flight-details").closest(".flight-details-link").focus(),f.trackActionWithIncrement(b,this.$el.find(".show-flight-details")[0])},_hideFlightDetails:function(){var a=this.model.get("naturalKey"),b="FLT.SR.DetailsHide";g.xsell.hotel.livePricing.brandedDealEnabled&&a.indexOf("crossselloffer")>-1&&(b="FLT.SR.DifferentiatedListing.DetailsHide"),this.$el.removeClass("open"),this.$el.find(".flight-details").remove(),f.trackActionWithIncrement(b,this.$el.find(".hide-flight-details")[0])},showSeatMap:function(a){var d=parseInt(c(a.currentTarget).data("legIndex"),10),e=this.standardBaggageFeeView.model.legs;window.seatmap.show({flights:n(e[d]),configuration:{omniturePrefix:"FLT.SR"}}),b.publish("FSR.Seatmap.Opened")},createLoyalty:function(a,b){var c=b.get("naturalKey").indexOf("crossselloffer")>-1;j.isLoyaltyOfferEnabled&&!c&&(this.loyaltyView=new k({model:j,el:a,offer:b,loyaltyInfo:g.loyalty}))}})}),define("standardBaggageFeeView",["flights","jquery","handlebars","configuration","backbone","baggageFeeView","i18n","cacheModel"],function(a,b,c,d,e,f,g,h){"use strict";function i(){c.registerHelper("displayDetailInfoFlux",function(a,b){var d="",e=g.bagWeightDetails;return"NO_FEE"==b?null!=a&&"upto"==a.weightDesc?("kg"==a.unitOfWeight?d=e.noFeeTagKg:"lbs"==a.unitOfWeight&&(d=e.noFeeTagLbs),d=d.replace("{weight}",a.weight)):d=e.noFeeTag:(null!=a&&"upto"==a.weightDesc?("kg"==a.unitOfWeight?d=e.feeTagKg:"lbs"==a.unitOfWeight&&(d=e.feeTagLbs),d=d.replace("{weight}",a.weight)):null!=a&&"per"==a.weightDesc?"kg"==a.unitOfWeight?d=e.bagPerKg:"lbs"==a.unitOfWeight&&(d=e.bagPerLbs):d=e.feeTag,d=d.replace("{fee}",b)),new c.SafeString(d)})}return f.extend({template:c.templates.detailsBaggageFeeInfoTemplate,inlineAjaxUrl:"/api/flight/bagfeesmcfilterbyac",externalPageUrl:"/Flights-BagFeesFilterByAC?",initialize:function(){this.cachedBaggageFeeInfo=new h,f.prototype.initialize.apply(this,arguments),this.render(),i()},events:{"click a.baggageFeeLink":"baggageFeeLinkHelper"},_renderBaggageFeeMarkup:function(a){var c=a.legIndex,d=a.responseText,e=a.showBaggageFeeOnPurchaseMsg,f=a.showBaggageFeeIncludedMsg;b(this.el).find(".details-baggage-fee-info .loader-container").remove(),b(b(this.el).find(".details-baggage-fee-info")[c]).append(this.template({baggageFees:b.parseJSON(d),legIndex:c,showBaggageFeeOnPurchaseMsg:e,showBaggageFeeIncludedMsg:f}))},_isResponseCached:function(a){return this.cachedBaggageFeeInfo.containsEntry(a)},_cacheCurrentResponse:function(a,b,c){this.cachedBaggageFeeInfo.putEntry(a,{legIndex:b,responseText:c})},_retrieveCachedResponse:function(a){return this.cachedBaggageFeeInfo.getCachedEntry(a)},_getFlightSegments:function(a){for(var b,c,d=[],e=a.timeline.length,f=0;f<e;f++)b=a.timeline[f],"undefined"!=typeof b.segment&&b.segment===!0&&(c={originapt:b.departureAirport.code,destinationapt:b.arrivalAirport.code,cabinclass:b.carrier.cabinClass,mktgcarrier:b.carrier.airlineCode,opcarrier:b.carrier.operatedByAirlineCode,bookingclass:b.carrier.bookingCode,farebasis:a.fareBasisCode||"",traveldate:b.departureTime.travelDate,flightnumber:b.carrier.flightNumber,segmentnumber:d.length+1},d.push(c));return d},render:function(){var c,d,a=this;return b.each(a.model.legs,function(e,f){a._isResponseCached(f.naturalKey)?setTimeout(function(){d=a._retrieveCachedResponse(f.naturalKey),d.showBaggageFeeOnPurchaseMsg=f.price.feesMessage.showBaggageFeeOnPurchaseMsg,d.showBaggageFeeIncludedMsg=f.price.feesMessage.showBaggageFeeIncludedMsg,a._renderBaggageFeeMarkup(d)},0):(c=a.model.fareBasisDetails[f.naturalKey],b.ajax({type:"POST",contentType:"application/json",url:"/api/flight/bagfeesmcfilterbyacv2",data:JSON.stringify(a._getFlightSegments(f)),dataType:"json",timeout:3e3}).success(function(b){a._cacheCurrentResponse(f.naturalKey,e,JSON.stringify(b))}).complete(function(b){var c=f.price.feesMessage.showBaggageFeeOnPurchaseMsg,d=f.price.feesMessage.showBaggageFeeIncludedMsg;a._renderBaggageFeeMarkup({legIndex:e,responseText:b.responseText,showBaggageFeeOnPurchaseMsg:c,showBaggageFeeIncludedMsg:d})}))}),this}})}),define("routeHappyView",["flights","jquery","handlebars","backbone","underscore","experiments"],function(a,b,c,d,e,f){"use strict";return d.View.extend({template:c.templates.rhSuperlativeTemplate,initialize:function(a){this.renderOnEachUpdate="object"==typeof a&&a.renderOnEachUpdate===!0,this.useLegLevelInfo="object"==typeof a&&a.useLegLevelInfo===!0,this.getOfferElement=a&&"function"==typeof a.getOfferElement?a.getOfferElement:void 0},renderRouteHappyInfo:function(a,b){var d=this;!d.renderOnEachUpdate&&a&&"client"===a.source||b.each(function(a){var i,j,k,l,m,b=a.id,e=d.getOfferElement(b),f=d.getRouteHappyElement(b),g=a.toJSON(),h=g.rating;if(0!==e.length&&0!==f.length){if(!0===d.useLegLevelInfo){if(j=e.find("[data-leg-natural-key]"),0===j.length)return;if(i=j.data().legNaturalKey,k=g.legs.get(i),void 0===k)return;h=k.get("rating")}l=d.getDescription(h.score),m=c.templates.rhSuperlativeLinkContent({scoreDescription:l,flightScoreValue:h.score}),f.html(d.template({linkContent:m,extraClasses:d.getExtraClasses(h.score)}))}})},getExtraClasses:function(a){var b="";return a=a.replace(",","."),a=parseFloat(a),a>=0&&a<=4.9?b="poor":a>=5&&a<=5.9?b="fair":a>=6&&a<=6.9?b="satisfactory":a>=7&&a<=7.4?b="good":a>=7.5&&a<=8.4?b="very-good":a>=8.5&&a<=10&&(b="excellent"),b},getRouteHappyElement:function(b){return this.getOfferElement?this.getOfferElement(b).find(".route-happy-superlative"):void a.log("getOfferElement has not been defined")},getDescription:function(a){var d,b=this.useLegLevelInfo===!0,c="views_default_controls_flight_searchresults_flux_offerstrings.";return a=a.replace(",","."),a=parseFloat(a),a>=0&&a<=4.9?d=c+(b?"poorFlight":"poorFlights"):a>=5&&a<=5.9?d=c+(b?"fairFlight":"fairFlights"):a>=6&&a<=6.9?d=c+(b?"satisfactoryFlight":"satisfactoryFlights"):a>=7&&a<=7.4?d=c+(b?"goodFlight":"goodFlights"):a>=7.5&&a<=8.4?d=c+(b?"veryGoodFlight":"veryGoodFlights"):a>=8.5&&a<=10&&(d=c+(b?"excellentFlight":"excellentFlights")),d}})}),define("operatedByStringBuilder",["i18n"],function(a){"use strict";var b=function(b){var c,d=[],e=function(a){var b=[],c=_.chain(a).filter(function(a){return a.layover===!1&&a.segment===!0}).filter(function(a){return""!==a.carrier.operatedBy}).map(function(a){return a.carrier}).groupBy(function(a){return a.airlineName}).value();return _.each(c,function(a){b.push(_(a).groupBy("operatedBy"))}),b},f=function(a){return _.map(a,function(a){return a.flightNumber})},g=function(b,c,d,e){return 1===d.length?e=a.operatedBy.operatedByListEnd.replace("{{operatedByList}}",e).replace("{{finalFlightNumber}}",_(d).first()):d.length>1?(e=a.operatedBy.operatedByList.replace("{{operatedByList}}",e).replace("{{flightNumberToAppend}}",_(d).first()),g(b,c,_(d).rest(),e)):e},h=function(b,c,d){var e=a.operatedBy.operatedByListInitial.replace("{{airlineName}}",b).replace("{{flightNumber}}",_(d).first());return e=g(b,c,_(d).rest(),e),a.operatedBy.operatedBy.replace("{{operatedByListEnd}}",e).replace("{{operatingAirline}}",c)};return c=e(b),_.each(c,function(a){_.each(a,function(a){d.push(h(a[0].airlineName,a[0].operatedBy,f(a)))})}),d.join("<br/>")};return b}),require(["operatedByStringBuilder"]),define("mixedCabinClassMessageView",["flights","jquery","handlebars","backbone","underscore"],function(a,b,c,d,e){"use strict";function g(a){var c=!1;return!j(f.selectedCabin)&&(b.each(a,function(a,d){if(b.each(d.timeline,function(a,b){if(c=b.segment&&h(b))return!1}),c)return!1}),c)}function h(a){var b=parseInt(a.carrier.cabinClass,10),c=j(b),d=5===f.selectedCabin,e=f.selectedCabin<b;return d&&c||!d&&e}function i(){var a=e.findWhere(f.cabinClassList,{code:f.selectedCabin.toString()});return a?a.name:""}function j(a){return 3===a}var f;return d.View.extend({template:c.templates.mixedCabinClassMessageTemplate,initialize:function(b){var c=this;f=b,c.setElement("#mixed-cabin-class-message"),c.listenTo(a.vent,"uiModel.resultsFetchSuccess",function(){c.render()})},render:function(){var b;try{b=a.collections.legsCollection.models[0].attributes}catch(b){return void a.log("MixedCabinClassMessageView: "+b)}g(b)&&this.displayMessage()},displayMessage:function(){this.$el.html(this.template({selectedCabinClassText:i()})),this.$el.removeClass("hide"),b("#info-about-results").removeClass("hide")}})}),define("airAttachModel",["flights","jquery","dctk/dctk","configuration","backbone","underscore"],function(a,b,c,d,e,f){"use strict";var g="AJAX-Fail";return e.Model.extend({url:"/Recommender-Ajax",timeout:d.xsell.hotel.livePricing.timeout,defaults:{packageModels:[],totalResultsCount:0,errorCode:0},request:{},ajaxCallStartTime:0,crossSellModel:{},initialize:function(a){this.crossSellModel=a.crossSellModel,this.initializeRequest(a.singlePageModel)},convertDateStringFromISOtoUSFormat:function(a){var b=a.split("-");return b[1]+"-"+b[2]+"-"+b[0]},initializeRequest:function(b){var c="";a.Model.Wizard.childCount>0&&(c=("1_"+a.Model.Wizard.childAges.toString()).replace(/\,/g,",1_")),this.request={scenario:"fsr",sdate:this.convertDateStringFromISOtoUSFormat(b.get("departureISODate")),edate:this.convertDateStringFromISOtoUSFormat(b.get("arrivalISODate")),dest:encodeURIComponent(b.get("arrivalAirportCode")),otla:b.get("departureAirportCode"),dtla:b.get("arrivalAirportCode"),adults:a.Model.Wizard.adultCount,seniors:"0",children:c,infantInLap:a.Model.Wizard.infantsInLap,rule:"flight-hotel-xsell",bdls:!1}},getResults:function(d,e,f,h){var i=this,j=i.request,k=["object=livePricingAjaxHandler","function=request"],l=i.helpers.getCheapestXSellOffer(d),m=0;return e=e||"5",f=f||!1,h=h||"-1",null===l?void i.updateResponse(null,!1):(j=b.extend(!0,{pkid:l.piid,count:e,bdls:f,sort:h},j),k=k.concat(a.utils.objToStringArray(j,"options-")),void this.fetch({data:j,timeout:i.timeout,success:function(b,d,e){var f=b.get("packageModels")||[];f.length>0?(i.updateResponse(f),i.crossSellModel.logOmnitureImpressionTrackData("Air Attach Pricing")):(i.updateResponse(f),k=k.concat(a.utils.objToStringArray(d,"response-")),0!==d.errorCode?c.loggingAdapter.logMessage("RECOMMENDER-SERVICE-RETURN-ERROR",k):c.loggingAdapter.logMessage("RECOMMENDER-SERVICE-RETURN-ZERO-RESULT",k)),m=(new Date).getTime()-i.ajaxCallStartTime,c.loggingAdapter.logTrxEvent("getLivePricing",["clEventName01=getLivePricing-Success","clEventTime01="+m]),i.ajaxCallStartTime=0},error:function(a,b,d){i.updateResponse(),k.push("attemptsCount="+d.attemptsCount),k.push("maxAttempts="+d.maxAttempts),k.push("callback=fail"),k.push("statusParameter="+b.status),k.push("errorParameter="+b.statusText),c.loggingAdapter.logMessage(g,k),m=(new Date).getTime()-i.ajaxCallStartTime,c.loggingAdapter.logTrxEvent("getLivePricing",["clEventName01=getLivePricing-Failure","clEventTime01="+((new Date).getTime()-i.ajaxCallStartTime)]),i.ajaxCallStartTime=0},beforeSend:function(a,b,c){i.ajaxCallStartTime=(new Date).getTime()}}))},helpers:{getCheapestXSellOffer:function(a){a=a.toJSON();var b=a.summary.superlatives||[],c=null;return b.length>0&&(c=f.findWhere(b,{superlativeType:"CHEAPESTXSELLOFFER"}),void 0!==c)?c:null}},updateResponse:function(c){var d,e,f,g,h='<b id="package-saving-info">Save up to '+g+"</b> when you book your Flight and Hotel together.",i=null,j=[],k=null,l=["FREE_FLIGHT","HOTEL_DEAL","FREE_HOTEL","FREE_HOTEL_NIGHTS"];c=c||[],c.length>0?(g=decodeURIComponent(c[0].savingsNoDecimal),d=c[0].urlToPackageSearch+"&hotelIds="+c[0].hotelModel.hotelId,b.each(c,function(a,c){if(j=c.brandedDeals||[],b.each(j,function(a,d){if(-1<b.inArray(d.brandedDealVariation,l))return i=c,k=d,!1}),null!==k)return!1}),e={saving:g,savingValue:c[0].savingsValue,crossSellUrl:d,crossSellDeal:c[0],xSellDescription:h,brandedDeal:i,brandedDealVariation:k},f=this.retrieveOmnitureTrackData(e),e=b.extend(e,f),this.crossSellModel.set(e)):this.crossSellModel.set(this.crossSellModel.defaults),this.crossSellModel.trigger("crossSellModel.updated"),a.vent.trigger("crossSellModel.updated",{crossSellModel:this.crossSellModel})},retrieveOmnitureTrackData:function(a){var m,b="",c=0,d="",e=0,f=0,g=0,h="",i="",j="event57",k=a.crossSellDeal,l=null!==a.brandedDeal;return l&&(k=a.brandedDeal),h=decodeURIComponent(k.hotelModel.hotelId),b=decodeURIComponent(k.savingsValue),d=decodeURIComponent(k.totalPriceValue),c=parseFloat(b,10),e=parseFloat(d,10),isNaN(c)||isNaN(e)||(f=e+c,g=Math.round(c/f*100),c=10*Math.round(c/10),i="N:"+c+":"+g+":"+(l?"Y":"N"),l&&a.brandedDealVariation&&a.brandedDealVariation.brandedDealVariation&&(m=":"+a.brandedDealVariation.brandedDealVariation)),{omnitureImpressionTrackVar:{products:"PkgHotel;Merchant PkgHotel:"+h+";;;"+j+"=1;eVar59="+i},omnitureClickTrackVar:{products:"PkgHotel;Merchant PkgHotel:"+h+";;;event58=1;eVar59="+i,eVar59:i},dctkVariableBrandedDealModifier:m}}})}),define("crossSellModel",["flights","analytics","configuration","backbone"],function(a,b,c,d){"use strict";return d.Model.extend({defaults:{saving:"",crossSellUrl:"",packageModels:[]},hideLivePricingLoader:function(){return this.doesLivePricingExist()},doesLivePricingExist:function(){var a=this.get("saving")||"",b=this.get("savingValue")||-1,d=c.xsell.hotel.livePricing.threshold;return""!==a&&b>d},doesBrandedDealExist:function(){var a=this.get("brandedDeal")||"";return""!==a},logOmnitureImpressionTrackData:function(a){var d="event57",e=this.get("omnitureImpressionTrackVar"),f=this.get("dctkVariableBrandedDealModifier");"undefined"!==e&&(c.xsell.hotel.livePricing.brandedDealEnabled===!0&&(e.products+=f),b.trackImpression(a,e,d))},logOmnitureClickTrackData:function(a,d){var e="event58",f=this.get("omnitureClickTrackVar"),g=this.get("dctkVariableBrandedDealModifier");"undefined"!==f&&(c.xsell.hotel.livePricing.brandedDealEnabled===!0&&(f.products+=g,f.eVar59+=g),b.trackAction(a,d,f,e))}})}),define("flightDeltaModel",["flights","jquery","configuration","backbone"],function(a,b,c,d){"use strict";return d.Model.extend({url:"/api/userhistory/airsearchdeltainteraction",timeout:1e4,historyModel:{},deltaModel:{deltaModelAvailable:!1},request:{},isUserRegistered:"",initialize:function(a){this.initializeRequest(a),this.isUserRegistered=a.get("isUserRegistered")},initializeRequest:function(a){this.request={departureAirport:a.get("departureAirportCode"),arrivalAirport:a.get("arrivalAirportCode"),apwMaxDays:0,departureISODate:a.get("departureISODate"),arrivalISODate:a.get("arrivalISODate"),routeTypeName:"ROUND_TRIP"}},fetchFlightHistories:function(){var a=this;c.scratchpadModal.flightDelta.isSearchMatchAPW&&!c.scratchpadModal.flightDelta.trackChange&&c.scratchpadModal.flightDelta.continuousShoppingApwPlusPriceDeltaEnabled&&this.fetch({type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(this.request),timeout:this.timeout,success:function(b,c,d){var e=JSON.parse(c);"SUCCESS"===e.deltaMessageStatus&&a.helper.shouldShowDelta(e.searchTime)&&(a.historyModel.priceAmount=e.priceAmount,a.historyModel.currencySymbol=e.currencySymbol,a.historyModel.formattedPrice=e.formattedPrice,a.historyModel.searchDate=e.searchDate,a.historyModel.historyModelAvailable=!0)},error:function(b,c,d){a.historyModel.historyModelAvailable=!1}})},setPriceDeltaModelDetail:function(a){var c,d,b=this;c=b.helper.getCheapestPriceOfCurrentSearch(a),void 0!==c&&!0===b.historyModel.historyModelAvailable&&(d=Math.round(100*(c-b.historyModel.priceAmount))/100,b.deltaModel.priceAmount=c,b.deltaModel.priceDeltaAmount=d,b.deltaModel.priceDelta=b.helper.formatPriceDelta(b.historyModel.currencySymbol,d),b.deltaModel.priceChange=b.helper.hasChanged(d),b.deltaModel.searchDate=b.historyModel.searchDate,
b.deltaModel.deltaModelAvailable=!0)},helper:{getCheapestPriceOfCurrentSearch:function(a){var e,c=a.get("offers"),d=a.get("index");return void 0!==c&&b.each(d,function(a,b){var d=c[b];if(!d.bargainOffer)return e=d.price.exactPrice,!1}),e},hasChanged:function(a){return a>0?1:a<0?-1:0===a?0:void 0},formatPriceDelta:function(a,b){if(0===b)return"";var c=a+Math.abs(b),d=c.indexOf(".");return c=d!==-1&&2===c.substr(d).length?c+"0":c},shouldShowDelta:function(a){return(new Date).getTime()-a>60*c.scratchpadModal.flightDelta.timeElapsedSinceLastSearch*1e3}}})}),define("flightDeltaView",["flights","jquery","flightDeltaModel","handlebars","scratchpadModal","singlePageModel","configuration","analytics","backbone","i18n"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return i.View.extend({singlePageModel:new f,flightDeltaModel:{},initialize:function(){var b=this;b.flightDeltaModel=new c(b.singlePageModel),b.flightDeltaModel.fetchFlightHistories(),b.listenTo(a.vent,"uiModel.resultsFetchSuccess",function(a){b.renderFlightDeltaView(a.model)})},renderFlightDeltaView:function(a){var b=this;b.flightDeltaModel.setPriceDeltaModelDetail(a),g.scratchpadModal.flightDelta.isSearchMatchAPW?!0===g.scratchpadModal.flightDelta.continuousShoppingApwPlusPriceDeltaEnabled?b.renderApwCombinePriceDeltaOptinModal():b.renderApwOptinModal():b.renderDefaultOptinModal()},getCheapestPriceOfCurrentSearch:function(a){var b=this.flightDeltaModel.helper.getCheapestPriceOfCurrentSearch(a);return b},renderPriceDeltaOptinModal:function(){var a=e.model.sessionStorage.readJSONAsObject("scratchpadOptinStatus"),c=this.flightDeltaModel.deltaModel;e.model.userScratchpadOptinActivity.MAYBE_LATER!==a&&(b("a#scratchpadOptin").length>0&&b("a#scratchpadOptin").addClass("visually-hidden"),e.showOptinModal(!0),b("#scratchpadOptin-title").length>0&&b("#scratchpadOptin-title").attr("aria-live","assertive"),c.flightPriceDeltaTextTemplate=d.templates.flightPriceDeltaTextTemplate({deltaModel:c}),b("#flightPriceDeltaTextDiv").html(c.flightPriceDeltaTextTemplate),b("#scratchpadOptin.modal-wrap").addClass("left-aligned"),b("#send-me-notes-button span.btn-label").html(b("#trackChangesLink").val()),b("#scratchpadOptin.modal-wrap a.modal-close").text(b("#maybeLaterLink").val()),0===c.priceChange?(b("#scratchpadOptin-title").html(b("#headerUnchangedText").val()),b("#scratchpadOptin.modal-wrap div.modal-body p").html(b("#bodyUnchangedInfoText").val()),uitk.utils.liveAnnounce(b("#headerUnchangedText").val()),this.omnitureTracking("PriceNC")):1===c.priceChange?(b("#scratchpadOptin.modal-wrap div.modal-body p").html(b("#bodyChangedInfoText").val()),b("#scratchpadOptin.modal-wrap div.modal-body").addClass("delta-padding"),b("#scratchpadOptin-title").html('<div class="delta-icon"><img src="/static/default/default/images/scratchpad/up-60px.png" height="36px" width="36px" alt="up arrow"/></div><div class="delta-text">'+b("#headerPriceUpText").val()+"</div>"),uitk.utils.liveAnnounce(b("#bodyChangedInfoText").val()),this.omnitureTracking("PriceUp")):(b("#scratchpadOptin.modal-wrap div.modal-body p").html(b("#bodyChangedInfoText").val()),b("#scratchpadOptin.modal-wrap div.modal-body").addClass("delta-padding"),b("#scratchpadOptin-title").html('<div class="delta-icon"><img src="/static/default/default/images/scratchpad/down-60px.png" height="36px" width="36px" alt="down arrow"/></div><div class="delta-text">'+b("#headerPriceDownText").val()+"</div>"),uitk.utils.liveAnnounce(b("#bodyChangedInfoText").val()),this.omnitureTracking("PriceDown")))},renderApwOptinModal:function(){e.afterSearchSuccess()},renderGenericOptinModal:function(){e.afterSearchSuccess()},renderDefaultOptinModal:function(){var a=this.flightDeltaModel.deltaModel.deltaModelAvailable===!0;a?this.renderPriceDeltaOptinModal():this.renderGenericOptinModal()},renderApwCombinePriceDeltaOptinModal:function(){var a=this.flightDeltaModel.deltaModel.priceDeltaAmount,b=this.flightDeltaModel.deltaModel.priceAmount,c=g.scratchpadModal.flightDelta.continuousShoppingPriceThreshold,d=g.scratchpadModal.flightDelta.growthRateGtCSPriceThreshold,e=g.scratchpadModal.flightDelta.growthRateLtCSPriceThreshold;a>0?b>=c&&Math.abs(a)>d*b/100?this.renderPriceDeltaOptinModal():b<c&&Math.abs(a)>e*b/100?this.renderPriceDeltaOptinModal():this.renderApwOptinModal():a<0?this.renderPriceDeltaOptinModal():this.renderApwOptinModal()},omnitureTracking:function(a){var c=b("#scratchpadOptin.modal-wrap"),d=c.find("a.modal-close"),e=c.find("button.modal-close"),f=b("#send-me-notes-button"),g="FLT.SR.PriceChange.ScratchpadMaybeLaterLink.Select",i="FLT.SR.PriceChange.ScratchpadModalClose.Close",j="FLT.SR.PriceChange.ScratchpadTrackChanges.Select",k="FLT.SR.PriceChange.ScratchpadInOpt";d.addClass("click-handler-range").attr("data-omniture-rfrr",g.replace("PriceChange",a)),e.addClass("click-handler-range").attr("data-omniture-rfrr",i.replace("PriceChange",a)),f.addClass("click-handler-range").attr("data-click-handler","createPriceAlertScratchpadModal,omnitureClickHandler").attr("data-omniture-rfrr",j.replace("PriceChange",a)),h.trackImpression("Scratchpad Modal Impression",{eVar28:k.replace("PriceChange",a)})}})}),define("priceTrendsChart",["jquery","i18n","analytics","dctk/dctk","handlebars","configuration"],function(a,b,c,d,e,f){"use strict";function h(a){d&&d.logging&&d.logging.logMessage&&d.logging.logMessage(a)}function i(a,b){for(var c=a.split("."),d=c[0],e=c.length>1?"."+c[1]:"",f=/(\d+)(\d{3})/;f.test(d);)d=d.replace(f,"$1"+b.thousandSeparator+"$2");return d+e}function j(a){var b=new Date(a);return new Date(Date.UTC(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0,0))}function k(){var a=new Date;return a.setDate(a.getDate()-1),new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0))}function l(a){return Math.round(a)}function m(a,b){var c=a-b;return Math.abs(c/1e3/60/60/24)}function n(a){var b=0,c=a.priceTrends.trendsList.length-1;return Math.abs(a.priceTrends.trendsList[b].averagePrice-a.priceTrends.trendsList[c].averagePrice)}function o(a,b){return i(a.toString(),b)}function p(a,b){var c=new google.visualization.NumberFormat({pattern:b.priceFormatPattern});return c.formatValue(a)}function q(a,b){var c=new google.visualization.DateFormat({pattern:b.dateFormatPattern});return c.formatValue(a)}function r(a,b){var c=a.priceTrends.trendsList[0].averagePrice,d=a.priceTrends.trendsList[a.priceTrends.trendsList.length-1].averagePrice;return c>=d+b.priceTrendDelta?b.priceTrendFall:d>=c+b.priceTrendDelta?b.priceTrendRise:b.priceTrendUnchanged}var g;return g={data:null,createPriceAlertLoaderTimer:null,submitted:"",mainConfig:null,$graphContainer:null,renderGraph:function(b){var c,d=this;return void 0===b?void h("Options is undefined and we can't render the graph."):(c=b.config,this.mainConfig=b.mainConfig,void a.ajax({url:"/priceTrends",type:"GET",cache:!1,dataType:"json",timeout:5e3,data:{origin:c.departureAirportCode,destination:c.arrivalAirportCode,departureDate:c.departureDate,tpid:c.tpid,eapid:c.eapid},success:function(a){var e;return d.isResponseValid(a)?(e=d.processResponse(a),d.isProcessedResponseValidForChart(e)?("function"==typeof b.callbackLoadApi?d.loadChartApi(c,e,b.callbackLoadApi):d.loadChartApi(c,e),void("function"==typeof b.success&&b.success())):void h("There is not enough data to render chart.")):void h("The response from the service is invalid.")},error:function(){h("Failed to get response from Price Trends service."),"function"==typeof b.error&&b.error()},complete:function(){"function"==typeof b.complete&&b.complete()}}))},isResponseValid:function(a){return a.priceTrends&&a.priceTrends.searchCount},processResponse:function(a){var b,d,c=[],e=0;for(b=a.priceTrends.yesterday?new Date(a.priceTrends.yesterday.year,a.priceTrends.yesterday.month,a.priceTrends.yesterday.day,0,0,0,0):k(),e=0;e<a.priceTrends.trendsList.length;e++)d=j(a.priceTrends.trendsList[e].searchDate),m(b,d)<=this.mainConfig.daysDelta&&(c[c.length]={searchDate:d,averagePrice:l(a.priceTrends.trendsList[e].averagePrice)});return a.priceTrends.trendsList=c,a},isProcessedResponseValidForChart:function(a){return a.priceTrends&&"success"===a.priceTrends.status&&a.priceTrends.trendsList&&a.priceTrends.trendsList.length>1},insertBeginningDataPointIfMissing:function(a,b,c){var e,f,g,d=k();m(d,a.priceTrends.trendsList[0].searchDate)<this.mainConfig.daysDelta&&(f=new Date(d),f.setDate(d.getDate()-this.mainConfig.daysDelta),e=0,b.insertRows(e,1),b.setValue(e,c,f),g=b.addColumn("number","uncertain"),b.setValue(e,g,a.priceTrends.trendsList[0].averagePrice),b.setValue(e+1,g,a.priceTrends.trendsList[0].averagePrice))},insertEndDataPointIfMissing:function(a,b,c){var e,f,d=k(),g=a.priceTrends.trendsList.length-1;m(d,a.priceTrends.trendsList[g].searchDate)>0&&(e=b.addRows(1),b.setValue(e,c,d),f=b.addColumn("number","uncertain"),b.setValue(e-1,f,a.priceTrends.trendsList[g].averagePrice),b.setValue(e,f,a.priceTrends.trendsList[g].averagePrice))},insertBeginningIntoMergedTableIfMissing:function(a,b,c,d){var f,g,e=k();m(e,a.priceTrends.trendsList[0].searchDate)<this.mainConfig.daysDelta&&(f=new Date(e),f.setDate(e.getDate()-this.mainConfig.daysDelta),g=0,b.insertRows(g,1),b.setValue(g,c,f),b.setValue(g,d,a.priceTrends.trendsList[0].averagePrice))},insertEndIntoMergedTableIfMissing:function(a,b,c,d){var f,e=k(),g=a.priceTrends.trendsList.length-1;m(e,a.priceTrends.trendsList[g].searchDate)>0&&(f=b.addRows(1),b.setValue(f,c,e),b.setValue(f,d,a.priceTrends.trendsList[g].averagePrice))},loadChartApi:function(b,c,d){var e=this;a.getScript("https://www.google.com/jsapi").done(function(){google.load("visualization","1",{callback:function(){e.data=e.createData(c),e.renderAfterElement(b),e.data.chartData&&(e.setContainer(),e.renderChart(),a(window).resize(function(){e.redrawChart()})),"function"==typeof d&&d()},packages:["corechart"],language:"en"})}).fail(function(){h("Failed to load google jsapi.")})},createData:function(a){var b=this.createChartData(a);return{chartData:b,templateData:this.createTemplateData(a,b),response:a}},createChartData:function(a){var b,c,d,e,f,g,i,j,k,n,l=1;if(this.isProcessedResponseValidForChart(a)){for(b=new google.visualization.DataTable,c=b.addColumn("date","Date"),d=b.addColumn("number","Price"),b.addRow([a.priceTrends.trendsList[0].searchDate,a.priceTrends.trendsList[0].averagePrice]),e=new google.visualization.DataTable,e.addRows(a.priceTrends.trendsList.length),f=e.addColumn("date","Date"),g=1,i="undefined",j=a.priceTrends.trendsList[0].searchDate,e.setValue(0,f,j),l=1,n=a.priceTrends.trendsList.length;l<n;l++)k=a.priceTrends.trendsList[l].searchDate,e.setValue(l,f,k),m(j,k)<=1?"certain"===i?e.setValue(l,g,a.priceTrends.trendsList[l].averagePrice):(g=e.addColumn("number","certain"),e.setValue(l-1,g,a.priceTrends.trendsList[l-1].averagePrice),e.setValue(l,g,a.priceTrends.trendsList[l].averagePrice)):"uncertain"===i?e.setValue(l,g,a.priceTrends.trendsList[l].averagePrice):(g=e.addColumn("number","uncertain"),e.setValue(l-1,g,a.priceTrends.trendsList[l-1].averagePrice),e.setValue(l,g,a.priceTrends.trendsList[l].averagePrice)),b.addRow([a.priceTrends.trendsList[l].searchDate,a.priceTrends.trendsList[l].averagePrice]),i=e.getColumnLabel(g),j=k;return this.insertBeginningDataPointIfMissing(a,e,f),this.insertEndDataPointIfMissing(a,e,f),this.insertBeginningIntoMergedTableIfMissing(a,b,c,d),this.insertEndIntoMergedTableIfMissing(a,b,c,d),{dataTable:e,mergedDataTable:b}}return h("There is not enough data to render chart."),null},createTemplateData:function(a,c){var d,e,g,h;return c?(d=c.mergedDataTable.getColumnRange("Date").min,e=c.mergedDataTable.getColumnRange("Price").min,g=c.mergedDataTable.getColumnRange("Price").max,h=n(a),{priceAlertsVariant:f.priceAlerts.variant,chart:{formattedPrice:p(h,this.mainConfig),formattedSinceDate:q(d,this.mainConfig),priceTrendType:r(a,this.mainConfig),formattedMinDate:q(d,this.mainConfig),formattedMaxDate:b.priceTrendsModal.priceTrendYesterday,formattedMinPrice:p(e,this.mainConfig),formattedMaxPrice:p(g,this.mainConfig)},orig:a.priceTrends.origin,dest:a.priceTrends.destination}):{formattedSearchCount:o(a.priceTrends.searchCount,this.mainConfig)}},renderAfterElement:function(a){a.afterElement.after(e.templates.priceTrendsChart(this.data.templateData))},renderChart:function(){var h,l,n,o,a=this.data.chartData.mergedDataTable.getColumnRange("Date").min,b=this.data.chartData.mergedDataTable.getColumnRange("Date").max,c=this.data.chartData.mergedDataTable.getColumnRange("Price").min,d=this.data.chartData.mergedDataTable.getColumnRange("Price").max,e=this.getContainer(),f=null,g=null,i=e.width(),j=e.height(),k="#4f4f4f",m=[];for(this.data.templateData.chart.priceTrendType===this.mainConfig.priceTrendFall?k="#477a00":this.data.templateData.chart.priceTrendType===this.mainConfig.priceTrendRise&&(k="#b80000"),l=this.data.chartData.dataTable.getNumberOfColumns()-1,o=0;o<l;o++)n=this.data.chartData.dataTable.getColumnLabel(o+1),"certain"===n?m[m.length]={color:k,pointsVisible:!1}:m[m.length]={color:k,pointsVisible:!1,lineDashStyle:[4,4]};f={series:m,lineWidth:4,legend:{position:"none"},hAxis:{baseline:a,baselineColor:"#e5e5e5",format:this.mainConfig.dateFormatPattern,gridlines:{color:"#ffffff",count:2},ticks:[a,{v:b,f:"Yesterday"}]},vAxis:{baseline:c,baselineColor:"#e5e5e5",format:this.mainConfig.priceFormatPattern,ticks:[c,d],gridlines:{color:"#ffffff",count:2},textStyle:{bold:!0,fontSize:16}},tooltip:{trigger:"none"},chartArea:{left:50,top:10,width:i-100,height:j-50}},e.empty(),g=new google.visualization.LineChart(e[0]),g.draw(this.data.chartData.dataTable,f),h=e.find("text[text-anchor=middle]"),h.eq(0).css("textAnchor","start"),h.eq(1).css("textAnchor","end")},redrawChart:function(){var a=this.getContainer();a.length&&(a.empty(),this.renderChart())},logNumberOfValidDataPoints:function(a){var b=this.data.response.priceTrends.trendsList.length;c.trackAction("FLT.SR.SeePriceTrends.Insights."+b,a)},getContainer:function(){return this.$graphContainer},setContainer:function(b){b?this.$graphContainer=b:this.$graphContainer=a("#priceTrendsGraphChart")},setContentToAppend:function(a){this.setContainer(a),this.redrawChart()},setIconTrend:function(b){b.html(a("#priceTrendsIconTemplateModule").html())}}}),define("crossSellOfferView",["flights","jquery","handlebars","standardOfferDetailsView","offerModel","backbone","experiments","baggageFeeView","uitk","analytics","configuration","sitebrand"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";b(document).on("click","#brandedDealsToolTip a",function(a){a.preventDefault(),b("#crossSellOfferList .tooltip-messsage").uitk_tooltip("hide"),j.trackAction("FLT.SR.BrandedDeal.Tooltip.GotIt",b(this))});var m=function(a,b,c){"brandedDealsToolTip"===b.attr("data-tooltip-id")&&b.uitk_tooltip("hide")};return i.subscribe("tooltip.beforeClose",m),f.View.extend({tagName:"li",className:"flight-module segment click-handler-range differentiated-listing offer-listing",template:c.templates.crossSellOffer,events:{"click .price-button-wrapper .crossselloffer":"selectFlightAndHotel","click a.open-bag-fee":"openBaggageFeeLink","click a.tooltip-messsage.branded-deal":"trackTooltipOpen"},crossSellOffer:null,baggageFeeView:null,initialize:function(a){a.crossSellOffer.naturalKey="crossselloffer-"+a.crossSellOffer.naturalKey,this.crossSellOffer=new e(a.crossSellOffer),this.model=a.crossSellModel,this.id="crossselloffer-"+this.crossSellOffer.get("naturalKey").replace(/;/g,"_")},attributes:{"data-is-split-ticket":"splitTicket","data-discount":"discount","data-is-packageable":"packageable"},render:function(){var c,n,p,t,e=this,f=e.model.get("saving"),j=(e.model.get("crossSellDeal"),e.model.get("brandedDeal")),m=e.model.get("brandedDealVariation"),o=e.model.get("crossSellUrl"),q=a.Model.Wizard.seatingClass,r=["","F","B","E","","P"],s=null!==j;null!==j&&(n={numberOfNightsOfStay:j.hotelModel.numberOfNightsOfStay,brandedDealVariation:m.brandedDealVariation,numberOfFreeNights:m.numNightsFree,percentSavingOverFPlusHPrice:Math.floor(m.percentSavingOverFPlusHPrice)},o=j.urlToPackageSearch+"&hotelIds="+j.hotelModel.hotelId+"&cabinClass="+r[q],f=decodeURIComponent(j.savingsNoDecimal)),t=this.getBrandedDealMessage(s,n),p={module:e.crossSellOffer.toJSON(),isBrandedDeal:s,brandedDeal:n,saving:f,addHotelHREF:o,useTripStrings:k.route.isMultiDest,shouldUseMultipleBagFeeStrings:k.baggageFee.useMultipleBagFeeStrings,shouldUseHandBaggageOnlyMessage:k.baggageFee.useHandBaggageOnlyMessage,shouldUseThinListingBaggageFeeLink:k.baggageFee.useThinListingBaggageFeeLink,siteBrandName:l.brandname,brandedDealMessage:"views_default_controls_flight_searchresults_flux_crossselloffer."+t,brandedDealMessageKey:t},b.each(e.attributes,function(a,b){e.$el.attr(a,e.crossSellOffer.get(b))}),this.standardOfferDetailsView=new d({model:e.crossSellOffer,el:e.el}),this.baggageFeeView=new h({model:{offer:e.crossSellOffer},el:e.el}),c=e.template(p),e.$el.html(c),b("#crossSellOfferList").append(e.$el),b("#crossSellOfferList").removeClass("hide"),null!==j&&(g.execute("TIMER_ON_BRANDED_DEALS.FLIGHT_STAND_ALONE",e.$el),g.execute("clickableBrandedDeal.render",e.$el))},getBrandedDealMessage:function(a,b){if(a){if("FREE_FLIGHT"===b.brandedDealVariation)return this.getFreeFlightMessageId(k.xsell.hotel.freeFlightMessageVariant);if("FREE_HOTEL"===b.brandedDealVariation)return"freeHotel";if("HOTEL_DEAL"===b.brandedDealVariation)return"hotelDeal";if("FREE_HOTEL_NIGHTS"===b.brandedDealVariation)return b.numberOfFreeNights>1?"freeHotelNights":"freeHotelNight"}return"defaultTitle"},getFreeFlightMessageId:function(a){switch(a){case"FREE_FLIGHT":return"freeFlight";case"FREE_FLIGHT_SAVINGS_UP_TO":return"freeFlightSavingsUpTo";case"FREE_FLIGHT_SAVINGS_EQUAL_TO":return"freeFlightSavingsEqualTo";case"FREE_FLIGHT_LEGAL_DEFAULT":return"freeFlightLegalDefault";default:return"freeFlightLegalDefault"}},selectFlightAndHotel:function(a,b){this.model.logOmnitureClickTrackData("FLT.SR.XSell.PKG.DifferentiatedListing",a)},empty:function(){b("#crossSellOfferList").empty()},openBaggageFeeLink:function(a){this.baggageFeeView.baggageFeeLinkHelper(a)},trackTooltipOpen:function(a){this.model.logOmnitureClickTrackData("FLT.SR.BrandedDeal.Tooltip.Open",a)}})}),define("priceTrendsView",["flights","jquery","configuration","backbone","singlePageModel","priceTrendsModal","fluxClickHandler","sitebrand"],function(a,b,c,d,e,f,g,h){"use strict";return d.View.extend({singlePageModel:new e,initialize:function(){c.priceAlerts.variant>0&&c.priceTrends.isFlightInsightAvailable&&(g.addHandler("showPriceTrendsModal",f.showPriceTrendsModal,f),g.addHandler("getPriceAlerts",f.getPriceAlerts,f),this.listenTo(a.vent,"offersCollectionView.render",this.render))},render:function(){var a=this.getRenderPosition();return a<=0||"page.Flight-Search-Roundtrip.In"===c.pageName?void this.clear():void f.render({tpid:h.tpid,eapid:h.eapid,arrivalAirportCode:this.singlePageModel.get("arrivalAirportCode"),departureAirportCode:this.singlePageModel.get("departureAirportCode"),departureDate:this.singlePageModel.get("departureISODate"),afterElement:b("#flightModuleList").find(".flight-module:visible").eq(a-1)})},clear:function(){void 0!==f.$el&&f.$el.remove()},getRenderPosition:function(){var a=b("#flightModuleList").find(".flight-module:visible").length,d=c.priceTrends.position;return a<d&&(d=a),d}})}),define("priceTrendsModal",["jquery","flights","i18n","uitk","analytics","dctk/dctk","handlebars","configuration","experiments","priceTrendsChart","priceAlert","sitebrand"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m={mainConfig:{daysDelta:13,priceTrendDelta:10,priceTrendRise:"rise",priceTrendFall:"fall",priceTrendUnchanged:"unchanged",priceFormatPattern:"$#",dateFormatPattern:"MMM d",thousandSeparator:",",millisBeforeCreatePriceAlertLoader:5},createPriceAlertLoaderTimer:null,submitted:"",graphRendered:!1,$el:void 0,render:function(b){var e=this,f=a.parseJSON(a("#omnitureJSON").text()).omnitureProperties.userType,i="unidentified";void 0!==e.$el&&e.$el.remove(),0!==b.afterElement.length&&("AUTHENTICATED"===f?i="authenticated":"IDENTIFIED"===f&&(i="identified"),e.$el=a(g.templates.priceTrends({modalTitle:c.priceTrendsModal.priceTrendInsufficientDataModalTitle,continuousShoppingPriceAlertVariant:h.priceAlerts.variant,sitebrandname:l.brandname,userState:i})),b.afterElement.after(e.$el),this.graphRendered||(this.validateConfig(b)?j.renderGraph({config:b,mainConfig:e.mainConfig,complete:function(){d.subscribe("modal.appended",e,e.onModalOpen),d.subscribe("modal.close",e,e.onModalClose),e.graphRendered=!0}}):this.logMessage("The provided configuration is invalid. Can not render price trends.")))},onModalOpen:function(b,c){"priceTrendsGraphModal"===c.options.modalId&&(a(".price-trends-graph-get-price-alerts-button").removeAttr("disabled"),j.data&&j.data.chartData?(a("#graph-container-patern").removeClass("hidden"),this.getModalTitle(j.data.chartData),j.setContentToAppend(a("#graph-container-patern")),j.setIconTrend(a("#icon-price-trend")),j.logNumberOfValidDataPoints(c),k.isSubscribedToPriceAlerts&&a("#not-subscribed-description-text").remove(),this.setDescription(a("#description-price-trends-full").text()),a("#price-trends-graph-description-chart svg").attr("aria-describedby","price-trends-graph-description-chart")):(a("#graph-container-patern").addClass("hidden"),this.logMessage("Failed to get response from Price Trends service.")),k.isSubscribedToPriceAlerts&&this.hideForm())},validateConfig:function(a){return a.afterElement},showPriceTrendsModal:function(){a(".price-trends-graph-modal-link").click()},getPriceAlerts:function(b,c,e){var g,f=h.priceAlerts.variant,i=e;3===f?i.validateEmailInputField()?(g=a(".price-trends-graph-email-input-field").val(),i.createPriceAlerts(g)):d.utils.focusElement(a("#priceTrendsGraphEmailValidationError")):1===f&&i.scratchpadSubscribe(),c&&c.preventDefault&&c.preventDefault()},getModalTitle:function(b){b?a("#priceTrendsGraphModal-title").text(c.priceTrendsModal.priceTrendOverThePastTwoWeekModalTitle):a("#priceTrendsGraphModal-title").text(c.priceTrendsModal.priceTrendInsufficientDataModalTitle)},onModalClose:function(b,c){var g,f=h.priceAlerts.variant;"priceTrendsGraphModal"!==c.options.modalId||this.submitted||3!==f||(g=a(".price-trends-graph-email-input-field").val(),this.clearValidation(),g?e.trackAction("FLT.SR.SeePriceTrends.Close.Aborted",c):e.trackAction("FLT.SR.SeePriceTrends.Close.Ignored",c),d.utils.focusElement(a("#seePriceTrendsGraphButton")))},showAddedToPriceAlertsNotification:function(){k.showAddedToPriceAlertsNotification(),d.utils.liveAnnounce(c.priceTrendsModal.priceTrendsAddedToPriceAlerts)},showCheckYourEmailNotification:function(){d.utils.liveAnnounce(c.priceTrendsModal.priceTrendsCheckYourEmail),k.showCheckYourEmailNotification(),d.utils.focusElement(a("#priceChangeAlertCheckYourEmail"))},showGetPriceAlertsLoading:function(){this.createPriceAlertLoaderTimer=null,a(".price-trends-graph-get-price-alerts-button").addClass("hidden"),a("#priceTrendsGraphTermsAndPrivacyFooter").addClass("hidden"),a("#priceTrendsGraphGetPriceAlertsError").addClass("hidden"),a("#priceTrendsGraphGetPriceAlertsLoading").removeClass("hidden"),d.utils.liveAnnounce(c.priceTrendsModal.priceTrendsCreatingYourPriceAlert)},showGetPriceAlertsError:function(){a(".price-trends-graph-get-price-alerts-button").addClass("hidden"),a("#priceTrendsGraphTermsAndPrivacyFooter").addClass("hidden"),a("#priceTrendsGraphGetPriceAlertsError").removeClass("hidden"),a("#priceTrendsGraphGetPriceAlertsLoading").addClass("hidden"),d.utils.liveAnnounce(c.priceTrendsModal.priceTrendsCreatingYourPriceAlertError)},hideForm:function(){a("#priceTrendsModuleGraphForm").addClass("hidden")},clearValidation:function(){a("#priceTrendsGraphEmailValidationError").addClass("visuallyhidden"),a(".price-trends-graph-email-label").removeClass("invalid")},resetFormToDefault:function(){var c,b=h.priceAlerts.variant;a("#priceTrendsGraphGetPriceAlertsError").addClass("hidden"),a("#priceTrendsGraphGetPriceAlertsLoading").addClass("hidden"),b>2&&(c=a(".price-trends-graph-email-input-field"),c.val(""),c.removeClass("hidden")),2!==b&&(a(".price-trends-graph-get-price-alerts-button").removeClass("hidden"),a("#priceTrendsGraphTermsAndPrivacyFooter").removeClass("hidden"))},resetForm:function(){"succ"===this.submitted?this.hideForm():"fail"===this.submitted&&(this.submitted="",this.resetFormToDefault())},scratchpadSubscribe:function(){var a=this;this.createPriceAlertLoaderTimer||(this.logGetPriceAlerts(),this.setTimeoutForLoader(),k.subscribeViaScratchpad({success:function(){a.showAddedToPriceAlertsNotification(),a.closeModal()},error:function(){a.logMessage("Failed to subscribe to send me notes via Scratchpad!"),a.showServerErrorMessage()}}))},logMessage:function(a){console.log(a),f&&f.logging&&f.logging.logMessage&&f.logging.logMessage(a)},createPriceAlerts:function(b){var c=this;this.createPriceAlertLoaderTimer||(a(".price-trends-graph-get-price-alerts-button").attr("disabled","disabled"),this.logGetPriceAlerts(),this.setTimeoutForLoader(),k.createPriceAlerts(b,{channelType:"FSRPriceTrendsPriceAlerts",redirectUrlReferrer:"EML.FLT.SR.SeePriceTrends.GetPriceAlerts",success:function(a){c.setUpOmnitureDataForSoftAccountCreation(a),"NOT_VALIDATED"===a.validationStatus||"PENDING_VALIDATION"===a.validationStatus?(c.closeModal(),c.showCheckYourEmailNotification(),i.execute("PRICEALERTS.CHECKEMAILCONFIRM.MODAL",{})):"VALIDATED"===a.validationStatus?(c.closeModal(),c.showAddedToPriceAlertsNotification()):(c.logMessage("Failed to create price alerts!"),c.showServerErrorMessage())},error:function(){c.logMessage("Failed to create price alerts!"),c.showServerErrorMessage()}}))},setTimeoutForLoader:function(){this.createPriceAlertLoaderTimer=setTimeout(this.showGetPriceAlertsLoading,this.mainConfig.millisBeforeCreatePriceAlertLoader)},resetTimeoutForLoader:function(){this.createPriceAlertLoaderTimer&&(clearTimeout(this.createPriceAlertLoaderTimer),this.createPriceAlertLoaderTimer=null)},setUpOmnitureDataForSoftAccountCreation:function(a){void 0!==a.newSoftAccountCreated&&a.newSoftAccountCreated===!0&&void 0!==f&&f.onReady(function(){f.trackEvent("o","PriceTrendsGraph",{eVar28:"SOFT.ACCOUNT.CREATED",prop16:"SOFT.ACCOUNT.CREATED"})})},logGetPriceAlerts:function(){e.trackAction("FLT.SR.SeePriceTrends.GetPriceAlerts",a(".price-trends-graph-get-price-alerts-button"))},validateField:function(b){var e,c=b.parent("label"),d=a("#"+b.attr("aria-describedby")),f=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return f.test(b.val())?(c.removeClass("invalid"),b.attr("aria-invalid","false"),d.html("").addClass("visuallyhidden"),!0):(c.addClass("invalid"),b.attr("aria-invalid","true"),e=b.data("validationMsg"),d.html(e).removeClass("visuallyhidden"),!1)},validateEmailInputField:function(){return this.validateField(a(".price-trends-graph-email-input-field"))},setDescription:function(b){a("#price-trends-graph-description-chart").attr("aria-label",b)},showServerErrorMessage:function(){this.submitted="fail",this.resetTimeoutForLoader(),this.showGetPriceAlertsError()},closeModal:function(){this.submitted="succ",this.resetTimeoutForLoader(),this.resetForm(),d.modal.close()}};return m}),define("scratchpadModalPriceAlerts",["jquery","i18n","uitk","analytics","dctk/dctk","configuration","experiments","priceAlert","fluxClickHandler"],function(a,b,c,d,e,f,g,h,i){"use strict";var j={createPriceAlertLoaderTimer:null,submitted:"",optInEndpoint:"/scratchpadoptin",subscribed:!1,parentView:null,initialize:function(a){this.bindEvents(a.priceAlertVariant),this.parentView=a.parentView,this.subscribeToModal()},bindEvents:function(a){1===a?i.addHandler("createPriceAlertScratchpadModal",this.scratchpadSubscribe,this):a>=0&&i.addHandler("createPriceAlertScratchpadModal",this.createPriceAlertsActionButton,this)},onModalOpen:function(b,c){"scratchpadOptin"===c.options.modalId&&(a("#scratchpadOptin.modal-wrap").addClass("force-center-aligned"),a(".send-me-notes-email-input-field").blur(this,this.updateForm))},onModalClose:function(a,b){"scratchpadOptin"!==b.options.modalId||this.submitted||(this.isEmailEmpty()?d.trackAction("FLT.SR.ScratchpadModal.PriceAlerts.Close.Ignored",b):d.trackAction("FLT.SR.ScratchpadModal.PriceAlerts.Close.Aborted",b))},updateForm:function(a){var c=a.data,d=b.sendSearchesFromSPModal.sendSearchesFromSPModalPleaseEnterValidEmailText;c.isEmailValid()?c.removeValidationError():(c.isEmailEmpty()&&(d=b.sendSearchesFromSPModal.sendSearchesFromSPModalPleaseCompleteAllFieldsText),c.updateAlertMessage(d,c))},updateAlertMessage:function(b,c){a("#sendMeNotesValidationAlert").find(".alert-title").text(b),c.addValidationError()},addValidationError:function(){var b=a(".send-me-notes-email-input-field").parent("label");b.addClass("invalid"),a(".send-me-notes-email-input-field").attr("aria-invalid","true"),a("#sendMeNotesValidationAlert").removeClass("hidden")},removeValidationError:function(){var b=a(".send-me-notes-email-input-field").parent("label");b.removeClass("invalid"),a(".send-me-notes-email-input-field").attr("aria-invalid","false"),a("#sendMeNotesValidationAlert").addClass("hidden")},isEmailEmpty:function(){return""===a(".send-me-notes-email-input-field").val()},isEmailValid:function(){var b=!1,c=/^([A-Za-z0-9_\-\.])+@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return c.test(a(".send-me-notes-email-input-field").val())&&(b=!0),b},subscribeToModal:function(){this.subscribed||(c.subscribe("modal.appended",this,this.onModalOpen),c.subscribe("modal.close",this,this.onModalClose),this.subscribed=!0)},logGetPriceAlerts:function(){d.trackAction("FLT.SR.ScratchpadModal.PriceAlerts.SendMeSearches",a("#send-me-notes-button"))},setTimeoutForLoader:function(){this.createPriceAlertLoaderTimer=setTimeout(this.showGetPriceAlertsLoading(),f.priceAlerts.loaderTimeout)},showGetPriceAlertsLoading:function(){this.createPriceAlertLoaderTimer=null,a("#sendMeNotesValidationAlert").addClass("hidden"),a("fieldset.sendMeMySearches").addClass("hidden"),a("#send-me-notes-button").addClass("hidden"),a("#send-me-notes-price-alerts-loading").removeClass("hidden"),a("a.modal-close.click-handler-range").addClass("hidden"),c.utils.liveAnnounce(b.sendSearchesFromSPModal.sendSearchesFromSPModalCreatingYourPriceAlert)},showGetPriceAlertsError:function(d){a("#sendMeNotesValidationAlert").removeClass("hidden"),a("fieldset.sendMeMySearches").removeClass("hidden"),a("#send-me-notes-button").removeClass("hidden"),a("#send-me-notes-price-alerts-loading").addClass("hidden"),a("a.modal-close.click-handler-range").removeClass("hidden"),d.updateAlertMessage(b.sendSearchesFromSPModal.sendSearchesFromSPModalErrorInSending,d),c.utils.liveAnnounce(b.sendSearchesFromSPModal.sendSearchesFromSPModalCreatingYourPriceAlertError)},getUrlParameter:function(b){var d,e,c=a(window)[0].location.search.substring(1),f=c.split("&");for(d=0;d<f.length;d++)if(e=f[d].split("="),e[0]===b)return e[1];return""},resetTimeoutForLoader:function(a){a.createPriceAlertLoaderTimer&&(clearTimeout(a.createPriceAlertLoaderTimer),a.createPriceAlertLoaderTimer=null)},setUpOmnitureDataForSoftAccountCreation:function(a){void 0!==a.newSoftAccountCreated&&a.newSoftAccountCreated===!0&&"undefined"!=typeof e&&e.onReady(function(){e.trackEvent("o","sendSearchesFromSPModal",{eVar28:"SOFT.ACCOUNT.CREATED",prop16:"SOFT.ACCOUNT.CREATED"})})},logMessage:function(a){console.log(a),e&&e.logging&&e.logging.logMessage&&e.logging.logMessage(a)},createPriceAlerts:function(d){var e=a(".send-me-notes-email-input-field").val();d.createPriceAlertLoaderTimer||(this.logGetPriceAlerts(),this.setTimeoutForLoader(),h.createPriceAlerts(e,{channelType:"FSRScratchpadModalPriceAlerts",redirectUrlReferrer:"EML.FLT.SR.ScratchpadModal",success:function(a){d.parentView.onUpdateOptinStatus(!0,!0),d.setUpOmnitureDataForSoftAccountCreation(a),"NOT_VALIDATED"===a.validationStatus||"PENDING_VALIDATION"===a.validationStatus?(d.closeModal(d),h.showCheckYourEmailNotification(),g.execute("PRICEALERTS.CHECKEMAILCONFIRM.MODAL",{}),
c.utils.liveAnnounce(b.priceTrendsModal.priceTrendsCheckYourEmail)):"VALIDATED"===a.validationStatus?(d.closeModal(d),h.showAddedToPriceAlertsNotification(),c.utils.liveAnnounce(b.priceTrendsModal.priceTrendsAddedToPriceAlerts)):d.showServerErrorMessages(d)},error:function(){d.showServerErrorMessages(d)}}))},closeModal:function(a){a.submitted="succ",a.resetTimeoutForLoader(a),h.isSubscribedToPriceAlerts=!0,c.modal.close()},showServerErrorMessages:function(a){a.logMessage("Failed to create price alerts!"),a.submitted="fail",a.resetTimeoutForLoader(a),a.showGetPriceAlertsError(a)},createPriceAlertsActionButton:function(b,c,d){var g,e=d;f.scratchpadModal.sendSearches?(e.updateForm({data:e}),!e.isEmailEmpty()&&e.isEmailValid()&&e.createPriceAlerts(e)):(g=a.ajax({url:e.optInEndpoint,type:"POST",data:{sendMeNotes:!0}}),g.done(function(a){a?e.parentView.onUpdateOptinStatus(!0,!0):window.location.href=f.scratchpadModal.redirectUrl}),g.fail(function(){e.parentView.onUpdateOptinStatus(!0,!1)})),c.preventDefault()},scratchpadSubscribe:function(a,b,c){var d=c;d.createPriceAlertLoaderTimer||(d.logGetPriceAlerts(),d.setTimeoutForLoader(d),h.subscribeViaScratchpad({success:function(){h.showAddedToPriceAlertsNotification(),d.parentView.onUpdateOptinStatus(!0,!0),d.closeModal(d)},error:function(){d.logMessage("Failed to subscribe to send me notes via Scratchpad!"),d.showServerErrorMessages()}}))}};return j}),define("liveAnnounceDispatcher",["flights","jquery","uitk","i18n","configuration"],function(a,b,c,d,e){"use strict";var f,g,h;return g={getCurrentLeg:function(){return void 0===h?0:h.getNextLegToView()}},f={initialize:function(){this.setRouter(),this.setListeners()},setRouter:function(){void 0===h&&e.view.isByot?require(["setupRouter"],function(a){h=a()}):e.view.isByot||(h=void 0)},setListeners:function(){a.vent.on("uiModel.resultsFetchSuccess.InitialSearch",function(){var a=b("#sortBar").find("select option:selected").text();e.view.isByot&&(0===g.getCurrentLeg()?c.utils.liveAnnounce(d.sorting.accessibility.announceDeparturePage.replace("{0}",a),"polite"):c.utils.liveAnnounce(d.sorting.accessibility.announceReturnPage.replace("{0}",a),"polite"))}),a.vent.on("uiModel.resultsFetchSuccess.LegUnselect",function(){var a=b("#sortBar").find("select option:selected").text();c.utils.liveAnnounce(d.sorting.accessibility.announceDeparturePage.replace("{0}",a),"polite")}),a.vent.on("uiModel.resultsFetchSuccess.LegSelect",function(){var a=b("#sortBar").find("select option:selected").text();c.utils.liveAnnounce(d.sorting.accessibility.announceReturnPage.replace("{0}",a),"polite")})}}}),define("wizardView",["jquery","underscore","backbone","handlebars","analytics","uitk","i18n","wizardUrlBuilder","wizardModelValidator","flights","experiments","configuration"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function n(a){var b=new XMLHttpRequest,c=a.replace("Flights-Search","Flight-Launch-Search");l.enablePreloadFSRCache!==!1&&(b.open("GET",c,!0),b.onload=function(a){},b.timeout=10,b.send(null))}var m={getTripNumber:function(a){return a.parents(".trip-info").data("trip-number")},onMoreTripsToggleOpen:function(b){e.trackAction("FLT.SR.Wizard.AddMoreTrips",b[0]),f.utils.focusElement(a("#departure-airport-3"))},onMoreTripsToggleClose:function(a){e.trackAction("FLT.SR.Wizard.HideTrips",a[0])},onNearbyAirportsLinkClick:function(b){var c=a(b.target),d=c.data("nearbytype"),f="FLT.SR.Wizard.Trip"+m.getTripNumber(c)+".NearbyAirports";f+="depart"===d?".DepartureAirport":".ArrivalAirport",f+=".Clicked",e.trackAction(f,b.target)},onNearbyAirportContentClick:function(b){var h,c=a(b.target),d=m.getTripNumber(c),f=c.data("airportname")+" ("+c.data("airportcode")+")",g=c.data("nearbytype"),i="FLT.SR.Wizard.Trip"+d+".NearbyAirports";"depart"===g?(i+=".DepartureAirport",h=a("#departure-airport-"+d)):(i+=".ArrivalAirport",h=a("#arrival-airport-"+d)),i+=".Contents.Selected",e.trackAction(i,b.target),h.val(f),this.triggerAirportFieldChange(h)},onDepartureAirportChange:function(b){var c=a(b.target),d=m.getTripNumber(c),f=this.model.get("trips").at(d-1),g="FLT.SR.Wizard.Trip"+d+".DepartureAirport.Changed";e.trackAction(g,b.target),f.get("departure").set("airport",c.val()),this.airportsDropDown.enabled&&f.get("arrival").set("airport","")},onArrivalAirportChange:function(b){var c=a(b.target),d=m.getTripNumber(c),f=this.model.get("trips").at(d-1),g="FLT.SR.Wizard.Trip"+d+".ArrivalAirport.Changed";e.trackAction(g,b.target),f.get("arrival").set("airport",c.val())},onDepartureDateChange:function(b){m.onDepartureDateSelectDate(a(b.target),this.model)},onReturnDateChange:function(b){m.onReturnDateSelectDate(a(b.target),this.model)},onPreferredAirlineChange:function(b){var c=a(b.target),d="FLT.SR.Wizard.PreferredAirline";e.trackAction(d,b.target),this.model.get("travelerPreferences").set("preferredAirline",c.val())},onSeatingClassChange:function(b){var c=a(b.target),d="FLT.SR.Wizard.SeatingClass";e.trackAction(d,b.target),this.model.get("travelerPreferences").set("seatingClass",c.val())},onNonstopFlightChange:function(b){var c=a(b.target),d="FLT.SR.Wizard.NonStopOnly";e.trackAction(d,b.target),this.model.get("travelerPreferences").set("nonstopOnly",c[0].checked)},onRefundableChange:function(b){var c=a(b.target),d="FLT.SR.Wizard.RefundableOnly";e.trackAction(d,b.target),this.model.get("travelerPreferences").set("refundableOnly",c[0].checked)},onChildAgeRulesClick:function(a){var b="FLT.SR.Wizard.AirlineAgeRules";e.trackAction(b,a.target)},onInfantInLapChange:function(b){var c=a(b.target),d=!0,f="FLT.SR.Wizard.InfantInLap";"infants-in-seat"===c[0].id&&(d=!1,f="FLT.SR.Wizard.InfantInSeat"),e.trackAction(f,c[0]),this.model.get("travelerPreferences").set("infantsInLap",d)},onAdultCountChange:function(b){var c=a(b.target),d="FLT.SR.Wizard.Adults";e.trackAction(d,b.target),this.model.get("travelerPreferences").set("numberOfAdults",parseInt(c.val()))},onChildCountChange:function(b){var c=a(b.target),d="FLT.SR.Wizard.Children";e.trackAction(d,b.target),this.model.get("travelerPreferences").set("numberOfChildren",parseInt(c.val()))},onChildAgeChange:function(b){var c=a(b.target),d=parseInt(c[0].id.split("-")[2]),f=parseInt(c[0].value),g="FLT.SR.Wizard.ChildrenAge"+d;e.trackAction(g,b.target),this.model.get("travelerPreferences").get("childAges").at(d-1).set("age",f)},onOptionsOpen:function(a){e.trackAction("FLT.SR.Wizard.ShowOptions",a[0])},onOptionsClosed:function(a){e.trackAction("FLT.SR.Wizard.HideOptions",a[0])},onDepartureDateSelectDate:function(a,b){var c=m.getTripNumber(a),d=b.get("trips").at(c-1),f="FLT.SR.Wizard.Trip"+c+".DepartureDate.Changed",g=a.val(),h=d.get("arrival").get("date").get("shortFormat");e.trackAction(f,a[0]),d.get("departure").get("date").set("shortFormat",g),"ROUND_TRIP"===b.get("routeType")&&""!=g&&m.isDateAfterPreviousDate(g,h,b.get("locale"))&&d.get("arrival").get("date").set("shortFormat",g)},isValidDate:function(a){return a instanceof Date&&!isNaN(a.getTime())},isDateAfterPreviousDate:function(a,b,c){var d=f.utils.createLocalizedDate(a,c),e=f.utils.createLocalizedDate(b,c);return!!m.isValidDate(d.date)&&d.date.getTime()>=e.date.getTime()},onReturnDateSelectDate:function(a,b){var c=m.getTripNumber(a),d=b.get("trips").at(c-1),f="FLT.SR.Wizard.Trip"+c+".ReturnDate.Changed",g=a.val();""===a.val()&&(g=d.get("departure").get("date").get("shortFormat")),e.trackAction(f,a[0]),d.get("arrival").get("date").set("shortFormat",g)},onOnewaySelect:function(b){var c=a(b.target),d="FLT.SR.Wizard.RouteType.Oneway";k.getVariant(10149)>0&&(d="FLT.SR.Wizard.Toggle.Oneway"),e.trackAction(d,b.target),this.model.set("routeType",c.val())},onMultiDestSelect:function(b){var c=a(b.target),d="FLT.SR.Wizard.RouteType.MultiDest";k.getVariant(10149)>0&&(d="FLT.SR.Wizard.Toggle.MultiDest"),e.trackAction(d,b.target),this.model.set("routeType",c.val())},onRoundtripSelect:function(b){var c=a(b.target),d="FLT.SR.Wizard.RouteType.Roundtrip",f=this.model.get("trips").at(0).get("departure").get("date").get("shortFormat");k.getVariant(10149)>0&&(d="FLT.SR.Wizard.Toggle.Roundtrip"),e.trackAction(d,b.target),""===this.model.get("trips").at(0).get("arrival").get("date").get("shortFormat")&&this.model.get("trips").at(0).get("arrival").get("date").set("shortFormat",f),this.model.set("routeType",c.val())},onSearch:function(a){var b,c;m.clearErrors(this.$el),this.model.validate(),this.model.isValid()&&(f.utils.liveAnnounce(g.globalWizard.accessibility.searching,"polite"),e.trackAction("FLT.SR.Wizard",a.target),b=h.generateUrl(this.model),n(b),c=h.buildSearchParameters(this.model),j.vent.trigger("wizardView.beforeSearchIsSent",c),this.publishUrl(b))},clearErrors:function(b){b.find("#wizard-error-container").empty(),a(b.find(".invalid [aria-invalid=true]")).attr("aria-invalid","false"),b.find(".invalid").removeClass("invalid")},invalidateControl:function(b){var c="invalid",d=a(b);return d.attr("aria-invalid","true"),d.parent().addClass(c),d},invalidateControlsOnError:function(a,b,c){switch(c.type){case i.errorTypes[b].DEPARTURE_AIRPORT_BLANK:m.invalidateControl(a.find("#departure-airport-"+c.tripNumber));break;case i.errorTypes[b].ARRIVAL_AIRPORT_BLANK:m.invalidateControl(a.find("#arrival-airport-"+c.tripNumber));break;case i.errorTypes[b].DEPARTURE_ARRIVAL_AIRPORT_SAME:m.invalidateControl(a.find("#arrival-airport-"+c.tripNumber));break;case i.errorTypes[b].INVALID_DEPARTURE_DATE:case i.errorTypes[b].DEPARTURE_DATE_NOT_IN_RANGE:case i.errorTypes[b].DEPARTURE_DATE_PRIOR_TO_PREVIOUS_TRIP:m.invalidateControl(a.find("#departure-date-"+c.tripNumber));break;case i.errorTypes[b].INVALID_RETURN_DATE:case i.errorTypes[b].RETURN_DATE_NOT_IN_RANGE:m.invalidateControl(a.find("#return-date-"+c.tripNumber));break;case i.errorTypes.MISSING_CHILD_AGE:m.invalidateControl(a.find("#child-age-"+c.childNumber));break;case i.errorTypes.UNATTENDED_INFANT_IN_LAP:case i.errorTypes.INVALID_TRAVELER_COUNT:m.invalidateControl(a.find("#adult-count")),m.invalidateControl(a.find("#child-count")),a.find('select[id^="child-age-"]').each(function(a,b){m.invalidateControl(b)})}},markControlsAsErrors:function(a,c,d){b.each(d,function(b){m.fireOmnitureForError(b.type),m.invalidateControlsOnError(a,c,b)})},filterDuplicateMissingChildAgeErrors:function(a,c){var d,e;return d=b.filter(c,function(a){return a.type!==i.errorTypes.MISSING_CHILD_AGE}),e=b.find(c,function(a){return a.type===i.errorTypes.MISSING_CHILD_AGE}),void 0===e?c:b.union(d,[e])},filterDuplicateErrors:function(a,b){return m.filterDuplicateMissingChildAgeErrors(a,b)},showAllErrorElements:function(b){var g,h,i,j,c=b.find("#more-trips-pane-toggle"),d=b.find("#flights-advanced-options-toggle"),e="false"===c.attr("aria-expanded"),f="false"===d.attr("aria-expanded"),g=b.find("#validation-alert a").map(function(){return"#"+this.href.split("#")[1]}).toArray().join(", ");h=a(g),i=h.parents("#more-trips-pane-content").length>0,j=h.parents("#flights-advanced-options-pane").length>0,e&&i&&c.uitk_toggle("open"),f&&j&&d.uitk_toggle("open")},onErrorLinkClick:function(b){var c=a(b.target),d=this.$el.find(c.attr("href"));return b.preventDefault(),f.utils.focusElement(d),!1},onTypeaheadResultSelected:function(a,b){var c,d,f,g,h,i,j=k.getVariant(12550)>0;j?(d=a.context.attr("id").split("-")[0],f=m.getTripNumber(a.context),g=a.context.val()):(c=a.parents("ul").attr("id").replace("-tooltip",""),d=c.split("-")[0],f=c.split("-")[1],g=a.text().trim()),h=b.get("trips").at(f-1),i="FLT.SR.Wizard.Trip"+f,i+="departure"===d?".DepartureAirport.Typeahead":".ArrivalAirport.Typeahead",e.trackAction(i,a[0]),h.get(d).set("airport",g)},createAirportDropDowns:function(a,c){require("SearchWizardDropDown",function(d){b.each(a,function(a){var b=new d("#departure-airport-"+a.tripNumber,"#arrival-airport-"+a.tripNumber,c,a.departure.airport,a.arrival.airport);b.displayDropDown()})})},onSummaryDateClick:function(b){var c="FLT.SR.Responsive.Wizard.ChangeSearch.Date",d=a("#wizard-summary-toggle");b.preventDefault(),e.trackAction(c,b.target),d.uitk_toggle("open")},onSummaryLocationClick:function(b){var c="FLT.SR.Responsive.Wizard.ChangeSearch.Location",d=a("#wizard-summary-toggle");b.preventDefault(),e.trackAction(c,b.target),d.uitk_toggle("open")},onSummaryTravelerClick:function(b){var c="FLT.SR.Responsive.Wizard.ChangeSearch.Traveler",d=a("#wizard-summary-toggle");b.preventDefault(),e.trackAction(c,b.target),d.uitk_toggle("open")},startToggleOpenedClickActions:function(){f.subscribe("toggle.opened.click",function(a,b){"more-trips-pane-toggle"===b.element[0].id&&m.onMoreTripsToggleOpen(b.element),"flights-advanced-options-toggle"===b.element[0].id&&m.onOptionsOpen(b.element),f.unsubscribe("toggle.opened.click")})},subscribeToggleBeforeOpen:function(a){f.subscribe("toggle.beforeOpen",function(b,c,d){0!==a.find(c).length&&(m.startToggleOpenedClickActions(),c.uitk_toggle("open"))})},subscribeToggleOpened:function(b){f.subscribe("toggle.opened",function(c,d){0!==b.find(d).length&&("wizard-summary-toggle"===d[0].id&&f.utils.focusElement(a("#departure-airport-1")),m.completeToggleOpenedClickActions(d))})},subscribeToggleClosed:function(a){f.subscribe("toggle.closed",function(b,c){0!==a.find(c).length&&("flights-advanced-options-toggle"===c[0].id&&m.onOptionsClosed(c),"more-trips-pane-toggle"===c[0].id&&m.onMoreTripsToggleClose(c))})},subscribeDatepickerSelectDate:function(a,b){f.subscribe("datepicker.selectDate",function(c,d){0!==a.find(d.element).length&&(d.element[0].id.indexOf("return")>=0?(m.onReturnDateSelectDate(d.element,b),b.set("changeReturnDate",!0)):(m.onDepartureDateSelectDate(d.element,b),b.set("changeDepartDate",!0)))})},subscribeTypeaheadResultSelected:function(a){f.subscribe("typeahead.resultSelected",function(b,c){c.element.hasClass("close")||m.onTypeaheadResultSelected(c.element,a)})},completeToggleOpenedClickActions:function(a){f.publish("toggle.opened.click",{element:a})},fireOmnitureForError:function(b){e.trackAction("FLT.SR.Wizard."+m.errorCodes[b],a("#flight-wizard-search-button"))},errorCodes:{1:"MissingChildAge",2:"UnattendedInfantInLap",3:"InvalidTravelerCount",101:"DepartureAirportBlank",102:"ArrivalAirportBlank",103:"DepartureArrivalAirportSame",104:"InvalidDepartureDate",105:"DepartureDateNotInRange",151:"DepartureDatePriorToPreviousTrip",201:"DepartureAirportBlank",202:"ArrivalAirportBlank",203:"DepartureArrivalAirportSame",204:"InvalidDepartureDate",205:"DepartureDateNotInRange",301:"DepartureAirportBlank",302:"ArrivalAirportBlank",303:"DepartureArrivalAirportSame",304:"InvalidDepartureDate",305:"DepartureDateNotInRange",306:"InvalidReturnDate",307:"ReturnDateNotInRange"},generateAttributeString:function(a){return b.map(a,function(a,b){return b+":"+a}).join("|")}};return c.View.extend({el:"#search-wizard-container",templates:{wizardContainer:d.templates.WizardContainer,wizardMultiDest:d.templates.WizardMultiDest,wizardOneway:d.templates.WizardOneway,wizardRoundtrip:d.templates.WizardRoundtrip,advancedOptionsToggle:d.templates.WizardAdvancedOptionsToggle,advancedOptionsContainer:d.templates.WizardAdvancedOptionsContainer,wizardErrors:d.templates.WizardErrors},events:{'click button[id^="nearby-airports-link"]':m.onNearbyAirportsLinkClick,"click a.nearby-airport.link":m.onNearbyAirportContentClick,'change [id^="departure-airport-"]':m.onDepartureAirportChange,'change [id^="arrival-airport-"]':m.onArrivalAirportChange,'change input[id^="departure-date-"]':m.onDepartureDateChange,'change input[id^="return-date"]':m.onReturnDateChange,"change select#preferred-airline":m.onPreferredAirlineChange,"change select#seating-class":m.onSeatingClassChange,"change input#nonstop-flights":m.onNonstopFlightChange,"change input#refundable-flights":m.onRefundableChange,"click a#child-age-rules":m.onChildAgeRulesClick,"change input#infants-in-lap":m.onInfantInLapChange,"change input#infants-in-seat":m.onInfantInLapChange,"change select#adult-count":m.onAdultCountChange,"change select#child-count":m.onChildCountChange,'change select[id^="child-age-"]':m.onChildAgeChange,"change input#oneway-flight":m.onOnewaySelect,"change input#multi-dest-flight":m.onMultiDestSelect,"change input#round-trip-flight":m.onRoundtripSelect,"click #flight-wizard-search-button":m.onSearch,"click #validation-alert a":m.onErrorLinkClick,"click a#wizard-dates":m.onSummaryDateClick,"click a#wizard-locations":m.onSummaryLocationClick,"click a#wizard-travelers":m.onSummaryTravelerClick,"click .origin .btn.btn-clear":m.onDepartureAirportChange,"click .destination .btn.btn-clear":m.onArrivalAirportChange},initialize:function(a){var b=this;k.execute("replaceWizardHBS",this),b.routeTypeSwitch=a.routeTypeSwitch,b.showNearbyAirports=a.showNearbyAirports,b.showRefundable=a.showRefundable,b.showAdditionalOptions=a.showAdditionalOptions,b.showToggleSummaryAdditionalOptions=a.showToggleSummaryAdditionalOptions,b.airportsDropDown=a.airportsDropDown,b.showNonstop=a.showNonstop,b.showPreferredAirlines=a.showPreferredAirlines,b.showPreferredCabinClass=a.showPreferredCabinClass,b.airportFieldClearButtonEnabled=a.airportFieldClearButtonEnabled,b.showWizardForPackages=a.showWizardForPackages,b.renderOnInit=a.renderOnInit,b.listenTo(b.model,"change:routeType",b.renderFlightInfo),b.listenTo(b.model.get("travelerPreferences"),"change:numberOfChildren",b.renderOptions),b.listenTo(b.model.get("travelerPreferences").get("childAges"),"change",b.renderOptions),b.listenTo(b.model,"invalid",b.renderErrors),m.subscribeToggleBeforeOpen(b.$el),m.subscribeToggleOpened(b.$el),m.subscribeToggleClosed(b.$el),m.subscribeDatepickerSelectDate(b.$el,b.model),m.subscribeTypeaheadResultSelected(b.model),b.airportsDropDown.enabled&&b.model.updateAirportsWithAirportCode(),b.renderOnInit&&b.render()},render:function(){var b=this.model.get("routeType"),c=this.model.get("trips"),d=this.model.get("travelerPreferences"),e=c.at(0).get("departure").get("date"),f=c.getLastTravelDate(b),g={routeType:b,containerConfiguration:{routeTypeSwitch:this.routeTypeSwitch,showWizardForFlightCarPackages:this.showWizardForPackages},summaryViewData:{departureCity:c.at(0).get("departure").get("city"),departureCode:c.at(0).get("departure").get("code"),fullDepartureDate:e.toFullDateString(),mediumDepartureDate:e.toMediumDateString(),arrivalCity:c.at(0).get("arrival").get("city"),arrivalCode:c.at(0).get("arrival").get("code"),fullReturnDate:f.toFullDateString(),mediumReturnDate:f.toMediumDateString(),showReturnDate:"ROUND_TRIP"===b||"MULTIPLE_DESTINATION"===b&&e!==f,showEllipses:"MULTIPLE_DESTINATION"===b,totalPassengers:d.get("totalPassengers")}},h=JSON.parse(JSON.stringify(d)),i=this.templates.advancedOptionsToggle(a.extend(h,{optionsConfiguration:{showAdditionalOptions:this.showAdditionalOptions,showRefundable:this.showRefundable,showNonstop:this.showNonstop,showPreferredAirlines:this.showPreferredAirlines,showPreferredCabinClass:this.showPreferredCabinClass,showToggleSummaryAdditionalOptions:this.showToggleSummaryAdditionalOptions}}));this.$el.html(this.templates.wizardContainer(g)),this.renderFlightInfo(),this.$el.find("#advanced-options-container").empty().append(i),k.execute("FSR_Mobile_PersistentSearchWizard",{})},renderFlightInfo:function(){var a=this.model.get("typeAhead"),c=m.generateAttributeString({provide:"typeahead",version:"v4",template:"#uitk-ta-default","js-theme":"typeahead",minchar:a.minChars,mask:95,locale:a.locale,lob:"FLIGHTS",autoselect:"true"}),d=m.generateAttributeString({size:1,autocomplete:"off"}),e=this.$el.find("#flight-info-container"),f=this.model.get("routeType"),g=JSON.parse(JSON.stringify(this.model.get("trips"))),h={MULTIPLE_DESTINATION:{template:this.templates.wizardMultiDest,className:"multiple-destination-info"},ONE_WAY:{template:this.templates.wizardOneway,className:"oneway-info"},ROUND_TRIP:{template:this.templates.wizardRoundtrip,className:"round-trip-info"}},i=b.pluck(h,"className"),j={trips:g,tripConfiguration:{validSearchDates:this.model.get("validSearchDates"),showPairDatePicker:"ROUND_TRIP"===this.model.get("routeType"),showNearbyAirports:this.showNearbyAirports,showAirportsDropDown:this.airportsDropDown.enabled,airportFormFieldDataAttributes:c,airportFormFieldAttributes:d,airportFieldClearButtonEnabled:this.airportFieldClearButtonEnabled,typeahead:this.model.get("typeAhead"),useUniversalTypeahead:k.getVariant(12550)>0}};e.empty().removeClass(i.join(" ")).addClass(h[f].className).append(h[f].template(j)),this.airportsDropDown.enabled&&m.createAirportDropDowns(g,this.airportsDropDown.options)},renderOptions:function(){var b=JSON.parse(JSON.stringify(this.model.get("travelerPreferences"))),c=this.templates.advancedOptionsContainer(a.extend(b,{optionsConfiguration:{showAdditionalOptions:this.showAdditionalOptions,showRefundable:this.showRefundable,showNonstop:this.showNonstop,showPreferredAirlines:this.showPreferredAirlines,showPreferredCabinClass:this.showPreferredCabinClass}}));this.$el.find("#flights-advanced-options-pane").empty().append(c)},triggerAirportFieldChange:function(b){b.change(),b.trigger("keyup"),f.utils.focusElement(a("#wizardSearch"))},publishUrl:function(a){window.location.href=a},renderErrors:function(b){var c,d=this.model.get("routeType");e.trackAction("FLT.SR.Wizard.BadParameters",a("#flight-wizard-search-button")),m.markControlsAsErrors(this.$el,d,b),c=m.filterDuplicateErrors(d,b),this.$el.find("#wizard-error-container").html(this.templates.wizardErrors({errors:c})),m.showAllErrorElements(this.$el),this.$el.find("#validation-alert").css("outline","none").focus()}})}),define("wizardModel",["backbone","underscore","wizardModelValidator","travelerPreferencesModel","tripCollection","tripModel"],function(a,b,c,d,e,f){"use strict";var g=function(a){var b={airlineAgeRulesLink:a.airlineAgeRulesLink,airlines:a.airlines,numberOfAdults:a.adultCount,numberOfChildren:a.childCount,totalPassengers:a.totalPassengers,childAges:a.childAges,infantsInLap:a.infantsInLap,preferredAirline:a.preferredAirline,seatingClass:a.seatingClass,seatingClassList:a.seatingClassList,nonstopOnly:a.nonStop,refundableOnly:a.refundable,seniorCount:a.seniorCount};return delete a.airlineAgeRulesLink,delete a.airlines,delete a.calendar,delete a.departure,delete a.arrival,delete a.adultCount,delete a.childCount,delete a.totalPassengers,delete a.childAges,delete a.infantsInLap,delete a.preferredAirline,delete a.seatingClass,delete a.seatingClassList,delete a.nonStop,delete a.refundable,delete a.seniorCount,a.travelerPreferences=b,a};return a.Model.extend({constructor:function(b,c){arguments[0]=g(b),a.Model.apply(this,arguments)},initialize:function(){this.set("trips",new e(this.get("trips"),this.get("locale"))),this.set("travelerPreferences",new d(this.get("travelerPreferences")))},validate:function(){var a=c.validate(this);if(this.validationError=void 0,a.length>0)return this.validationError=a,this.trigger("invalid",a),a},isValid:function(){return void 0===this.validationError},updateAirportsWithAirportCode:function(){var a=this.get("trips");b.each(a,function(b,c){var d=a.at(c).get("arrival"),e=a.at(c).get("departure");d.set("airport",d.get("code")),e.set("airport",e.get("code"))})}})}),define("wizardModelValidator",["uitk","underscore"],function(a,b){"use strict";function e(a){var c=a.toJSON().reverse(),d=0;return b.find(c,function(b,c){if(!m(b))return d=a.length-c-1,!0}),d}function f(a,b){return"ONE_WAY"===a||"ROUND_TRIP"===a?b.slice(0,1):b.slice(0,e(b)+1)}function g(a,c,d,e,f){var g;b.each(c,function(b,c){void 0===g&&(g=b),h(a,b,d,c,g.get("departure").get("date").get("shortFormat"),e,f),g=b})}function h(a,b,e,f,g,h,i){var j=b.get("departure").get("airport").trim(),k=b.get("arrival").get("airport").trim(),m=b.get("departure").get("date").get("shortFormat"),n=b.get("arrival").get("date").get("shortFormat");l(j)&&c.push({type:d.errorTypes[a].DEPARTURE_AIRPORT_BLANK,index:f,tripNumber:f+1}),l(k)&&c.push({type:d.errorTypes[a].ARRIVAL_AIRPORT_BLANK,index:f,tripNumber:f+1}),l(k)||j!==k||c.push({type:d.errorTypes[a].DEPARTURE_ARRIVAL_AIRPORT_SAME,index:f,tripNumber:f+1}),o(m,g,e)?q(m,g,e,i)?"MULTIPLE_DESTINATION"!==a||p(m,g,e)||c.push({type:d.errorTypes[a].DEPARTURE_DATE_PRIOR_TO_PREVIOUS_TRIP,index:f,tripNumber:f+1}):c.push({type:d.errorTypes[a].DEPARTURE_DATE_NOT_IN_RANGE,index:f,tripNumber:f+1,minDate:i.min,maxDate:i.max}):c.push({type:d.errorTypes[a].INVALID_DEPARTURE_DATE,index:f,tripNumber:f+1,dateFormat:h}),"ROUND_TRIP"===a&&(o(n,g,e)?q(n,g,e,i)||c.push({type:d.errorTypes[a].RETURN_DATE_NOT_IN_RANGE,index:f,tripNumber:f+1,minDate:i.min,maxDate:i.max}):c.push({type:d.errorTypes[a].INVALID_RETURN_DATE,index:f,tripNumber:f+1,dateFormat:h}))}function i(a){var b=a.get("childAges"),e=a.get("numberOfChildren");b.each(function(a,b){a.get("age")<0&&b<e&&c.push({type:d.errorTypes.MISSING_CHILD_AGE,index:b,childNumber:b+1})})}function j(a){var b=0,e=a.get("numberOfAdults"),f=a.get("numberOfChildren"),g=a.get("childAges"),h=a.get("infantsInLap");g.each(function(a,c){return!(c>=f)&&(!h||0!==a.get("age")&&1!==a.get("age")||(b+=1),void(a.get("age")>=12&&(e+=1)))}),b>e&&c.push({type:d.errorTypes.UNATTENDED_INFANT_IN_LAP})}function k(a){var b=6,e=a.get("numberOfAdults")+a.get("numberOfChildren");e>b&&c.push({type:d.errorTypes.INVALID_TRAVELER_COUNT})}function l(a){return void 0===a||"string"==typeof a&&0===a.length}function m(a){return l(a.departure.get("airport"))&&l(a.departure.get("date").get("shortFormat"))&&l(a.arrival.get("airport"))&&l(a.arrival.get("date").get("shortFormat"))}function n(a){return a instanceof Date&&!isNaN(a.getTime())}function o(b,c,d){var e;return!l(b)&&(e=a.utils.createLocalizedDate(b,d),!!n(e.date))}function p(b,c,d){var e,f;return!(!l(c)&&(f=a.utils.createLocalizedDate(c,d),n(f.date)))||(e=a.utils.createLocalizedDate(b,d),e.date.getTime()>=f.date.getTime())}function q(b,c,d,e){var f=a.utils.createLocalizedDate(e.min,d).date.getTime(),g=a.utils.createLocalizedDate(e.max,d).date.getTime(),h=a.utils.createLocalizedDate(b,d).date.getTime();return h>=f&&h<=g}var c=[],d={errorTypes:{NO_ERROR:0,MISSING_CHILD_AGE:1,UNATTENDED_INFANT_IN_LAP:2,INVALID_TRAVELER_COUNT:3,MULTIPLE_DESTINATION:{DEPARTURE_AIRPORT_BLANK:101,ARRIVAL_AIRPORT_BLANK:102,DEPARTURE_ARRIVAL_AIRPORT_SAME:103,INVALID_DEPARTURE_DATE:104,DEPARTURE_DATE_NOT_IN_RANGE:105,DEPARTURE_DATE_PRIOR_TO_PREVIOUS_TRIP:151},ONE_WAY:{DEPARTURE_AIRPORT_BLANK:201,ARRIVAL_AIRPORT_BLANK:202,DEPARTURE_ARRIVAL_AIRPORT_SAME:203,INVALID_DEPARTURE_DATE:204,DEPARTURE_DATE_NOT_IN_RANGE:205},ROUND_TRIP:{DEPARTURE_AIRPORT_BLANK:301,ARRIVAL_AIRPORT_BLANK:302,DEPARTURE_ARRIVAL_AIRPORT_SAME:303,INVALID_DEPARTURE_DATE:304,DEPARTURE_DATE_NOT_IN_RANGE:305,INVALID_RETURN_DATE:306,RETURN_DATE_NOT_IN_RANGE:307}},validate:function(a){var b=a.get("routeType"),d=a.get("trips"),e=a.get("travelerPreferences"),h=a.get("locale"),l=a.get("dateFormat"),m=a.get("validSearchDates");return c=[],g(b,f(b,d),h,l,m),i(e),j(e),k(e),c}};return d}),define("travelerPreferencesModel",["backbone","underscore"],function(a,b){"use strict";var c=5;return a.Model.extend({initialize:function(){var d=[],e=this.get("childAges");b.times(c,function(a){var b=a<e.length?e[a]:-1;d.push({age:b})}),this.set("childAges",new a.Collection(d)),this.updateHasChildUnderTwo(),this.listenTo(this.get("childAges"),"change",this.updateHasChildUnderTwo)},updateHasChildUnderTwo:function(){var a=!1,b=this.get("numberOfChildren");this.get("childAges").each(function(c,d){return!(d>=b||a)&&void(0!==c.get("age")&&1!==c.get("age")||(a=!0))}),this.set("hasChildUnderTwo",a)}})}),define("tripModel",["backbone","dateModel"],function(a,b){"use strict";return a.Model.extend({initialize:function(c,d){var h,i,e=d.collection.locale,f=this.attributes.departure.date,g=this.attributes.arrival.date;h=$.extend(!0,{},this.attributes.departure,{date:new b(f,e)}),this.set("departure",new a.Model(h)),i=$.extend(!0,{},this.attributes.arrival,{date:new b(g,e)}),this.set("arrival",new a.Model(i))}})}),define("dateModel",["backbone","uitk"],function(a,b){"use strict";return a.Model.extend({initialize:function(a,b){this.locale=b,this.attributes.shortFormat=a},toFullDateString:function(){var a=this.locale,c=this.get("shortFormat");return""!==c?b.utils.createLocalizedDate(c,a).fullDate():""},toMediumDateString:function(){var a=this.locale,c=this.get("shortFormat");return""!==c?b.utils.createLocalizedDate(c,a).mediumDate():""}})}),define("tripCollection",["tripModel","backbone","underscore","dateModel"],function(a,b,c,d){"use strict";function e(a){var b;return"ROUND_TRIP"===a?(b=c.findLastIndex(this.models,function(a){return""!==a.get("arrival").get("date").get("shortFormat")}),this.at(b).get("arrival").get("date")):"MULTIPLE_DESTINATION"===a?(b=c.findLastIndex(this.models,function(a){return""!==a.get("departure").get("date").get("shortFormat")}),this.at(b).get("departure").get("date")):new d("","")}return b.Collection.extend({initialize:function(a,b){this.locale=b},model:a,getLastTravelDate:e})}),define("pageCriteriaModel",["jquery","sort.UiModel","backbone","i18n","configuration","flights","experiments"],function(a,b,c,d,e,f,g){"use strict";var h=!1,i=c.Model.extend({defaults:{fetchOrigin:"InitialSearch",interstitialMessage:d.filters.interstitial.generic,continuationId:a("#originalContinuationId").text(),chunk:{number:0,size:e.pagination.initialRequestOfferCount},filter:{},sort:{type:e.loyalty.partnerPointsEnabled?"so":"sp",direction:b.SORT_DIRECTION.ASCENDING},currentPageNumber:1,packageType:""},initialize:function(a){var b=this;h=a.shouldAddUniqueLeg,b.set("packageType",a.packageType),f.vent.once("uiModel.resultsFetchSuccess",function(){b.set("chunk",{number:b.get("chunk").number,size:e.pagination.numOffersPerPage},{silent:!0})})},setPaginationCriteria:function(a){var b,c;b=a.get("currentPageNumber"),c=a.get("messageTemplate").replace("{0}",b),this.set({currentPageNumber:b,fetchOrigin:a.get("name"),interstitialMessage:c})},isInitialSearch:function(){return this.get("fetchOrigin").toLowerCase().indexOf(this.defaults.fetchOrigin.toLowerCase())>=0},setShouldAddUniqueLeg:function(a){h=a},getLegNumberFromCriteria:function(a){var b=a.match(/^.*?(\d+)?$/i)[1];if("string"==typeof b)return parseInt(b,10)},getTypeFromCriteria:function(a){return a.match(/^(.*?)(?:\d+)?$/i)[1]},toJSON:function(){var j,b=this.get("chunk"),c=this.get("sort"),d=this.get("packageType"),e={cz:b.size,cn:this.get("currentPageNumber")-1},f={},i=0;return f[c.type]=c.direction,j=a.extend({c:a("#originalContinuationId").text(),is:!0===this.isInitialSearch()?1:0},this.get("filter"),f,e),!0===h&&(void 0!==j.fl0&&(i=1),j.ul=i),"undefined"!=typeof d&&""!==d&&"f"!==d&&(j.packageType=d),g.execute("FSR_Listing_Details_Separation",j),j}});return new i({shouldAddUniqueLeg:e.view.isByot,packageType:e.path.type})}),define("filter.UiModel",["jquery","underscore"],function(a,b){"use strict";function g(a,c,d){return function(e){return b.indexOf(a,e.get("legs")[c][d].airportCode)!==-1}}function h(a,d,e){var f=b.map(a,function(a){return c[a]});return function(a){return b.indexOf(f,a.get("legs")[d].duration[e])!==-1}}var c={em:"EARLYMORNING",m:"MORNING",a:"AFTERNOON",e:"EVENING"},d={STOPS:"fs",AIRLINE:"fa",STRICT_AIRLINE:"fas",ARRIVAL_TIME:"fr",DEPARTURE_TIME:"fd",ORIGIN_AIRPORT:"fao",DESTINATION_AIRPORT:"fad",LEG:"fl"},e={},f={};return e[d.STOPS]=function(a,c){var d=b.indexOf(a,"0")!==-1,e=b.indexOf(a,"1")!==-1,f=b.indexOf(a,"2")!==-1;return function(a){var b=!1,g=a.numStopsForFilters(c);return d&&(b=b||0===g),e&&(b=b||1===g),f&&(b=b||g>=2),b}},e[d.AIRLINE]=function(a,c){return function(d){var e=!1,f=b.uniq(a);return b.each(d.get("legs"),function(a,d){void 0!==c&&d!==c||b.each(f,function(c,d){e=e||b.indexOf(a.carrierSummary.airlineCodes,c)!==-1})}),e}},e[d.DEPARTURE_TIME]=function(a,b){return h(a,b,"departureTimeOfDay")},e[d.ARRIVAL_TIME]=function(a,b){return h(a,b,"arrivalTimeOfDay")},e[d.ORIGIN_AIRPORT]=function(a,b){return g(a,b,"departureLocation")},e[d.DESTINATION_AIRPORT]=function(a,b){return g(a,b,"arrivalLocation")},e[d.LEG]=function(a,b){return function(c){return c.get("legIds")[b]===a[0]}},{get:function(b){var c,d=b.type+"-"+b.values+"-"+b.leg;
try{return void 0===f[d]&&(c=e[b.type](b.values.split(","),b.leg),f[d]=function(a){return!a.get("bargainOffer")&&c(a)}),f[d]}catch(b){return console.log(b),a.noop}},add:function(a,b){e[a]=b},FILTER_TYPE:d}}),define("offerModel.uiModel",["backbone"],function(a){"use strict";return a.Model.extend({numStopsForFilters:function(a){var b=0,c=this.get("legs");return void 0!==a?c[a].stops:(_.each(c,function(a){b=Math.max(b,a.stops)}),b)},getTotalDurationInMinutes:function(a){var b=0,c=this.get("legs");return void 0!==a?60*c[a].duration.hours+c[a].duration.minutes:(_.each(c,function(a){b+=60*a.duration.hours+a.duration.minutes}),b)}})}),define("offersCollection.UiModel",["offerModel.uiModel"],function(a){"use strict";return Backbone.Collection.extend({model:a})}),define("sort.UiModel",["jquery"],function(a){"use strict";function g(a,b){return[a,b].join("-")}function h(a,b){var c=a.get("price").totalPriceAsDecimal,d=b.get("price").totalPriceAsDecimal;return null===c?1:null===d?-1:c-d}var f,b={ASCENDING:"asc",DESCENDING:"desc"},c={PRICE:"sp",DURATION:"st",DEPARTURE_TIME:"sd",ARRIVAL_TIME:"sa"},d={},e={};return d[g(c.PRICE,b.ASCENDING)]=function(a){return function(b,c){var d=b.get("price").totalPriceAsDecimal,e=c.get("price").totalPriceAsDecimal,f=b.getTotalDurationInMinutes(a),g=c.getTotalDurationInMinutes(a),i=void 0===a?0:a;return d===e?f===g?b.get("legs")[i].departureTime.dateTime-c.get("legs")[i].departureTime.dateTime:f-g:h(b,c)}},d[g(c.PRICE,b.DESCENDING)]=function(a){return function(b,c){var d=b.get("price").totalPriceAsDecimal,e=c.get("price").totalPriceAsDecimal,f=b.getTotalDurationInMinutes(a),g=c.getTotalDurationInMinutes(a),i=void 0===a?0:a;return d===e?f===g?b.get("legs")[i].departureTime.dateTime-c.get("legs")[i].departureTime.dateTime:f-g:h(c,b)}},d[g(c.DURATION,b.ASCENDING)]=function(a){return function(b,c){var d=b.getTotalDurationInMinutes(a),e=c.getTotalDurationInMinutes(a),f=b.get("price").totalPriceAsDecimal,g=c.get("price").totalPriceAsDecimal,i=void 0===a?0:a;return d===e?f===g?b.get("legs")[i].departureTime.dateTime-c.get("legs")[i].departureTime.dateTime:h(b,c):d-e}},d[g(c.DURATION,b.DESCENDING)]=function(a){return function(b,c){var d=b.getTotalDurationInMinutes(a),e=c.getTotalDurationInMinutes(a),f=b.get("price").totalPriceAsDecimal,g=c.get("price").totalPriceAsDecimal,i=void 0===a?0:a;return d===e?f===g?b.get("legs")[i].departureTime.dateTime-c.get("legs")[i].departureTime.dateTime:h(b,c):e-d}},d[g(c.DEPARTURE_TIME,b.ASCENDING)]=function(a){return function(b,c){var d=b.get("legs")[a].departureTime.dateTime,e=c.get("legs")[a].departureTime.dateTime,g=b.get("price").totalPriceAsDecimal,i=c.get("price").totalPriceAsDecimal;return d===e?g===i?f?b.getTotalDurationInMinutes(a)-c.getTotalDurationInMinutes(a):b.getTotalDurationInMinutes()-c.getTotalDurationInMinutes():h(b,c):d-e}},d[g(c.DEPARTURE_TIME,b.DESCENDING)]=function(a){return function(b,c){var d=b.get("legs")[a].departureTime.dateTime,e=c.get("legs")[a].departureTime.dateTime,g=b.get("price").totalPriceAsDecimal,i=c.get("price").totalPriceAsDecimal;return d===e?g===i?f?b.getTotalDurationInMinutes(a)-c.getTotalDurationInMinutes(a):b.getTotalDurationInMinutes()-c.getTotalDurationInMinutes():h(b,c):e-d}},d[g(c.ARRIVAL_TIME,b.ASCENDING)]=function(a){return function(b,c){var d=b.get("legs")[a].arrivalTime.dateTime,e=c.get("legs")[a].arrivalTime.dateTime,g=b.get("price").totalPriceAsDecimal,i=c.get("price").totalPriceAsDecimal;return d===e?g===i?f?b.getTotalDurationInMinutes(a)-c.getTotalDurationInMinutes(a):b.getTotalDurationInMinutes()-c.getTotalDurationInMinutes():h(b,c):d-e}},d[g(c.ARRIVAL_TIME,b.DESCENDING)]=function(a){return function(b,c){var d=b.get("legs")[a].arrivalTime.dateTime,e=c.get("legs")[a].arrivalTime.dateTime,g=b.get("price").totalPriceAsDecimal,i=c.get("price").totalPriceAsDecimal;return d===e?g===i?f?b.getTotalDurationInMinutes(a)-c.getTotalDurationInMinutes(a):b.getTotalDurationInMinutes()-c.getTotalDurationInMinutes():h(b,c):e-d}},{get:function(b){var c;f="boolean"==typeof b.useDurationOfSingleLeg&&b.useDurationOfSingleLeg;try{return c=b.type+b.direction+b.leg+f,void 0===e[c]&&(e[c]=d[g(b.type,b.direction)](b.leg)),e[c]}catch(b){return console.log(b),a.noop}},SORT_TYPE:c,SORT_DIRECTION:b}}),define("uiModel",["flights","jquery","dctk/dctk","filter.UiModel","sort.UiModel","offersCollection.UiModel","backbone","underscore","pageCriteriaModel","applicationViewLogging","universalDataObjectAjaxUtils","configuration","analytics","fetchConfiguration.UiModel","ajaxErrorModel","experiments"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";function x(a){var c=[];return b.each(a,function(a,d){var e=s.offers[d];e.legs=[],b.each(e.legIds,function(a,b){e.legs.push(s.legs[b])}),e.numLegs=e.legs.length,s.partnerLoyaltyDataMap&&void 0!==s.partnerLoyaltyDataMap[d]&&(e.partnerLoyaltyData=s.partnerLoyaltyDataMap[d]),q&&(e.resultToken=q.resultToken,q.multiItemDetails&&(e.price.anchoredPrice=q.multiItemDetails.totalFare,e.price.isPositiveDelta=e.price.roundedBestPriceDelta>=0,e.price.absoluteValuePrice=e.price.formattedRoundedBestPriceDelta.replace("-",""))),c.push(e)}),c}function y(b){a.collections.legsCollection.set(b),a.collections.legsCollection.trigger("change")}var q,r,s,t,u,v,w;g.$=b,s={index:[],legs:{},offers:{},partnerLoyaltyDataMap:{},merge:function(a){var b=this;if(void 0===a)throw"`model` is undefined";if(void 0===a.index)throw"`model.index` is undefined";if(void 0===a.legs)throw"`model.legs` is undefined";if(void 0===a.offers)throw"`model.offers` is undefined";b.index=a.index,h.each(a.legs,function(a,c){b.legs[c]=a}),h.each(a.offers,function(a,c){b.offers[c]=a}),l.loyalty.partnerPointsEnabled&&(b.partnerLoyaltyDataMap=a.partnerLoyaltyDataMap)}};var z=g.Model.extend({url:"/Flight-Search-Paging",parse:function(a){var b;return b=a.content,void 0!==b&&this.addCacheInfo(b,{isCached:!1}),void 0===q||void 0!==b&&0!==h.keys(b.offers).length?b:q},staleTimeout:60*l.modalTimerMinutes*1e3,rawData:s,addCacheInfo:function(a,c){null!==a.offers&&b.each(a.offers,function(a,b){b.isCached=c.isCached,b.freshness=c.freshness})},loadContentModel:function(a){q=a,this.rawData.merge(a),p.getVariant(13327)>0&&this.set("legs",a.legs),this.refreshViewableOffers()},viewableOffers:new f,refreshViewableOffers:function(){this.viewableOffers.set(x(this.rawData.index))},setCacheType:function(a){r=a},getCacheType:function(){return r},resetViewableOffers:function(b,c){var e,f,g,d=c&&c.source?c.source:"";if(o.resetToDefaults(),!1==b instanceof Array)throw new Error("You must pass an instance of `Array`");f=j.getNowTime(),p.execute("FSR_Memoize_Offer_Templates",{source:d}),this.viewableOffers.reset(b),g=j.getNowTime(),p.execute("FSR_Memoize_Offer_Templates_Log.LogEvent",{renderTimeStart:f,renderTimeEnd:g}),a.vent.trigger("uiModel.resetViewableOffers",{source:d}),0===this.viewableOffers.length&&(e=["origin=uiModel.resetViewableOffers"],this.trigger("noFlightsFound",{logErrorData:e}),a.vent.trigger("noFlightsFound"),o.set({errorStatus:o.ERROR_CODES.NO_FLIGHTS_FOUND,options:{origin:i.get("fetchOrigin")},logData:e}))},isEmpty:function(){return b.isEmptyObject(this.rawData.offers)},fetchRawData:function(d){var e=this,f=j.getNowTime(),g=i.get("fetchOrigin"),h=i.toJSON(),l=["origin=uiModel.requestOffers"];c&&c.ewePerformance&&c.ewePerformance.mark("requestLiveOffers"),a.vent.trigger("uiModel.fetching",{cacheType:r,fetchOrigin:g}),this.fetch({data:h,timeout:9e4,success:function(h,n,r){var s,t,u,w,x;return c&&c.ewePerformance&&(c.ewePerformance.mark("requestLiveOffersSuccess"),c.ewePerformance.measure("pageDataFetchTime","requestLiveOffers","requestLiveOffersSuccess")),q=h.toJSON(),t=j.getNowTime(),s=n.content,x=h.get("summary"),x&&x.discountAvailable?m.updateOmnitureProperty("events","event12,event54,event203"):m.updateOmnitureProperty("events","event12,event54"),"ACCEPT"===h.get("omniture").status&&m.updateOmnitureData(b.parseJSON(h.get("omniture").json)),w=null!==s.universalDataObject?s.universalDataObject.pageInfo.pageName:c.omtr.pageName,a.vent.trigger("uiModel.pageNameReceived."+g,{pageName:w}),j.logPerformanceModelResults(n,r),s&&s.errorData&&s.errorData.error?void v.fail(function(){u={errorStatus:s.errorData.status,logData:l},l.push("errorDescription="+s.errorData.description),l.push("errorCode="+s.errorData.status),s.errorData.eventName&&l.push("errorEventName="+s.errorData.eventName),e.trigger("responseError",u),e.trigger("responseError."+g,{errorInfo:u,pageName:w}),o.set({errorStatus:u.errorStatus,options:{origin:i.get("fetchOrigin")},logData:u.logData}),void 0!==d&&"function"==typeof d.error&&d.error(u)}):(p.execute("FILTERS_EXPERIMENTS",{legs:e.get("legs"),offers:e.get("offers"),isLive:!0}),k.processUDOAndFirePixels(s),j.logEvent("FLUX_uiModel_AjaxDuration_"+g,f,t),y(h.get("legs")),e.rawData.merge(h.attributes),void 0!==d&&"function"==typeof d.success&&d.success(h,s,r),a.vent.trigger("uiModel.resultsFetchSuccess",{model:h,response:n}),void a.vent.trigger("uiModel.resultsFetchSuccess."+g,{model:h,pageName:w}))},error:function(b,c,d){0===c.readyState&&"abort"===c.statusText||v.fail(function(){a.vent.trigger("uiModel.resultsFetchFailure",{response:c}),a.vent.trigger("uiModel.resultsFetchFailure."+g),o.set({errorStatus:c.statusText,options:{origin:i.get("fetchOrigin")},logData:l})})}})},filterCheapestUniqueLegs:function(a,b){var c,d={};return 0!==b?a:(a.forEach(function(a){var c,e,f,g,h,i;if(!a.get("bargainOffer")){if(c=a.get("legs")[b].naturalKey,e=d[c],f=void 0!==e,g=a.get("price").totalPriceAsDecimal,h=null===g,i=f&&null===e.price,f){if(h)return;if(!i&&e.price<g)return}d[c]={price:g,offerNaturalKey:a.get("naturalKey")}}}),c=a.filter(function(a){var c,e,f;return!!a.get("bargainOffer")||(c=a.get("legs")[b].naturalKey,e=a.get("naturalKey"),f=d[c].offerNaturalKey,e===f)}),new f(c))},filterSet:function(a,c){var e,g;return g=j.getNowTime(),0===h.keys(c).length?a:(e=a.toArray(),b.each(c,function(a,b){var c=d.get({type:i.getTypeFromCriteria(a),values:b,leg:i.getLegNumberFromCriteria(a)});e=h.filter(e,c)}),j.logEvent("FLUX_uiModel_FilterTime",g,j.getNowTime()),new f(e))},filterBargainOffers:function(a,b){var c;return b!==e.SORT_TYPE.PRICE?(c=a.filter(function(a){return!a.get("bargainOffer")}),new f(c)):a},sortSet:function(a,b){var c,d;d=j.getNowTime(),c=e.get({type:i.getTypeFromCriteria(b.type),direction:b.direction,leg:l.view.isByot?i.toJSON().ul:i.getLegNumberFromCriteria(b.type),useDurationOfSingleLeg:l.view.isByot}),a.comparator=c,a.sort(),j.logEvent("FLUX_uiModel_SortTime",d,j.getNowTime())},chunkSet:function(a,b){var c,d;return c=b.size*b.number,d=c+b.size,new f(a.slice(c,d))},removeCachedOffers:function(a){var b;return b=h.filter(a.toJSON(),function(a){return!1===a.isCached}),new f(b)},preparePage:function(a){var b,c,d,e,f;return e=a,f=h.where(e.toJSON(),{isCached:!1}),0<f.length&&(e=this.removeCachedOffers(e)),e=this.filterCheapestUniqueLegs(e,i.toJSON().ul),b=i.get("filter"),e=this.filterSet(e,b),c=i.get("sort"),e=this.filterBargainOffers(e,i.getTypeFromCriteria(c.type)),this.sortSet(e,c),d=i.get("chunk"),this.chunkSet(e,d)},selectLeg:function(a){var b=this.get("legs")[a];void 0!==b&&(b.isSelected=!0)},deselectLeg:function(a){var b=this.get("legs")[a];void 0!==b&&(b.isSelected=!1)},getPage:function(c){var e,g,h,k,o,d=this;return u=b.Deferred(),v=b.Deferred(),d.isEmpty()?(v.reject(),void d.fetchRawData({success:function(a,b,e){var f=x(d.rawData.index);f.length>0&&m.updateOmnitureProperty("prop52",j.generateListingOmnitureString(f[0])),d.resetViewableOffers(f.slice(0,l.pagination.numOffersPerPage),{source:"server"}),"function"==typeof c&&c(a,b,e)}})):(g=i.get("fetchOrigin"),h=n.shouldMakeRequest(g),k=n.shouldPerformClientOperations(g),h&&(u=b.Deferred(function(b){d.fetchRawData({success:function(h,i,j){var k;"function"==typeof c&&c(h,i,j),k="undefined"==typeof i.index||0===i.index.length?d.rawData.index:i.index,e=new f(x(k)),"Pagination"!==g&&(e=d.preparePage(e)),d.resetViewableOffers(e.toArray(),{source:"server"}),a.vent.trigger("uiModel.serverResultsRendered"),b.resolve(),clearTimeout(w)}})})),o=!1,k&&(v=b.Deferred(function(a){e=new f(x(d.rawData.index)),e=d.preparePage(e),o=e.toArray().length>0,clearTimeout(w),w=setTimeout(function(){"resolved"===u.state()||h&&!o||d.resetViewableOffers(e.toArray(),{source:"client"}),!1===o&&a.reject()},l.byotFilterTime)})),void(!1===o&&v.reject()))},fetch:function(a){return"object"!=typeof a&&(a={}),"object"==typeof t&&0!==t.readyState&&4!==t.readyState&&t.abort(),t=g.Model.prototype.fetch.call(this,a)},initialize:function(){var a=this;setTimeout(function(){a.trigger("stale")},a.staleTimeout),this.listenTo(i,"change",function(){this.getPage()})}});return new z}),define("fetchConfiguration.UiModel",["configuration"],function(a){"use strict";return{shouldMakeRequest:function(b){return"InitialSearch"===b||!0!==a.route.isOneWay&&(!1===a.view.isByot||("LegSelect"===b||"LegUnselect"===b))},shouldPerformClientOperations:function(b){return"Pagination"!==b&&(!a.view.isByot||"InitialSearch"!==b&&"LegSelect"!==b&&"LegUnselect"!==b)}}}),define("offersCollectionView",["jquery","underscore","flights","marionette","uitk","uiModel","standardOfferView","bargainOfferView","pageCriteriaModel","configuration","interstitial","progress","applicationViewLogging","i18n","experiments"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a,b){var d,e,c=!1===a.get("bargainOffer");!0===c&&(d=a.get("legs"),e=a.get("legIds"),a.set({legs:[d[b]],legIds:[e[b]]}))}function q(a,b){var c=0===b,d=a.get("price");d.useDeltaPrice=j.useDeltaPrice&&!1===c,a.set("price",d)}function r(a){var c=b.map(a.get("legs"),function(a){return a.identity.index}).join(",");a.set("legIndexList",c)}function s(a){void 0!==a&&void 0!==t&&(0===t.getNextLegToView()?a.text(n.headers.departureResults):a.text(n.headers.returnResults))}function w(a){j.loyalty.enabled&&b.each(a.get("legs"),function(a){a.awardValue=v})}var t,u,v=100,x=d.CollectionView.extend({childView:g,interstitial:{$acol:a("#acol-interstitial"),$outboundSpinner:a("#outboundSpinner"),$pi:a("#pi-interstitial")},showInterstitial:function(){var a,b=i.get("interstitialMessage");i.isInitialSearch()?(a=j.perceivedInstantEnabled?this.interstitial.$pi:this.interstitial.$acol,k.show(a,{elements:a.find(".progress-bar")})):l.showOnPageInterstitial(b)},hideInterstitial:function(a){var b="client"===a||"reset"===a;i.isInitialSearch()&&b||(this.interstitial&&(j.perceivedInstantEnabled?k.hide(this.interstitial.$pi):k.hide(this.interstitial.$acol)),l.hideInterstitial())},initialize:function(a){var b=this;this.showInterstitial(),this.listenTo(i,"change",this.showInterstitial),this.listenTo(c.vent,"uiModel.resetViewableOffers",function(a){"object"==typeof a&&"server"===a.source&&b.hideInterstitial(a.source)}),this.listenTo(f.viewableOffers,"reset",function(){b.hideInterstitial("reset")}),this.listenTo(f,"responseError",this.hideInterstitial),this.listenTo(c.vent,"uiModel.resultsFetchFailure",this.hideInterstitial),t=a.router,this.listenTo(c.vent,"router.noSelectedLegs router.selectedLegs",function(){s(a.$listingsHeader)}),s(a.$listingsHeader)},onBeforeRender:function(){u=m.getNowTime()},onRenderCollection:function(){c.vent.trigger("offersCollectionView.render"),a("#cachedOfferList").remove(),m.logEvent("FLUX_ActualResultsRenderedDuration",u,m.getNowTime())},childViewOptions:function(a,b){a.set("resultNumber",b+1),w(a),r(a),void 0!==t&&(p(a,t.getNextLegToView()),q(a,t.getNextLegToView()))},getChildView:function(a){return a.get("bargainOffer")?(o.execute("FSRMobileSuppressEBFOffers"),h):g},getOfferElement:function(c){var d=b.find(this.children._views,function(a){return a.model.get("naturalKey")===c});return void 0===d?a("<div/>"):d.$el}});return x}),define("pageCriteriaController",["backbone","underscore","pageCriteriaModel","i18n","flights","configuration","experiments"],function(a,b,c,d,e,f,g){"use strict";function n(a){$("html, body").animate({scrollTop:0},0,a)}function o(){require(["setupRouter"],function(a){var b=a().getCurrentFragment();""!==b&&(c.defaults.filter.fl0=b,h.set("legFilters",{fl0:b},{silent:!0}))})}function p(a){a.listenTo(e.vent,"router.noSelectedLegs",function(){h.set("legFilters",{},{silent:!0}),n(function(){q({fetchOrigin:"LegUnselect",interstitialMessage:d.searching.interstitial.departing,filter:{},sort:c.defaults.sort}),g.execute("SCROLL_TO_CONTENT_MOBILE")})}),a.listenTo(e.vent,"router.selectedLegs",function(a){h.set("legFilters",{fl0:a},{silent:!0}),n(function(){q({fetchOrigin:"LegSelect",interstitialMessage:d.searching.interstitial.returning,filter:{fl0:a},sort:c.defaults.sort}),g.execute("SCROLL_TO_CONTENT_MOBILE")})})}function q(a){var e=(l||g.getVariant(13031)||g.getVariant(13032)||g.getVariant(13030))&&!m;a.fetchOrigin&&"Pagination"!==a.fetchOrigin&&j.set({currentPageNumber:1,currentFirstResult:1},{silent:!0}),a=b.extend({filter:e?c.get("filter"):h.retrieveActiveFilters(),sort:i.retrieveActiveSort(),fetchOrigin:"InitialSearch",interstitialMessage:d.filters.interstitial.generic,currentPageNumber:j.get("currentPageNumber"),chunk:{number:j.get("currentPageNumber")-1,size:f.pagination.numOffersPerPage}},a),c.set({filter:a.filter,sort:a.sort,fetchOrigin:a.fetchOrigin,interstitialMessage:a.interstitialMessage,currentPageNumber:a.currentPageNumber,chunk:a.chunk})}var h,i,j,k,l=!1,m=g.getVariant(13347)>0;return k=function(d){var f=b.extend({},a.Events);return h=d.filtersModel,i=d.sortModel,j=d.paginationModel,l=d.routerEnabled,f.listenTo(h,"change:legFilters",function(a){var c=b.keys(a.get("legFilters")).length;q({fetchOrigin:"LegFilter"+c})}),m?f.listenTo(h,"change",function(){q({filter:h.retrieveActiveFilters(),fetchOrigin:"Filter",interstitialMessage:h.get("interstitialMessage")})}):(e.vent.on("filtersView.filterSelected",function(a){var c=h.get("legFilters");q({filter:b.extend(a.filter,c),fetchOrigin:"Filter",interstitialMessage:a.interstitialMessage})}),e.vent.on("filtersView.summaryUpdated",function(){var a=h.retrieveActiveFilters();c.set("filter",a,{silent:!0})})),f.listenTo(i,"change",function(a){q({fetchOrigin:"Sort",interstitialMessage:a.get("interstitialMessage")})}),f.listenTo(j,"change:currentPageNumber",function(a){q({fetchOrigin:"Pagination",interstitialMessage:a.get("messageTemplate").replace("{0}",a.get("currentPageNumber"))})}),!0===l&&(o(),p(f)),f}}),define("pageNameTracker",["analytics"],function(a){"use strict";function b(b){a.updatePageNameForOmniture(b.pageName),a.trackPageLoad()}return{trackPageName:function(a,c){a.vent.on("uiModel.pageNameReceived.InitialSearch",b)},trackByotPageName:function(a,c){a.vent.on("uiModel.pageNameReceived.LegSelect",b),a.vent.on("uiModel.pageNameReceived.LegUnselect",b)}}}),define("impressionDataForAnalytics",["pageCriteriaModel","flights","uiModel","jquery","dctk/dctk","backbone","Impressions","promotionrulesmodel","configuration"],function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l="/cl/data/epcairofferimpression.json?stream=true&persist=true&rollup=Minute",o={getSearchParameters:function(){return void 0===k.searchParameters&&(k.searchParameters=d.parseJSON(d("#wizardData").html()),delete k.searchParameters.typeAhead,delete k.searchParameters.calendar),k.searchParameters},getSessionId:function(a){return a.get("continuationId")},getExperimentInfo:function(){k=this;var a=[],b=h.abacusExperimentId,c=d.Deferred(),f=!0;return d.isEmptyObject(h)||(f=!1,e.evaluateExperiment({id:b,callback:function(d){d.error?e.logging.logError("FSR: ",d.error.message,{error:"Failed to evaluate experiment:"+b}):(a.push({experimentId:b,bucketValue:d.value,instanceId:d.experiments[0].instanceId}),k.tests=a,k.promotionId=h.promotionId),c.resolve()}})),f&&c.resolve(),k.tests=a,k.promotionId=void 0,c.promise()},getTravelerInfo_InfantsInSeat_InfantsInLap:function(a,b){var f,c={},d=0,e=0;for(f=0;f<b.length;f++)b[f]<=2?d++:e++;return a?(c.infantinLapCount=d,c.infantinSeatCount=e):(c.infantinLapCount=0,c.infantinSeatCount=d+e),c},getOffersDataForEPCLogging:function(a){var b;b=a.toJSON();var c=[];return d.each(b,function(a,b){var d=[];if("undefined"!=typeof b.legs){var e,f={};for(e=0;e<b.legs.length;e++)f={carrierCode:b.legs[e].carrierSummary.airlineCodes,departureAirportCode:b.legs[e].departureLocation.airportCode,arrivalAirportCode:b.legs[e].arrivalLocation.airportCode,departureDateTime:b.legs[e].departureTime.isoStr,arrivalDateTime:b.legs[e].arrivalTime.isoStr,price:{totalPrice:b.price.totalPriceAsDecimalString?b.price.totalPriceAsDecimalString:void 0,currencyCode:b.price.totalPriceAsDecimalString?b.price.currencyCode:void 0},fareType:b.legs[e].price.flightFareTypeCode},d.push(f)}var g={piid:b.piid,splitTicket:b.splitTicket,legs:d};c.push(g)}),c},populateLogData:function(b){b=b||{};var f=k.getSearchParameters(),g=f.departure.airport.length,h=f.arrival.airport.length,i=k.getTravelerInfo_InfantsInSeat_InfantsInLap(f.infantsInLap,f.childAges);return b=d.extend(!0,b,{context:{user:{guid:e._guid,tuid:"undefined"!=typeof e.omtr?e.omtr.prop11:-1},site:{tpid:e._tpid,eapid:e._eapid},sessionId:k.getSessionId(a),purchasePath:"standalone"},pageInfo:{pageName:e.omtr.pageName,tripType:"ONE_WAY"===f.routeType?"OW":"ROUND_TRIP"===f.routeType?"RT":void 0},travelerInfo:{numberOfAdults:f.adultCount,numberOfSeniors:f.seniorCount,numberOfChildren:f.childCount,numberOfInfantsInLap:i.infantinLapCount,numberOfInfantsInSeat:i.infantinSeatCount},data:{searchParameters:{departureAirportCode:f.departure.airport.substring(g-4,g-1),arrivalAirportCode:f.arrival.airport.substring(h-4,h-1),departureDateTime:new Date(f.departure.date).toISOString(),arrivalDateTime:"ONE_WAY"===f.routeType?void 0:new Date(f.arrival.date).toISOString()},offerlist:k.getOffersDataForEPCLogging(c.viewableOffers)},utctimestamp:Date.now()})},log:function(a){if(void 0!==a&&!d.isPlainObject(a))return console.log("Invalid parameter passed to logImpressionData(); parameter must be an object."),void console.dir(a);a=k.populateLogData(a),a.context.tests=k.tests,a.data.promotionId=k.promotionId;var b=window.location.host;b.indexOf("trunk")!==-1&&(l="https://wwwexpediacom.integration.sb.karmalab.net"+l),j=new g(l),j.log(a,function(a,b){void 0!==b&&k.logErrorWithXHR("Failed to post impression data to collector web",b,a,["origin=impressionDataForAnalytics.log"])})},logErrorWithXHR:function(a,b,c,f){f=f||[],a&&b&&c&&d.isArray(f)&&(window.skellyContext&&f.push("isSkelly=true"),f.push("onError xhr status="+c.status),f.push("onError xhr response text="+c.responseText),f.push("pageUrl="+encodeURIComponent(window.location.href)),f.push("clientWidth="+document.documentElement.clientWidth),e.logging.logError(a,b,f),window.console&&"function"==typeof window.console.error&&window.console.error(b.stack))}};return d(function(){var a=d.extend({},f.Events);a.listenTo(c.viewableOffers,"reset",function(){try{o.getExperimentInfo().pipe(o.log)}catch(a){e.logging.logError("Impression logging failed",a,["origin=impressionDataForAnalytics.log"])}})}),o}),require(["configuration"],function(a){"use strict";a.isImpressionLoggingEnabled&&require(["impressionDataForAnalytics"])}),define("Impressions",["jquery"],function(a){"use strict";function b(b){this.url=b,this.log=function(b,c){a.ajax({type:"POST",contentType:"application/json",url:this.url,data:window.JSON.stringify(b)}).done(function(a,b,d){if("function"==typeof c)return c(d)}).fail(function(a,b,d){if("function"==typeof c)return c(a,d)})}}return b}),define("wizardUrlBuilder",["underscore","FluxSearchDeeplinkGenerator","experiments"],function(a,b,c){"use strict";var d=function(a){var e,f,h,i,j,k,l,m,b=[],c={},d=a.get("trips"),g=a.get("routeType");return d.each(function(a){e=a.get("departure"),f=a.get("arrival"),l=void 0!==e&&""!==e&&void 0!==f&&""!=f,l&&(h=e.get("airport"),i=f.get("airport"),j=e.get("date").get("shortFormat"),k=f.get("date").get("shortFormat"),m=void 0!==h&&""!==h&&void 0!==i&&""!==i&&void 0!==j&&""!==j,m&&(c={departureLocation:h,arrivalLocation:i,departureDate:j},"ROUND_TRIP"===g&&void 0!==k&&""!==k&&(c.arrivalDate=k),b.push(c)))}),"ONE_WAY"===g||"ROUND_TRIP"===g?b.slice(0,1):b},e=function(a){var b,c,e,d=a.get("travelerPreferences");return b={adultCount:d.get("numberOfAdults"),seniorCount:d.get("seniorCount"),childCount:d.get("numberOfChildren"),totalPassengers:d.get("totalPassengers"),infantSeatingOnLap:!!d.get("infantsInLap"),childAges:[]},c=d.get("childAges"),b.childCount>0&&c.each(function(a){e=a.get("age"),e!==-1&&b.childAges.push(e)}),b},f=function(a){var b=a.get("travelerPreferences").get("seatingClass");switch(b){case"5":return"premium";case"3":return"economy";case"2":return"business";case"1":return"first";default:return""}},g=function(a){var b=a.get("travelerPreferences");return{flightRouteType:a.get("routeType"),legSearchInfoList:d(a),travelerCategoryInfo:e(a),airlinePreferenceCode:b.get("preferredAirline"),airlineList:b.get("airlines"),flightAirCabinClass:f(a),nonstopOnly:b.get("nonstopOnly"),refundableFlightsOnly:b.get("refundableOnly"),passengerCount:b.get("totalPassengers"),flightPackageType:a.get("packageType"),driverAge:a.get("driverAge")}},h=function(a){var d=g(a),e=b.generateDeeplink(d),f="&origref="+encodeURIComponent(a.get("origRef"));return 1===c.getVariant(12068)&&""!==window.location.hash&&void 0===a.get("changeDepartDate")&&a.get("changeReturnDate")===!0?e+f+window.location.hash:e+f};return{generateUrl:h,buildSearchParameters:g}}),define("FluxSearchDeeplinkGenerator",["underscore"],function(a){"use strict";function b(a){var b=a.airlinePreferenceCode;return""!==b&&b}function c(a){var b=a.flightAirCabinClass;return"COACH"!==b&&b}function d(a){var b=a.nonstopOnly;return!!b&&"0"}function e(a){var b=a.refundableFlightsOnly;return!!b&&"Y"}function f(a){var b=a.travelerCategoryInfo.adultCount;return b}function g(b){var c=b.travelerCategoryInfo.childCount,d=a.filter(b.travelerCategoryInfo.childAges,function(a){return a!==-1}).join(";");return c>0?c+"["+d+"]":c}function h(a){var b=a.travelerCategoryInfo.seniorCount;return b}function i(a){var b=a.travelerCategoryInfo.infantSeatingOnLap;return b?"Y":"N"}var j={FLIGHT_ONLY:"f",FLIGHT_CAR:"fc"},k={"carrier%3A":b,"cabinclass%3A":c,"maxhops%3A":d,"nopenalty%3A":e},l={"adults:":f,"children:":g,"seniors:":h,"infantinlap:":i},m={packageType:j,generateDeeplink:function(b){var c=function(){var c=a.chain(k).map(function(a,c){var d=a(b);return!!d&&c+a(b)}).filter(function(a){return a}).value().join("%2C");return c?"&options="+c:""},d=function(){var c=a.chain(l).map(function(a,c){return c+a(b)}).filter(function(a){return a}).value().join(",");return"&passengers="+c},e=function(){var a=f(),c=b.legSearchInfoList[0];return a+="&leg2=from:"+c.arrivalLocation+",to:"+c.departureLocation+",departure:"+c.arrivalDate+"TANYT"},f=function(){var c="";return a.each(b.legSearchInfoList,function(a,b){c+="&leg"+(b+1)+"=from:"+a.departureLocation+",to:"+a.arrivalLocation+",departure:"+a.departureDate+"TANYT"}),c},g="ROUND_TRIP"===b.flightRouteType?e:f,h=function(){var a=b.flightRouteType;return"trip="+{MULTIPLE_DESTINATION:"multi",ROUND_TRIP:"roundtrip",ONE_WAY:"oneway"}[a]},i=function(){return j.FLIGHT_ONLY===b.flightPackageType?"/Flights-Search?":"/flexibleshopping?packageType="+b.flightPackageType+"&"},m=function(){return j.FLIGHT_ONLY===b.flightPackageType?"":"&shopMode="+b.flightPackageType},n=function(){return b.driverAge?"&driverAge="+b.driverAge:""};return i()+h()+g()+d()+c()+n()+"&mode=search"+m()}};return m}),define("seatAmenitiesView",["flights","jquery","handlebars","backbone","analytics","uitk"],function(a,b,c,d,e,f){"use strict";function g(a,c,d){if(-1!==c.data("tooltip-id").indexOf("amenity-tooltip")){var f="";0!==c.find(".amenity-wifi").length&&(f+=".Wifi"),0!==c.find(".amenity-entertainment").length&&(f+=".Entertainment"),0!==c.find(".amenity-power").length&&(f+=".Power"),e.trackAction("FLT.SR.Listings.Amenities"+f+".Tooltip",b(d.target))}c.uitk_tooltip("show")}function h(a){return 0===a.wifiCount&&0===a.entertainmentCount&&0===a.powerCount}return d.View.extend({initialize:function(a){this.getOfferElement=a&&"function"==typeof a.getOfferElement?a.getOfferElement:void 0,f.subscribe("tooltip.beforeOpen",g),this.templates={seatAmenitiesTooltip:c.templates.SeatAmenitiesTooltip,seatAmenitiesLink:c.templates.SeatAmenitiesLink}},render:function(a){var b=this;a.each(function(a,c){var f,d=b.getAmenitiesElement(a.id),e=a.get("legs").at(0).get("amenities");0===d.length||h(e)||(e.linkMarkup=b.templates.seatAmenitiesLink(e),e.contentId="amenity-content-"+c,e.tooltipId="amenity-tooltip-"+c,f=b.templates.seatAmenitiesTooltip(e),d.parent().removeClass("hide"),d.html(f))})},getAmenitiesElement:function(b){return this.getOfferElement?this.getOfferElement(b).find(".amenity-icons"):void a.log("getOfferElement has not been defined")}})});var TLT=function(){function a(a,b,c,d){var e=null,f=TLT.getService("queue"),g=TLT.getModule("replay"),h=null;b&&"string"==typeof b&&(c&&"string"==typeof c||(c=""),e={type:2,screenview:{type:a,name:b,url:window.location.pathname,referrer:c}},"LOAD"===a&&g&&(h={type:"screenview_load"},g.onevent(h)),"LOAD"!==a&&"UNLOAD"!==a||f.post("",e,"DEFAULT"))}var b=(new Date).getTime(),c={},d={},e=!1,f=null,g=function(){var a=0;return a}(),h=function(){var a=!1;return a}(),i=function(){function c(c){var f,g,d=u.getService("browser"),e=u.getCoreConfig().framesBlacklist;if(a=a||[],c=c||null,"undefined"!=typeof e&&e.length>0){for(g=0;g<e.length;g+=1)f=d.query(e[g],c),f&&a.push(f);b=b.concat(d.queryAll("iframe",c))}}function d(d){return u.utils.indexOf(b,d)<0&&c(d.ownerDocument),u.utils.indexOf(a,d)>-1}var a,b=[];return d.clearCache=function(){a=null},d}(),j=null,k={config:["getConfig","updateConfig","getCoreConfig","updateCoreConfig","getModuleConfig","updateModuleConfig","getServiceConfig","updateServiceConfig"],queue:["post","setAutoFlush","flushAll"],browserBase:["processDOMEvent"]},l=function(){var a={};return{normalizeModuleEvents:function(b,c){var d=!1,e=!1,f=u.getService("browser");return a[b]={loadFired:!1,pageHideFired:!1},u.utils.forEach(c,function(a){switch(a.name){case"load":d=!0,c.push(u.utils.mixin(u.utils.mixin({},a),{name:"pageshow"}));break;case"unload":e=!0,c.push(u.utils.mixin(u.utils.mixin({},a),{name:"pagehide"})),c.push(u.utils.mixin(u.utils.mixin({},a),{name:"beforeunload"}));break;case"change":h&&"W3C"===f.getServiceName()&&c.push(u.utils.mixin(u.utils.mixin({},a),{name:"propertychange"}))}}),d||e?(a[b].silentLoad=!d,a[b].silentUnload=!e,d||c.push({name:"load",target:window.window}),void(e||c.push({name:"unload",target:window.window}))):void delete a[b]},canPublish:function(b,c){var d;if(a.hasOwnProperty(b)===!1)return!0;switch(d=a[b],c.type){case"load":return d.pageHideFired=!1,d.loadFired=!0,!d.silentLoad;case"pageshow":return d.pageHideFired=!1,c.type="load",!d.loadFired&&!d.silentLoad;case"pagehide":return c.type="unload",d.loadFired=!1,d.pageHideFired=!0,!d.silentUnload;case"unload":case"beforeunload":return c.type="unload",d.loadFired=!1,!d.pageHideFired&&!d.silentUnload}return!0},isUnload:function(a){return"object"==typeof a&&("unload"===a.type||"beforeunload"===a.type||"pagehide"===a.type)}}}(),m={},n=function(){},o=null,p=!0,q=null,r=!1,s=!1,t=navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iPod")>-1||navigator.userAgent.indexOf("iPad")>-1,u={getStartTime:function(){return b},init:function(a,b){var c;if(o=b,!p)throw"init must only be called once!";p=!1,c=function(d){d=d||window.event||{},(document.addEventListener||"load"===d.type||"complete"===document.readyState)&&(document.removeEventListener?(document.removeEventListener("DOMContentLoaded",c,!1),window.removeEventListener("load",c,!1)):(document.detachEvent("onreadystatechange",c),window.detachEvent("onload",c)),n(a,b))},"complete"===document.readyState?setTimeout(c):document.addEventListener?(document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1)):(document.attachEvent("onreadystatechange",c),window.attachEvent("onload",c))},isInitialized:function(){return e},getState:function(){return f},destroy:function(a){
var b="",c="",g=null,h=null,j=null,k=null;if(p)return!1;if(this.stopAll(),!a){k=this.getService("browser");for(b in m)m.hasOwnProperty(b)&&null!==k&&(c=b.split("|")[0],g=m[b].target,k.unsubscribe(c,g,this._publishEvent))}for(h in d)d.hasOwnProperty(h)&&(j=d[h].instance,j&&"function"==typeof j.destroy&&j.destroy(),d[h].instance=null);if(i.clearCache(),m={},e=!1,p=!0,f="destroyed","function"==typeof o)try{o("destroyed")}catch(a){}},_updateModules:function(a){var b=this.getCoreConfig(),d=this.getService("browser"),e=null,f=null;if(!(b&&d&&b.modules))return!1;try{for(f in b.modules)b.modules.hasOwnProperty(f)&&(e=b.modules[f],c.hasOwnProperty(f)?(e.enabled===!1?this.stop(f):this.start(f),e.events&&null!==d&&this._registerModuleEvents(f,e.events,a)):d.loadScript&&d.loadScript(b.moduleBase+f+".js"));this._registerModuleEvents.clearCache()}catch(a){return u.destroy(),!1}return!0},rebind:function(a){u._updateModules(a)},getSessionData:function(){var c,d,a=null,b=null,e=u.getCoreConfig();return e&&e.sessionDataEnabled?(b=e.sessionData||{},c=b.sessionQueryName,c?d=u.utils.getQueryStringValue(c,b.sessionQueryDelim):(c=b.sessionCookieName||"TLTSID",d=u.utils.getCookieValue(c)),c&&d&&(a=a||{},a.tltSCN=c,a.tltSCV=d,a.tltSCVNeedsHashing=!!b.sessionValueNeedsHashing),a):null},logCustomEvent:function(a,b){var c=null,d=this.getService("queue");a&&"string"==typeof a||(a="CUSTOM"),b=b||{},c={type:5,customEvent:{name:a,data:b}},d.post("",c,"DEFAULT")},logExceptionEvent:function(a,b,c){var d=null,e=this.getService("queue");a&&"string"==typeof a&&(b=b||"",c=c||"",d={type:6,exception:{description:a,url:b,line:c}},e.post("",d,"DEFAULT"))},logScreenviewLoad:function(b,c,d){a("LOAD",b,c,d)},logScreenviewUnload:function(b){a("UNLOAD",b)},_hasSameOrigin:function(a){try{return a.document.location.host===document.location.host&&a.document.location.protocol===document.location.protocol}catch(a){}return!1},_registerModuleEvents:function(){function b(b,c,d){var e=u.getService("browserBase"),f=u.getService("browser"),g=u.utils.getDocument(d),h=u.utils.isIFrameDescendant(d);d=d||g,l.normalizeModuleEvents(b,c),u.utils.forEach(c,function(c){var i=c.target||g,j="";c.recurseFrames!==!0&&h||("string"==typeof i?u.utils.forEach(f.queryAll(i,d),function(d){var g=a.get(d);g||(g=e.ElementData.prototype.examineID(d),a.set(d,g)),j=c.name+"|"+g.id+g.type,u.utils.indexOf(m[j],b)===-1&&(m[j]=m[j]||[],m[j].push(b),m[j].target=d,f.subscribe(c.name,d,u._publishEvent))}):(j=u._buildToken4bubbleTarget(c.name,i,"undefined"==typeof c.target),m.hasOwnProperty(j)?u.utils.indexOf(m[j],b)===-1&&m[j].push(b):(m[j]=[b],f.subscribe(c.name,i,u._publishEvent))),""!==j&&"string"!=typeof i&&(m[j].target=i))})}function c(a){return a.contentWindow&&u._hasSameOrigin(a.contentWindow)&&a.contentWindow.document&&"complete"===a.contentWindow.document.readyState}function d(d,e,f){if(f=f||u._getLocalTop().document,a=a||new u.utils.WeakMap,b(d,e,f),"performance"!==d){var j,k,g=null,h=f.getElementsByTagName("iframe");for(j=0,k=h.length;j<k;j+=1)g=h[j],i(g)||(c(g)?u._registerModuleEvents(d,e,g.contentWindow.document):!function(a,b,c){var d={moduleName:a,moduleEvents:b,hIFrame:c,_registerModuleEventsDelayed:function(){!i(c)&&u._hasSameOrigin(c.contentWindow)&&u._registerModuleEvents(a,b,c.contentWindow.document)}};u.utils.addEventListener(c,"load",function(){d._registerModuleEventsDelayed()})}(d,e,g))}}var a;return d.clearCache=function(){a&&(a.clear(),a=null)},d}(),_buildToken4currentTarget:function(a){var b=a.nativeEvent.currentTarget,c=this.getService("browserBase").ElementData.prototype.examineID(b);return a.type+"|"+c.id+c.type},_buildToken4bubbleTarget:function(a,b,c){var g,k,d=u._getLocalTop(),e=function(a){var b=null;return u._hasSameOrigin(g.parent)&&u.utils.forEach(g.parent.document.getElementsByTagName("iframe"),function(c){!i(c)&&u._hasSameOrigin(c.contentWindow)&&c.contentWindow.document===a&&(b=c)}),b},f=u.utils.getDocument(b),h=this.getService("browserBase"),j=null,l=a;return f&&(g=f.defaultView||f.parentWindow),b===window||b===window.window?l+="|null-2|window":c&&g&&u._hasSameOrigin(g.parent)&&"undefined"!=typeof f&&d.document!==f?(j=e(f),j&&(k=h.ElementData.prototype.examineID(j),l+="|"+k.xPath+"-2")):l+="|null-2|document",l},_reinitConfig:function(){u._updateModules()},_handleTouchStart:function(a){var b,c;if(t)return!1;if(null===q)return q=a,!0;for(b=0;b<q.nativeEvent.touches.length;b+=1)for(c=0;c<a.nativeEvent.touches.length;c+=1)if(q.nativeEvent.touches[b]===a.nativeEvent.touches[c])return!0;return u._prepNonIosTouchEnd(),q=a,!0},_handleTouchMove:function(a){t||(q=a)},_handleTouchScroll:function(a){return!t&&(null!==q&&"scroll"===a.type&&(q.target.position.x=a.target.position.x,q.target.position.y=a.target.position.y,r=!0),!0)},_prepNonIosTouchEnd:function(){var a=!1;return null!==q&&(q.type="touchend",q.nativeEvent.type="touchend",u._publishEvent(q),r&&(q.type="scroll",q.nativeEvent.type="scroll",s=!0,u._publishEvent(q)),a=!0),q=null,r=!1,s=!1,a},_publishEvent:function(a){var i,k,n,b=null,c=null,d=a.type+"|"+a.target.id+a.target.idType,e=null,o=null,p=!1,v=!1,w=u.getService("browser");if(("load"!==a.type&&"pageshow"!==a.type||a.nativeEvent.customLoad)&&(!t||"touchstart"!==a.type&&"touchmove"!==a.type)){if(null!==q&&"touchstart"!==a.type&&"touchmove"!==a.type&&"scroll"!==a.type&&"touchend"!==a.type)u._prepNonIosTouchEnd();else{if("touchstart"===a.type)return void u._handleTouchStart(a);if("touchmove"===a.type)return void u._handleTouchMove(a);if(null!==q&&"scroll"===a.type&&!s)return void u._handleTouchScroll(a);r&&(d="scroll|null-2|window")}if(!(g>0&&("click"===a.type&&(j=a.target.element),"beforeunload"===a.type&&(p=!1,u.utils.forEach(u.getCoreConfig().ieExcludedLinks,function(a){var b,c,d=w.queryAll(a);for(b=0,c=d?d.length:0;b<c;b+=1)if(void 0!==typeof d[b]&&d[b]===j)return void(p=!0)}),p)))&&(l.isUnload(a)&&(f="unloading"),"change"!==a.type||!h||"W3C"!==w.getServiceName()||"checkbox"!==a.target.element.type&&"radio"!==a.target.element.type)){if("propertychange"===a.type){if("checked"!==a.nativeEvent.propertyName||!("checkbox"===a.target.element.type||"radio"===a.target.element.type&&a.target.element.checked))return;a.type=a.target.type="change"}if(!m.hasOwnProperty(d)&&a.nativeEvent&&a.nativeEvent.currentTarget&&(d=u._buildToken4currentTarget(a)),m.hasOwnProperty(d)||(a.hasOwnProperty("nativeEvent")&&(n=a.nativeEvent.currentTarget||a.nativeEvent.target),d=u._buildToken4bubbleTarget(a.type,n,!0)),m.hasOwnProperty(d))for(e=m[d],i=0,k=e.length;i<k;i+=1)b=e[i],c=u.getModule(b),o=u.utils.mixin({},a),c&&u.isStarted(b)&&"function"==typeof c.onevent&&(v=l.canPublish(b,o),v&&c.onevent(o));o&&"unload"===o.type&&v&&TLT.destroy()}}},_getLocalTop:function(){return window.window},addModule:function(a,b){c[a]={creator:b,instance:null,context:null,messages:[]},this.isInitialized()&&this.start(a)},getModule:function(a){return c[a]&&c[a].instance?c[a].instance:null},removeModule:function(a){this.stop(a),delete c[a]},isStarted:function(a){return c.hasOwnProperty(a)&&null!==c[a].instance},start:function(a){var b=c[a],d=null;b&&null===b.instance&&(b.context=new TLT.ModuleContext(a,this),d=b.instance=b.creator(b.context),"function"==typeof d.init&&d.init())},startAll:function(){var a=null;for(a in c)c.hasOwnProperty(a)&&this.start(a)},stop:function(a){var b=c[a],d=null;b&&null!==b.instance&&(d=b.instance,"function"==typeof d.destroy&&d.destroy(),b.instance=b.context=null)},stopAll:function(){var a=null;for(a in c)c.hasOwnProperty(a)&&this.stop(a)},addService:function(a,b){d[a]={creator:b,instance:null}},getService:function(a){if(d.hasOwnProperty(a)){if(!d[a].instance){try{d[a].instance=d[a].creator(this),"function"==typeof d[a].instance.init&&d[a].instance.init()}catch(a){return null}"function"!=typeof d[a].instance.getServiceName&&(d[a].instance.getServiceName=function(){return a})}return d[a].instance}return null},removeService:function(a){delete d[a]},broadcast:function(a){var e=null,f=null;if(a&&"object"==typeof a)for(e in c)c.hasOwnProperty(e)&&(f=c[e],u.utils.indexOf(f.messages,a.type)>-1&&"function"==typeof f.instance.onmessage&&f.instance.onmessage(a))},listen:function(a,b){var d=null;this.isStarted(a)&&(d=c[a],u.utils.indexOf(d.messages,b)===-1&&d.messages.push(b))},fail:function(a,b,c){a="UIC FAILED. "+a;try{u.destroy(!!c)}finally{throw u.utils.clog(a),new u.UICError(a,b)}},UICError:function(){function a(a,b){this.message=a,this.code=b}return a.prototype=new Error,a.prototype.name="UICError",a.prototype.constructor=a,a}()};return n=function(a,b){var c,d,g,h;if(e)return void u.utils.clog("TLT.init() called more than once. Ignoring.");if(c=u.getService("config"),c.updateConfig(a),!u._updateModules())return void("destroyed"!==f&&u.destroy());if(c.subscribe&&c.subscribe("configupdated",u._reinitConfig),e=!0,f="loaded",d={type:"load",target:window.window,srcElement:window.window,currentTarget:window.window,bubbles:!0,cancelBubble:!1,cancelable:!0,timeStamp:+new Date,customLoad:!0},h=u.getService("browserBase"),g=new h.WebEvent(d),u._publishEvent(g),"function"==typeof o)try{o("initialized")}catch(a){}},function(){var b,c,a=null;for(a in k)if(k.hasOwnProperty(a))for(b=0,c=k[a].length;b<c;b+=1)!function(a,b){u[b]=function(){var c=this.getService(a);if(c)return c[b].apply(c,arguments)}}(a,k[a][b])}(),u}();!function(){var a={indexOf:function(a,b){var c,d;if(a&&a instanceof Array)for(c=0,d=a.length;c<d;c+=1)if(a[c]===b)return c;return-1},forEach:function(a,b,c){var d,e;if(a&&a.length&&b&&b.call)for(d=0,e=a.length;d<e;d+=1)b.call(c,a[d],d,a)},some:function(a,b){var c,d,e=!1;for(c=0,d=a.length;c<d;c+=1)if(e=b(a[c],c,a))return e;return e},convertToArray:function(a){for(var b=0,c=a.length,d=[];b<c;)d.push(a[b]),b+=1;return d},isUndefOrNull:function(a){return"undefined"==typeof a||null===a},mixin:function(a){var b,c,d,e;for(d=1,e=arguments.length;d<e;d+=1){c=arguments[d];for(b in c)Object.prototype.hasOwnProperty.call(c,b)&&(a[b]=c[b])}return a},extend:function(b,c,d){var e="";for(e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b&&"[object Object]"===Object.prototype.toString.call(d[e])?("undefined"==typeof c[e]&&(c[e]={}),a.extend(b,c[e],d[e])):c[e]=d[e]);return c},clone:function(b){var c,d;if(null===b||"object"!=typeof b)return b;if(b instanceof Object){c="[object Array]"===Object.prototype.toString.call(b)?[]:{};for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(c[d]=a.clone(b[d]));return c}},access:function(a,b){var d,e,f,c=b||window;if("string"==typeof a&&("object"==typeof c||null===c)){for(d=a.split("."),e=0,f=d.length;e<f;e+=1)if(0!==e||"window"!==d[e]){if(!Object.prototype.hasOwnProperty.call(c,d[e]))return;if(c=c[d[e]],e<f-1&&!(c instanceof Object))return}return c}},isNumeric:function(a){return!isNaN(a+1-1)},isUpperCase:function(a){return a===a.toUpperCase()&&a!==a.toLowerCase()},isLowerCase:function(a){return a===a.toLowerCase()&&a!==a.toUpperCase()},getDocument:function(b){return 9!==b.nodeType?a.isUndefOrNull(b.ownerDocument)?b.document:b.ownerDocument:b},getWindow:function(b){if(b.self!==b){var c=a.getDocument(b);return a.isUndefOrNull(c.defaultView)?c.parentWindow:c.defaultView}return b},isIFrameDescendant:function(b){return a.getWindow(b)!=TLT._getLocalTop()},getOrientationMode:function(a){var b="INVALID";if("number"!=typeof a)return b;switch(a){case 0:case 180:case 360:b="PORTRAIT";break;case 90:case-90:case 270:b="LANDSCAPE";break;default:b="UNKNOWN"}return b},clog:function(a){return function(){}}(window),trim:function(a){return a&&a.toString?a.toString().replace(/^\s+|\s+$/g,""):a},ltrim:function(a){return a&&a.toString?a.toString().replace(/^\s+/,""):a},rtrim:function(a){return a&&a.toString?a.toString().replace(/\s+$/,""):a},getCookieValue:function(b,c){var d,e,f,g,i,h=null;try{if(c=c||document.cookie,!b||!b.toString)return null;for(b+="=",i=b.length,g=c.split(";"),d=0,e=g.length;d<e;d+=1)if(f=g[d],f=a.ltrim(f),0===f.indexOf(b)){h=f.substring(i,f.length);break}}catch(a){}return h},getQueryStringValue:function(a,b,c){var d,e,f,h,g=null;try{if(c=c||window.location.search,f=c.length,!a||!a.toString||!f)return null;b=b||"&",c=b+c.substring(1),a=b+a+"=",d=c.indexOf(a),d!==-1&&(h=d+a.length,e=c.indexOf(b,h),e===-1&&(e=f),g=decodeURIComponent(c.substring(h,e)))}catch(a){}return g},addEventListener:function(){return window.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:function(a,b,c){a.attachEvent("on"+b,c)}}(),WeakMap:function(){function a(a,b){var c,d;for(a=a||[],c=0,d=a.length;c<d;c+=1)if(a[c][0]===b)return c;return-1}return function(){var b=[];this.set=function(c,d){var e=a(b,c);b[e>-1?e:b.length]=[c,d]},this.get=function(c){var d=b[a(b,c)];return d?d[1]:void 0},this.clear=function(){b=[]},this.has=function(c){return a(b,c)>=0},this.remove=function(c){var d=a(b,c);d>=0&&b.splice(d,1)},this.delete=this.remove}}()};"undefined"!=typeof TLT&&TLT||(window.TLT={}),TLT.utils=a}(),function(){TLT.EventTarget=function(){this._handlers={}},TLT.EventTarget.prototype={constructor:TLT.EventTarget,publish:function(a,b){var c=0,d=0,e=this._handlers[a],f={type:a,data:b};if("undefined"!=typeof e)for(d=e.length;c<d;c+=1)e[c](f)},subscribe:function(a,b){this._handlers.hasOwnProperty(a)||(this._handlers[a]=[]),this._handlers[a].push(b)},unsubscribe:function(a,b){var c=0,d=0,e=this._handlers[a];if(e)for(d=e.length;c<d;c+=1)if(e[c]===b)return void e.splice(c,1)}}}(),TLT.ModuleContext=function(){var a=["broadcast","getConfig:getModuleConfig","listen","post","getStartTime"];return function(b,c){var d={},e=0,f=a.length,g=null,h=null,i=null;for(e=0;e<f;e+=1)g=a[e].split(":"),g.length>1?(i=g[0],h=g[1]):(i=g[0],h=g[0]),d[i]=function(a){return function(){var d=c.utils.convertToArray(arguments);return d.unshift(b),c[a].apply(c,d)}}(h);return d.utils=c.utils,d}}(),TLT.addService("config",function(a){function b(b,c){a.utils.extend(!0,b,c),e.publish("configupdated",e.getConfig())}var c={core:{},modules:{},services:{}},d=function(){var a=null,b=null;return"function"==typeof Object.create?a=Object.create:(b=function(){},a=function(a){if("object"!=typeof a&&"function"!=typeof a)throw new TypeError("Object prototype need to be an object!");return b.prototype=a,new b}),a}(),e=a.utils.extend(!1,d(new TLT.EventTarget),{getConfig:function(){return c},updateConfig:function(a){b(c,a)},getCoreConfig:function(){return c.core},updateCoreConfig:function(a){b(c.core,a)},getServiceConfig:function(a){return c.services[a]||null},updateServiceConfig:function(a,d){"undefined"==typeof c.services[a]&&(c.services[a]={}),b(c.services[a],d)},getModuleConfig:function(a){return c.modules[a]||null},updateModuleConfig:function(a,d){"undefined"==typeof c.modules[a]&&(c.modules[a]={}),b(c.modules[a],d)},destroy:function(){c={core:{},modules:{},services:{}}}});return e}),TLT.addService("queue",function(a){function l(){}function m(){return window.location.pathname}function n(a,c){var f=b.flush(a),h=null!==f?f.length:0,i=b.get(a),j={"Content-Type":"application/json","X-Tealeaf":"device (UIC) Lib/2.1.0.856","X-TealeafType":"GUI","X-TeaLeaf-Page-Url":m()},k=i.serializer||"json";f=g.wrapMessages(f),h&&d.sendRequest({oncomplete:l,url:i.url,async:!c,headers:j,data:e.serialize(f,k)})}function o(a){var b=null,d=0;for(d=0;d<c.length;d+=1)b=c[d],n(b.qid,a);return!0}function p(c,d){var e=b.push(c,g.createMessage(d));e>=b.get(c).threshold&&j&&"unloading"!==a.getState()&&n(c)}function q(a){var b=null,d="",e=0,f=0;for(e=0;e<c.length;e+=1)if(b=c[e],b&&b.modules)for(f=0;f<b.modules.length;f+=1)if(d=b.modules[f],d===a)return b.qid;return h.qid}function r(a,b){i[a]=window.setTimeout(function c(){n(a),i[a]=window.setTimeout(c,b)},b)}function s(a){}function t(a){c=a;var e,d=null;for(e in c)c.hasOwnProperty(e)&&(d=c[e],"DEFAULT"===d.qid&&(h=d),b.add(d.qid,{url:d.endpoint,threshold:d.maxEvents,serializer:d.serializer,timerInterval:d.timerInterval||0}),"undefined"!=typeof d.timerInterval&&d.timerInterval>0&&r(d.qid,d.timerInterval));f.subscribe("configupdated",s),k=!0}function u(){j&&o(!0),f.unsubscribe("configupdated",s),c=null,h=null,k=!1}var b=function(){function b(b){return"undefined"!=typeof a[b]}function c(c,d){return b(c)||(a[c]={data:[],queueId:c,url:d.url,threshold:d.threshold,serializer:d.serializer}),a[c]}function d(c){b(c)&&delete a[c]}function e(c){return b(c)?a[c]:null}function f(a){var b=e(a);null!==b&&(b.data=[])}function g(a){var c=null;return b(a)&&(c=e(a).data,f(a)),c}function h(a,c){var d=null,f=null,g=window.tlBridge,h=window.iOSJSONShuttle;if("undefined"!=typeof g&&"function"==typeof g.addMessage)f=JSON.stringify(c),g.addMessage(f);else if("undefined"!=typeof h&&"function"==typeof h)f=JSON.stringify(c),h(f);else if(b(a))return d=e(a),d.data.push(c);return 0}var a={};return{SEND_HEADER_ONCE:-1,SEND_HEADER_ALWAYS:-2,exists:b,add:c,remove:d,get:e,clear:f,flush:g,push:h}}(),c=null,d=a.getService("browser"),e=a.getService("serializer"),f=a.getService("config"),g=a.getService("message"),h=null,i={},j=!0,k=!1;return{init:function(){k||t(f.getServiceConfig("queue")||{})},destroy:function(){u()},_getQueue:function(a){return b.get(a).data},setAutoFlush:function(a){j=1===a},flush:function(a){if(!b.exists(a))throw new Error("Queue: "+a+" does not exist!");n(a)},flushAll:function(a){return o(!!a)},post:function(a,c,d){if(d=d||q(a),!b.exists(d))throw new Error("Queue: "+d+" does not exist!");p(d,c)}}}),TLT.addService("browserBase",function(a){function k(){d=a.getService("config"),e=a.getService("serializer"),f=a.getService("config").getServiceConfig("browser")||{},g=f.hasOwnProperty("blacklist")?f.blacklist:[],h=f.hasOwnProperty("customid")?f.customid:[]}function l(){k(),d.subscribe("configupdated",k),j=!0}function m(){d.unsubscribe("configupdated",k),j=!1}function n(a){var b,c,d;if(!a||!a.id||"string"!=typeof a.id)return!1;for(b=0,c=g.length;b<c;b+=1)if("string"==typeof g[b]){if(a.id===g[b])return!1}else if("object"==typeof g[b]&&(d=new RegExp(g[b].regex,g[b].flags),d.test(a.id)))return!1;return!0}function o(a){a=a.split("\n");var b={},c=0,d=a.length,e=null;for(c=0;c<d;c+=2)e=a[c].split(": "),b[e[0]]=e[1];return b}function p(a){return a&&"undefined"!=typeof a.originalEvent&&"undefined"!=typeof a.isDefaultPrevented&&!a.isSimulated}function q(a){return a?(a.type&&0===a.type.indexOf("touch")&&(p(a)&&(a=a.originalEvent),"touchstart"===a.type?a=a.touches[a.touches.length-1]:"touchend"===a.type&&(a=a.changedTouches[0])),a):null}function r(a){var b=a||window.event,c=document.documentElement,d=document.body;return p(b)&&(b=b.originalEvent),"undefined"!=typeof a&&"undefined"!=typeof b.target||(b.target=b.srcElement||window.window,b.timeStamp=Number(new Date),null!==b.pageX&&"undefined"!=typeof b.pageX||(b.pageX=b.clientX+(c&&c.scrollLeft||d&&d.scrollLeft||0)-(c&&c.clientLeft||d&&d.clientLeft||0),b.pageY=b.clientY+(c&&c.scrollTop||d&&d.scrollTop||0)-(c&&c.clientTop||d&&d.clientTop||0)),b.preventDefault=function(){this.returnValue=!1},b.stopPropagation=function(){this.cancelBubble=!0}),b}function s(a){var c=null;if(!a)return null;for(a.srcElement?c=a.srcElement:(c=a.target,c||(c=a.explicitOriginalTarget),c||(c=a.originalTarget)),c||0!==a.type.indexOf("touch")||(c=q(a).target);c&&b[c.tagName];)c=c.parentNode;return c||null!==a.srcElement||(c=window.window),c}function t(a){var b=0,c=0,d=document.documentElement,e=document.body;return a=q(a),null!==a&&(a.pageX&&a.pageY&&a.pageX>0&&a.pageY>0?(b=a.pageX,c=a.pageY):a.clientX&&a.clientY&&(b=a.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),c=a.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0))),{x:b,y:c}}function u(a,b){this.x=a||0,this.y=b||0}function v(a,b){this.width=a||0,this.height=b||0}function w(a,b){var c,d,e;b=s(a),c=this.examineID(b),d=this.examineType(b,a),e=this.examinePosition(a,b),this.element=b,this.id=c.id,this.idType=c.type,this.type=d.type,this.subType=d.subType,this.state=this.examineState(b),this.position=new u(e.x,e.y),this.size=new v(e.width,e.height),this.xPath=c.xPath,this.name=c.name}function y(b){var c,d;if("undefined"==typeof b||null===b||!b.getBoundingClientRect)return{x:0,y:0,width:0,height:0};try{c=b.getBoundingClientRect()}catch(b){return a.utils.clog("getBoundingClientRect failed.",b),{x:0,y:0,width:0,height:0}}return d={x:c.left,y:c.top,width:c.right-c.left,height:c.bottom-c.top}}function z(a){var b;a=r(a),b=t(a),this.custom=!1,this.nativeEvent=this.custom===!0?null:a,this.position=new u(b.x,b.y),this.target=new w(a,a.target),this.timestamp=(new Date).getTime(),this.type=a.type}function A(b){a._publishEvent(new z(b))}var e,f,g,h,i,b={OPTGROUP:!0,OPTION:!0,NOBR:!0},c={},d=a.getService("config"),j=!1;return i=function(){function c(c){for(var d,e,f=!1,g=null,h=null,i=null,j=[],k=!0;k;)if(k=!1,!a.utils.isUndefOrNull(c)){if(!a.utils.isUndefOrNull(c.tagName))for(d in b)b.hasOwnProperty(d)&&c.tagName.toString()===d&&(c=c.parentNode);for(f=n(c);c!==document&&!f;f=n(c)){if(i=c.parentNode,i||(h=a.utils.getWindow(c),i=h!==a._getLocalTop()?h.frameElement:document),g=i.childNodes,!g)return j;for(d=0,e=0;d<g.length;d+=1)if(1===g[d].nodeType&&g[d].tagName===c.tagName){if(g[d]===c){j[j.length]=[c.tagName.toUpperCase(),e];break}e+=1}c=i}f&&(j[j.length]=[c.id],a.utils.isIFrameDescendant(c)&&(k=!0,c=a.utils.getWindow(c).frameElement))}return j}var b={NOBR:!0,P:!0};return function(b){var d=c(b),f=[],g=d.length;if(g<1)return"null";for(;g;)g-=1,d[g].length>1?f.push('["'+d[g][0]+'",'+d[g][1]+"]"):f.push("["+e.serialize(d[g][0],"json")+"]");return"["+f.join(",")+"]"}}(),c.xpath=function(a,b){var d,g,h,i,j,k,c=e.parse(a),f=null;if(b="undefined"!=typeof b?b:document,d=b,!c)return null;for(g=0,j=c.length;g<j&&d;g+=1)if(f=c[g],1===f.length)d=b.getElementById(f[0]);else{for(h=0,i=-1,k=d.childNodes.length;h<k;h+=1)if(1===d.childNodes[h].nodeType&&d.childNodes[h].tagName.toUpperCase()===f[0]&&(i+=1,i===f[1])){d=d.childNodes[h];break}if(i===-1)return null}return d!==b&&d?d:null},w.HTML_ID=-1,w.XPATH_ID=-2,w.ATTRIBUTE_ID=-3,w.prototype.examineID=function(b){var c,d,e,g,k,j=h.length;try{e=i(b)}catch(a){}g=b.name;try{if(!a.utils.isIFrameDescendant(b))if(n(b))c=b.id,d=w.HTML_ID;else if(h.length&&b.attributes)for(;j;)j-=1,k=b.attributes[h[j]],"undefined"!=typeof k&&(c=h[j]+"="+(k.value||k),d=w.ATTRIBUTE_ID)}catch(a){}return c||(c=e,d=w.XPATH_ID),{id:c,type:d,xPath:e,name:g}},w.prototype.examineType=function(a,b){var c="";return c="change"===b.type?"TEXTAREA"===a.tagName||"INPUT"===a.tagName&&"text"===a.type?"textChange":"valueChange":b.type,{type:b.type,subType:c}},w.prototype.examineState=function(a){var b={a:["innerText","href"],input:{range:["maxValue:max","value"],checkbox:["value","checked"],radio:["value","checked"],image:["src"]},select:["value"],button:["value","innerText"],textarea:["value"]},c="undefined"!=typeof a.tagName?a.tagName.toLowerCase():"",d=b[c]||null,e=null,f=null,i=null,j="";if(null!==d){"[object Object]"===Object.prototype.toString.call(d)&&(d=d[a.type]||["value"]),f={};for(j in d)d.hasOwnProperty(j)&&(d[j].indexOf(":")!==-1?(i=d[j].split(":"),f[i[0]]=a[i[1]]):"innerText"===d[j]?f[d[j]]=a.innerText||a.textContent:f[d[j]]=a[d[j]])}return"select"===c&&a.options&&!isNaN(a.selectedIndex)&&(f.index=a.selectedIndex,f.index>=0&&f.index<a.options.length&&(e=a.options[a.selectedIndex],f.value=e.getAttribute("value")||e.getAttribute("label")||e.text||e.innerText,f.text=e.text||e.innerText)),f},w.prototype.examinePosition=function(a,b){var c=t(a),d=y(b);return d.x=0!==c.x&&0!==c.y?Math.round(Math.abs(c.x-d.x)):d.width/2,d.y=0!==c.x&&0!==c.y?Math.round(Math.abs(c.y-d.y)):d.height/2,d},{init:function(){j||l()},destroy:function(){m()},extractResponseHeaders:o,WebEvent:z,ElementData:w,processDOMEvent:A,queryDom:c}}),TLT.addService("browser",function(core){function initBrowserServiceW3C(){if(queryDom.xpath=browserBaseService.queryDom.xpath,getXHRObject="undefined"!=typeof window.XMLHttpRequest?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")},"function"==typeof document.addEventListener)addEventListener=function(a,b,c){a.addEventListener(b,c,useCapture)},removeEventListener=function(a,b,c){a.removeEventListener(b,c,useCapture)};else{if("undefined"==typeof document.attachEvent)throw new Error("Unsupported browser");addEventListener=function(a,b,c){a.attachEvent("on"+b,c)},removeEventListener=function(a,b,c){a.detachEvent("on"+b,c)}}isInitialized=!0}var configService=core.getService("config"),browserBaseService=core.getService("browserBase"),getXHRObject=null,addEventListener=null,removeEventListener=null,makeAjaxCall=null,serviceConfig=configService.getServiceConfig("browser")||{},useCapture=serviceConfig.useCapture===!0,isInitialized=!1,errorCodes={NO_QUERY_SELECTOR:"NOQUERYSELECTOR"},wrapWebEvent=function(a){return function(b){a(new browserBaseService.WebEvent(b))}},loadScript=function(a){var b=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=a,b.parentNode.insertBefore(c,b)},queryDom={list2Array:function(a){var d,b=a.length,c=[];if("undefined"==typeof a.length)return[a];for(d=0;d<b;d+=1)c[d]=a[d];return c},find:function(a,b,c){return c=c||"css",this.list2Array(this[c](a,b))},css:function(query,scope){var self=this,message=null,bodyEl=document.getElementsByTagName("body")[0],bConfig=configService.getServiceConfig("browser")||{},sizzleURL=bConfig.sizzleURL||null,jQuery=bConfig.hasOwnProperty("jQueryObject")?core.utils.access(bConfig.jQueryObject):window.jQuery,sizzle=bConfig.hasOwnProperty("sizzleObject")?core.utils.access(bConfig.sizzleObject):window.Sizzle;if("undefined"==typeof document.querySelectorAll){if(self.css=function(a,b){return b=b||document,self.Sizzle(a,b)},"undefined"==typeof self.Sizzle)if(sizzleURL)message={type:"GET",url:sizzleURL,async:!1,oncomplete:function(result){function define(a){self.Sizzle=a()}define.amd=!0,eval(result.responseText)}},makeAjaxCall(message);else try{bodyEl===sizzle("html > body",document)[0]&&(self.Sizzle=sizzle)}catch(a){try{bodyEl===jQuery(document).find("html > body").get()[0]&&(self.Sizzle=function(a,b){return jQuery(b).find(a).get()})}catch(a){core.fail("Sizzle was not found",errorCodes.NO_QUERY_SELECTOR)}}}else self.css=function(a,b){return b=b||document,b.querySelectorAll(a)};return self.css(query,scope)}},handlerMappings=function(){var a=new core.utils.WeakMap;return{add:function(b){var c=a.get(b)||[wrapWebEvent(b),0];return c[1]+=1,a.set(b,c),c[0]},find:function(b){var c=a.get(b);return c?c[0]:null},remove:function(b){var c=a.get(b);c&&(c[1]-=1,c[1]<=0&&a.remove(b))}}}(),convertHeaders=function(a){var b="",c=[];for(b in a)a.hasOwnProperty(b)&&c.push([b,a[b]]);return c};return makeAjaxCall=function(a){var b=getXHRObject(),c=[["X-Requested-With","XMLHttpRequest"]],d=0,e="boolean"!=typeof a.async||a.async,g=null;a.headers&&(c=c.concat(convertHeaders(a.headers))),a.contentType&&c.push(["Content-Type",a.contentType]),b.open(a.type.toUpperCase(),a.url,e),core.utils.forEach(c,function(a){a[0]&&a[1]&&b.setRequestHeader(a[0],a[1])}),b.onreadystatechange=g=function(){4===b.readyState&&(b.onreadystatechange=g=function(){},a.timeout&&window.clearTimeout(d),a.oncomplete({headers:browserBaseService.extractResponseHeaders(b.getAllResponseHeaders()),responseText:b.responseText||null,statusCode:b.status,success:200===b.status}),b=null)},b.send(a.data||null),g(),a.timeout&&(d=window.setTimeout(function(){b&&(b.onreadystatechange=function(){},4!==b.readyState&&b.abort(),b=null)},a.timeout))},{init:function(){isInitialized||initBrowserServiceW3C()},destroy:function(){isInitialized=!1},getServiceName:function(){return"W3C"},query:function(a,b,c){return queryDom.find(a,b,c)[0]||null},queryAll:function(a,b,c){return queryDom.find(a,b,c)},loadScript:function(a){loadScript(a)},sendRequest:function(a){a.type=a.type||"POST",makeAjaxCall(a)},subscribe:function(a,b,c){var d=handlerMappings.add(c);addEventListener(b,a,d)},unsubscribe:function(a,b,c){var d=handlerMappings.find(c);d&&(removeEventListener(b,a,d),handlerMappings.remove(c))}}}),TLT.addService("message",function(a){function B(a){var c="";this.type=a.type,this.offset=(new Date).getTime()-e.getTime(),2!==a.type&&null!==b||(b=new Date),this.screenviewOffset=(new Date).getTime()-b.getTime(),this.count=d+=1,this.fromWeb=!0;for(c in a)a.hasOwnProperty(c)&&(this[c]=a[c])}function C(a,b){var c=o.PVC_MASK_BASIC;a.maskType===o.PVC_MASK_EMPTY.maskType?c=o.PVC_MASK_EMPTY:a.maskType===o.PVC_MASK_BASIC.maskType?c=o.PVC_MASK_BASIC:a.maskType===o.PVC_MASK_TYPE.maskType?c=o.PVC_MASK_TYPE:a.maskType===o.PVC_MASK_CUSTOM.maskType&&(c=a.maskFunction),"undefined"!=typeof b.target.prevState&&b.target.prevState.hasOwnProperty("value")&&(b.target.prevState.value=c(b.target.prevState.value)),"undefined"!=typeof b.target.currState&&b.target.currState.hasOwnProperty("value")&&(b.target.currState.value=c(b.target.currState.value))}function D(a,b){var c,d,e,f,i,j,k,l;for(c=0,k=a.length;c<k;c+=1)if(l=a[c],"string"==typeof l){for(e=h.queryAll(l),d=0,f=e?e.length:0;d<f;d+=1)if(e[d]&&(i=g.ElementData.prototype.examineID(e[d]),i.type===b.idType&&i.id===b.id))return!0}else if(l.id&&l.idType&&b.idType.toString()===l.idType.toString())switch(typeof l.id){case"string":if(l.id===b.id)return!0;break;case"object":if(j=new RegExp(l.id.regex,l.id.flags),j.test(b.id))return!0}return!1}function E(a){var b,c,d;if(!a||!a.hasOwnProperty("target"))return a;for(b=0,c=n.length;b<c;b+=1)if(d=n[b],D(d.targets,a.target)){C(d,a);break}return a}function F(){i=a.getService("config"),j=i.getServiceConfig("message")||{},n=j.hasOwnProperty("privacy")?j.privacy:[]}function G(){i.subscribe&&i.subscribe("configupdated",F),A=!0}function H(){i.unsubscribe("configupdated",F),A=!1}var b=null,c=0,d=0,e=new Date,f=new Date,g=a.getService("browserBase"),h=a.getService("browser"),i=a.getService("config"),j=i.getServiceConfig("message")||{},k=window.location.href,l="TODO",m="ID"+f.getHours()+"H"+f.getMinutes()+"M"+f.getSeconds()+"S"+f.getMilliseconds()+"R"+Math.random(),n=j.hasOwnProperty("privacy")?j.privacy:[],o={},p={lower:"x",upper:"X",numeric:"9",symbol:"@"},q=navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iPod")>-1||navigator.userAgent.indexOf("iPad")>-1,r=window.devicePixelRatio||1,s=window.screen?window.screen.width:0,t=window.screen?window.screen.height:0,u=window.orientation||0,v=q?s:s<=320?s:s/r,w=q?t:s<=320?t:t/r,x=null===window.screen?0:window.screen.height-window.screen.availHeight,y=window.innerWidth||document.documentElement.clientWidth,z=window.innerHeight||document.documentElement.clientHeight,A=!1;return o.PVC_MASK_EMPTY=function(a){return""},o.PVC_MASK_BASIC=function(a){var b="XXXXX";return"string"!=typeof a?"":a.length?b:""},o.PVC_MASK_TYPE=function(b){var c,d=0,e=0,f="";if("string"!=typeof b)return f;for(c=b.split(""),d=0,e=c.length;d<e;d+=1)f+=a.utils.isNumeric(c[d])?p.numeric:a.utils.isUpperCase(c[d])?p.upper:a.utils.isLowerCase(c[d])?p.lower:p.symbol;return f},o.PVC_MASK_EMPTY.maskType=1,o.PVC_MASK_BASIC.maskType=2,o.PVC_MASK_TYPE.maskType=3,o.PVC_MASK_CUSTOM={maskType:4},{init:function(){A||G()},destroy:function(){H()},createMessage:function(a){if("undefined"==typeof a.type)throw new TypeError("Invalid queueEvent given!");return E(new B(a))},wrapMessages:function(b){var d={messageVersion:"2.1.0.0",serialNumber:c+=1,sessions:[{id:m,startTime:f.getTime(),timezoneOffset:f.getTimezoneOffset(),messages:b,clientEnvironment:{webEnvironment:{libVersion:"2.1.0.856",page:k,windowId:l,screen:{devicePixelRatio:r,deviceOriginalWidth:q?s*r:s,deviceOriginalHeight:q?t*r:t,deviceWidth:v,deviceHeight:w,deviceToolbarHeight:x,width:y,height:z,orientation:u}}}}]},e=d.sessions[0].clientEnvironment.webEnvironment.screen;return e.orientationMode=a.utils.getOrientationMode(e.orientation),d}}}),TLT.addService("serializer",function(core){function serializeToJSON(a){var b,c,d=0;if("object"!=typeof a||null===a)switch(typeof a){case"function":case"undefined":return"null";case"string":return'"'+a.replace(/\"/g,'\\"')+'"';default:return String(a)}else if("[object Array]"===Object.prototype.toString.call(a))for(b="[",
c=0,d=a.length;c<d;c+=1)Object.prototype.hasOwnProperty.call(a,c)&&(b+=serializeToJSON(a[c])+",");else{b="{";for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b=b.concat('"',c,'":',serializeToJSON(a[c]),","),d+=1)}return d>0&&(b=b.substring(0,b.length-1)),b+=String.fromCharCode(b.charCodeAt(0)+2)}function addObjectIfExist(a,b,c){var d,e,f;for(a=a||[],d=0,e=a.length;d<e;d+=1)if(f=a[d],"string"==typeof f&&(f=core.utils.access(f)),"function"==typeof f){b[c]=f;break}}function initSerializerService(a){var b;for(b in a)a.hasOwnProperty(b)&&(addObjectIfExist(a[b].stringifiers,serialize,b),addObjectIfExist(a[b].parsers,parse,b));a.json&&a.json.hasOwnProperty("defaultToBuiltin")&&a.json.defaultToBuiltin!==!0||(serialize.json=serialize.json||defaultSerializers.json.serialize,parse.json=parse.json||defaultSerializers.json.parse),"function"==typeof serialize.json&&"function"==typeof parse.json||core.fail("JSON parser and/or serializer not provided in the UIC config. Can't continue."),configService.subscribe&&configService.subscribe("configupdated",updateConfig),isInitialized=!0}function destroy(){serialize={},parse={},configService.unsubscribe("configupdated",updateConfig),isInitialized=!1}function updateConfig(){configService=core.getService("config"),initSerializerService(configService.getServiceConfig("serializer")||{})}var configService=core.getService("config"),serialize={},parse={},defaultSerializers={json:function(){return"undefined"!=typeof window.JSON?{serialize:window.JSON.stringify,parse:window.JSON.parse}:{serialize:serializeToJSON,parse:function(data){return eval("("+data+")")}}}()},isInitialized=!1;return{init:function(){isInitialized||initSerializerService(configService.getServiceConfig("serializer")||{})},destroy:function(){destroy()},parse:function(a,b){return b=b||"json",parse[b](a)},serialize:function(a,b){return b=b||"json",serialize[b](a)}}}),TLT&&"function"==typeof TLT.addModule&&TLT.addModule("performance",function(a){function d(a,b){return"string"==typeof a&&(!(!b||"object"!=typeof b)&&b[a]===!0)}function e(a,b){var c=0,e={},f="",g=0;if(!a||"object"!=typeof a||!a.navigationStart)return{};c=a.navigationStart;for(f in a)(Object.prototype.hasOwnProperty.call(a,f)||"number"==typeof a[f])&&(d(f,b)||(g=a[f],"number"==typeof g&&g?e[f]=g-c:e[f]=g));return e}function f(b){var d,e,c=0,f=a.utils;return b&&(d=b.responseEnd,e=b.loadEventStart,f.isNumeric(d)&&f.isNumeric(e)&&e>d&&(c=e-d)),c}function g(b){var d=a.getStartTime();b.timestamp>d&&!c&&(c=b.timestamp-d)}function h(d){var j,k,l,g=a.getConfig()||{},h="UNKNOWN",i={type:7,performance:{}};if(d&&!b.perfEventSent){if(k=d.performance||{},l=k.timing,j=k.navigation,l?(i.performance.timing=e(l,g.filter),i.performance.timing.renderTime=f(l)):g.calculateRenderTime&&(i.performance.timing={renderTime:c,calculated:!0}),j){switch(j.type){case 0:h="NAVIGATE";break;case 1:h="RELOAD";break;case 2:h="BACKFORWARD";break;default:h="UNKNOWN"}i.performance.navigation={type:h,redirectCount:j.redirectCount}}a.post(i),b.perfEventSent=!0}}var b={loadReceived:!1,unloadReceived:!1,perfEventSent:!1},c=0;return{init:function(){},destroy:function(){},onevent:function(a){if("object"==typeof a&&a.type)switch(a.type){case"load":b.loadReceived=!0,g(a);break;case"unload":b.unloadReceived=!0,b.perfEventSent||h(window)}},onmessage:function(a){}}}),TLT.addModule("replay",function(a){function F(a,b){var c,d;if(!a||"object"!=typeof a)return null;for(d=b.split("."),c=0;c<d.length;c+=1){if("undefined"==typeof a||null===a[d[c]])return null;a=a[d[c]]}return a}function G(a){var b=[];for(a=a.parentNode;a;)b.push(a),a=a.parentNode;return b}function H(b){return a.utils.some(b,function(a){return"A"===a.tagName||"BUTTON"===a.tagName?a:null})}function I(a){var b=a.type;return b="string"==typeof b?b.toLowerCase():"unknown","blur"===b&&(b="focusout"),b}function J(a){var c,d=F(a,"webEvent.target.element.tagName"),e="input"===d.toLowerCase()?F(a,"webEvent.target.element.type"):"",f=b[d.toLowerCase()+":"+e]||d,g=G(F(a,"webEvent.target.element")),h=null,i=F(a,"webEvent.target.position.relXY"),j=F(a,"webEvent.target.subtype");return c={type:4,target:{id:a.id||"",idType:F(a,"webEvent.target.idType"),name:F(a,"webEvent.target.name"),tlType:f,type:d,subType:e,position:{width:F(a,"webEvent.target.element.offsetWidth"),height:F(a,"webEvent.target.element.offsetHeight")},currState:a.currState||null},event:{tlEvent:I(F(a,"webEvent")),type:F(a,"webEvent.target.type")}},i&&(c.target.position.relXY=i),"number"==typeof a.dwell&&a.dwell>0&&(c.target.dwell=a.dwell),"number"==typeof a.visitedCount&&(c.target.visitedCount=a.visitedCount),"undefined"!=typeof a.prevState&&(c.prevState=a.prevState),"undefined"!=typeof j&&(c.event.subType=j),c.target.name=F(a,"webEvent.target.name"),h=H(g),c.target.isParentLink=!!h,h&&(h.href&&(c.target.currState=c.target.currState||{},c.target.currState.href=c.target.currState.href||h.href),h.value&&(c.target.currState=c.target.currState||{},c.target.currState.value=c.target.currState.value||h.value),(h.innerText||h.textContent)&&(c.target.currState=c.target.currState||{},c.target.currState.innerText=c.target.currState.innerText||h.innerText||h.textContent)),c}function K(b){a.post(b)}function L(b){var d,f,g,h,c=0,e=b.length,i={mouseout:!0,mouseover:!0},j=[];for(c=0;c<e;c+=1)if(f=b[c])if(i[f.event.type])j.push(f);else{for(d=c+1;d<e&&b[d]&&i[b[d].event.type];d+=1);d<e&&(g=b[d],g&&f.target.id===g.target.id&&f.event.type!==g.event.type&&("click"===f.event.type&&(h=f,f=g,g=h),"click"===g.event.type?(f.target.position=g.target.position,c+=1):"blur"===g.event.type&&(f.target.dwell=g.target.dwell,f.target.visitedCount=g.target.visitedCount,f.focusInOffset=g.focusInOffset,f.target.position=g.target.position,c+=1),b[d]=null,b[c]=f)),j.push(b[c])}for(;f=j.shift();)a.post(f);b.splice(0,b.length)}function M(a,b){w=b,w.inFocus=!0,"undefined"==typeof e[a]&&(e[a]={}),e[a].focus=w.dwellStart=Number(new Date),e[a].focusInOffset=s?w.dwellStart-Number(s):-1,e[a].prevState=F(b,"target.state"),e[a].visitedCount=e[a].visitedCount+1||1}function N(a,b){h.push(J({webEvent:a,id:b,currState:F(a,"target.state")}))}function O(a){var b=!1,c="|button|image|submit|reset|checkbox|radio|",d=null;if("object"!=typeof a||!a.type)return b;switch(a.type){case"INPUT":d="|"+(a.subType||"")+"|",b=c.indexOf(d.toLowerCase())!==-1;break;case"TEXTAREA":b=!1;break;default:b=!0}return b}function P(a,b){var c;"undefined"!=typeof a&&null!==a&&"undefined"!=typeof b&&null!==b&&(w.inFocus=!1,"undefined"!=typeof e[a]&&e[a].hasOwnProperty("focus")?e[a].dwell=Number(new Date)-e[a].focus:(e[a]={},e[a].dwell=0),0===h.length&&(b.type=b.target.type="blur",N(b,a)),c=h[h.length-1],c&&(c.target.dwell=e[a].dwell,c.focusInOffset=e[a].focusInOffset,c.target.visitedCount=e[a].visitedCount,"click"!==c.event.type||O(c.target)||(c.event.type="blur",c.event.tlEvent="focusout")),L(h))}function Q(a,b){var c=!1;return h[h.length-1]&&h[h.length-1].target.id!==a&&"scroll"!==b.type&&"resize"!==b.type&&"mouseout"!==b.type&&"mouseover"!==b.type&&"textBox"!==h[h.length-1].target.tlType&&"selectList"!==h[h.length-1].target.tlType&&(P(h[h.length-1].target.id,h[h.length-1]),c=!0),c}function R(a,b){"undefined"==typeof e[a]||e[a].hasOwnProperty("focus")||M(a,b),N(b,a),"undefined"!=typeof e[a]&&"undefined"!=typeof e[a].prevState&&("textBox"!==h[h.length-1].target.tlType&&"selectList"!==h[h.length-1].target.tlType||(h[h.length-1].target.prevState=e[a].prevState))}function S(a){var b=a.target.position.x,c=a.target.position.y,d=a.target.size.width,e=a.target.size.height,f=Math.abs(b/d).toFixed(1),g=Math.abs(c/e).toFixed(1);return f=f>1||f<0?.5:f,g=g>1||g<0?.5:g,f+","+g}function T(a,b){var c,d=!0,e=0;return"SELECT"===b.target.element.tagName&&x&&x.target.id===a?void(x=null):(w.inFocus||M(a,b),e=h.length,e&&"change"!==F(h[e-1],"event.type")&&R(a,b),c=S(b),e=h.length,0===b.position.x&&0===b.position.y&&e&&"radioButton"===F(h[e-1],"target.tlType")?d=!1:b.target.position.relXY=c,e&&F(h[e-1],"target.id")===a?d&&(h[e-1].target.position.relXY=c):N(b,a),void(x=b))}function U(){var a=window.orientation||0;return a}function V(b){var d=U(),e={type:4,event:{type:"orientationchange"},target:{prevState:{orientation:c,orientationMode:a.utils.getOrientationMode(c)},currState:{orientation:d,orientationMode:a.utils.getOrientationMode(d)}}};K(e),c=d}function W(a){var b=!1;return a?b=d.scale===a.scale&&Math.abs((new Date).getTime()-d.timestamp)<500:b}function X(a){d.scale=a.scale,d.rotation=a.rotation,d.timestamp=(new Date).getTime()}function Y(a){var b,c="INVALID";return"undefined"==typeof a||null===a?c:(b=Number(a),c=isNaN(b)?"INVALID":b<1?"CLOSE":b>1?"OPEN":"NONE")}function Z(a){var b={},c=F(a,"nativeEvent.rotation")||0,e=F(a,"nativeEvent.scale")||1,f=null,g={type:4,event:{type:"touchend"},target:{id:F(a,"target.id"),idType:F(a,"target.idType")}};y&&(!e||1===e)||!y&&a.nativeEvent.touches.length<=1||(f={rotation:c?c.toFixed(2):0,scale:e?e.toFixed(2):1},f.pinch=Y(f.scale),W(f)||(d&&d.timestamp&&(b.rotation=d.rotation,b.scale=d.scale,b.pinch=Y(b.scale)),F(b,"scale")&&(g.target.prevState=b),g.target.currState=f,K(g),X(f)))}function $(b){var c={type:1,clientState:{pageWidth:document.width||(null===document.documentElement?0:document.documentElement.offsetWidth),pageHeight:Math.max("undefined"==typeof document.height?0:document.height,"undefined"==typeof document.documentElement?0:document.documentElement.offsetHeight,"undefined"==typeof document.documentElement?0:document.documentElement.scrollHeight),viewPortWidth:window.innerWidth||document.documentElement.clientWidth,viewPortHeight:window.innerHeight||document.documentElement.clientHeight,viewPortX:window.pageXOffset||(null===document.body?0:document.body.scrollLeft),viewPortY:window.pageYOffset||(null===document.body?0:document.body.scrollTop),deviceOrientation:window.orientation||0,event:F(b,"type")}},d=1,e=1;return d=90===Math.abs(c.clientState.deviceOrientation)?y?B-C:A<=320?B-C:B/z-C:y?A+C:A<=320?A-C:A/z-C,e=0===c.clientState.viewPortWidth?1:d/c.clientState.viewPortWidth,c.clientState.deviceScale=e-.02,c.clientState.deviceScale=c.clientState.deviceScale.toFixed(3),c.clientState.viewTime=null===r?0:(new Date).getTime()-r.getTime(),"scroll"===b.type&&i<=0&&(t=k.clientState.viewPortX,u=k.clientState.viewPortY),"scroll"===b.type&&(c.clientState.viewPortXStart=t,c.clientState.viewPortYStart=u),j=a.utils.clone(c),c}function _(){return null!==j&&"load"!==j.clientState.event&&("scroll"===j.clientState.event&&(delete j.clientState.viewPortXStart,delete j.clientState.viewPortYStart),j.clientState.event="attention",j.clientState.viewTime=null===s?0:(new Date).getTime()-s.getTime(),K(j),s=new Date,!0)}function aa(a){return"scroll"!==a.clientState.event||a.clientState.viewPortXStart!==a.clientState.viewPortX||a.clientState.viewPortYStart!==a.clientState.viewPortY}function ba(b){var c=null===v?0:(new Date).getTime()-v.getTime();return null!==j&&(b.type!==j.clientState.event||c>=1e3)?(aa(j)&&(K(j),"touchend"!==j.clientState.event&&(k=a.utils.clone(j))),j=null,r=null,i=0,!0):(null!==j&&1===i&&c>=1e3&&("resize"===j.clientState.event||"scroll"===j.clientState.event||"orientationchange"===j.clientState.event||"screenview_load"===b.type)&&_(),!1)}function ca(a,b){var e,f,c=["type","target.id"],d=null,g=!0,h=10,i=0,j=0,k=0;for(a&&b&&"object"==typeof a&&"object"==typeof b||(g=!1),e=0,f=c.length;g&&e<f;e+=1)if(d=c[e],F(a,d)!==F(b,d)){g=!1;break}return g&&(j=F(a,"timestamp"),k=F(b,"timestamp"),isNaN(j)&&isNaN(k)||(i=Math.abs(F(a,"timestamp")-F(b,"timestamp")),(isNaN(i)||i>h)&&(g=!1))),g}function da(){var a=window.location.hash;a!==f&&(f&&TLT.logScreenviewUnload(f),a&&TLT.logScreenviewLoad(a),f=a)}function ea(a){var b={type:4,event:{type:a.type},target:{id:F(a,"target.id"),idType:F(a,"target.idType")}};K(b)}var b={"input:radio":"radioButton","input:checkbox":"checkBox","input:text":"textBox","input:password":"textBox","input:file":"fileInput","input:button":"button","input:submit":"submitButton","input:reset":"resetButton","input:image":"image","input:color":"color","input:date":"date","input:datetime":"datetime","input:datetime-local":"datetime-local","input:number":"number","input:email":"email","input:tel":"tel","input:search":"search","input:url":"url","input:time":"time","input:week":"week","textarea:":"textBox","select:":"selectList","button:":"button","a:":"link"},c=window.orientation||0,d={scale:0,timestamp:0},e={},f=window.location.hash,g=null,h=[],i=0,j=null,k=null,l=0,q=((new Date).getTime(),null),r=null,s=null,t=0,u=0,v=null,w={inFocus:!1},x=null,y=navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iPod")>-1||navigator.userAgent.indexOf("iPad")>-1,z=window.devicePixelRatio||1,A=null===window.screen?0:window.screen.width,B=null===window.screen?0:window.screen.height,C=null===window.screen?0:window.screen.height-window.screen.availHeight;a.getConfig();return"function"!=typeof window.onerror&&(window.onerror=function(b,c,d){var e=null;"string"==typeof b&&(d=d||-1,e={type:6,exception:{description:b,url:c,line:d}},l+=1,a.post(e))}),{init:function(){},destroy:function(){P(g)},onevent:function(a){var b=null,c=null;if("object"==typeof a&&a.type){if(ca(a,q))return void(q=a);switch(q=a,b=F(a,"target.id"),"[object Object]"!==Object.prototype.toString.call(e[b])&&(e[b]={}),ba(a),Q(b,a),v=new Date,a.type){case"hashchange":da();break;case"focus":c=M(b,a);break;case"blur":c=P(b,a);break;case"click":c=T(b,a);break;case"change":c=R(b,a);break;case"orientationchange":c=V(a);break;case"touchend":c=Z(a),c=$(a);break;case"load":TLT.logScreenviewLoad("root"),c=$(a),s=new Date;break;case"screenview_load":s=new Date;break;case"resize":case"scroll":null===r&&i<=0&&(r=new Date),c=$(a),aa(c)?c=null:i+=1;break;case"unload":null!==h&&L(h),c=$(a),_(),K(c),TLT.logScreenviewUnload("root");break;default:ea(a)}return g=b,c}},onmessage:function(){}}}),function(){var a;TLT.init({services:{browser:{sizzleObject:"window.Sizzle"},queue:[{qid:"DEFAULT",endpoint:"/static/tealeafTarget2.html",maxEvents:25,timerinterval:0}],message:{privacy:[{targets:["input[name=secnum]","input[name=upwd]","input[name=upwd0]","input[name=aet_fon_0_phct]","input[name=aet_fon_1_phct]","input[name=aet_fon_2_phct]","input[name=aet_fon_1_phac]","input[name=aet_fon_2_phac]","input[name=aet_fon_0_phnm]","input[name=aet_fon_1_phnm]","input[name=aet_fon_2_phnm]","input[name=aet_fon_1_phex]","input[name=aet_wec_wnm_fnam_1]","input[name=aet_wec_phn_phct]","input[name=aet_wec_phn_phac]","input[name=aet_wec_phn_phnm]","input[name=trpr26_FWT_0_wnmSh]","input[name=trpr26_FWT_0_fon_0Sh]","input[name=trpr26_FWT_0_fon_1Sh]","input[name=trpr26_FWT_0_fon_2Sh]","input[name=trpr26_FWT_0_fon_0_phct]","input[name=trpr26_FWT_0_fon_0_phac]","input[name=trpr26_FWT_0_fon_0_phnm]","input[name=trpr26_FWT_0_fon_0_phex]","input[name=trpr26_FWT_0_wec_phn_phct]","input[name=trpr26_FWT_0_wec_phn_phac]","input[name=trpr26_FWT_0_wec_phn_phnm]","input[name=FOPIH_RgWebCC_0_cvmo]","input[name=FOPIH_RgWebCC_0_cvyr]","input[name=FOPIH_RgWebCC_0_ccin]","input[name=FOPIH_RgWebCC_0_IHFOPCommon_fpds]","input[name=tkdl26_IHftkt_IHihda_IHalda_adap]","input[name=tkdl26_IHftkt_IHihda_IHalda_adcn]","input[name=trpr26_HotTPref_0_htrvl_wtid]","input[name=trpr26_HotTPref_0_htrvl_wnmSh]","input[name=trpr26_HotTPref_0_htrvl_fon_0Sh]","input[name=trpr26_HotTPref_0_htrvl_fon_1Sh]","input[name=trpr26_HotTPref_0_htrvl_fon_2Sh]","input[name=trpr26_HotTPref_0_htrvl_fon_1_phct]","input[name=trpr26_HotTPref_0_htrvl_fon_1_phac]","input[name=trpr26_HotTPref_0_htrvl_fon_1_phnm]","input[name=trpr26_HotTPref_0_htrvl_fon_1_phex]","input[name=trpr26_HotTPref_0_htrvl_fon_0_phct]","input[name=trpr26_HotTPref_0_htrvl_fon_0_phac]","input[name=trpr26_HotTPref_0_htrvl_fon_0_phnm]","input[name=trpr26_WT_wtid]","input[name=trpr26_WT_wnmSh]","input[name=trpr26_WT_fon_0Sh]","input[name=trpr26_WT_fon_1Sh]","input[name=trpr26_WT_fon_2Sh]","input[name=trpr26_WT_fon_1_phct]","input[name=trpr26_WT_fon_1_phac]","input[name=trpr26_WT_fon_1_phnm]","input[name=trpr26_WT_fon_1_phex]","input[name=trpr26_WT_fon_0_phct]","input[name=trpr26_WT_fon_0_phac]","input[name=trpr26_WT_fon_0_phnm]","input[name=trpr27_FWT_0_wtid]","input[name=trpr27_FWT_0_wnmSh]","input[name=trpr27_FWT_0_fon_0Sh]","input[name=trpr27_FWT_0_fon_1Sh]","input[name=trpr27_FWT_0_fon_2Sh]","input[name=trpr27_FWT_fon_1_phct]","input[name=trpr27_FWT_fon_1_phac]","input[name=trpr27_FWT_fon_1_phnm]","input[name=trpr27_FWT_fon_1_phex]","input[name=trpr27_FWT_0_fon_0_phct]","input[name=trpr27_FWT_0_fon_0_phac]","input[name=trpr27_FWT_0_fon_0_phnm]","input[name=trpr27_FWT_0_wec_phnTxt]","input[name=trpr27_FWT_0_wec_phn_phct]","input[name=trpr27_FWT_0_wec_phn_phac]","input[name=trpr27_FWT_0_wec_phn_phnm]","input[name=trpr27_FWT_0_wec_phn_phex]","input[name=trpr28_HotTPref_0_htrvl_wtid]","input[name=trpr28_HotTPref_0_htrvl_wnmSh]","input[name=trpr28_HotTPref_0_htrvl_fon_0Sh]","input[name=trpr28_HotTPref_0_htrvl_fon_1Sh]","input[name=trpr28_HotTPref_0_htrvl_fon_2Sh]","input[name=trpr28_HotTPref_0_htrvl_fon_1_phct]","input[name=trpr28_HotTPref_0_htrvl_fon_1_phac]","input[name=trpr28_HotTPref_0_htrvl_fon_1_phnm]","input[name=trpr28_HotTPref_0_htrvl_fon_1_phex]","input[name=trpr28_HotTPref_0_htrvl_fon_0_phct]","input[name=trpr28_HotTPref_0_htrvl_fon_0_phac]","input[name=trpr28_HotTPref_0_htrvl_fon_0_phnm]","input[name=trpr29_WT_wtid]","input[name=trpr29_WT_wnmSh]","input[name=trpr29_WT_fon_0Sh]","input[name=trpr29_WT_fon_1Sh]","input[name=trpr29_WT_fon_2Sh]","input[name=trpr29_WT_fon_1_phct]","input[name=trpr29_WT_fon_1_phac]","input[name=trpr29_WT_fon_1_phnm]","input[name=trpr29_WT_fon_1_phex]","input[name=trpr29_WT_fon_0_phct]","input[name=trpr29_WT_fon_0_phac]","input[name=trpr29_WT_fon_0_phnm]","input[name=FOPIH_RgWebCC_1_ccty]","input[name=trpr26_KCTravPref_0_KWT_0_wtid]","input[name=inp_trpr26_KCTravPref_0_KWT_0_ttle]","input[name=trpr26_KCTravPref_0_KWT_0_wnmSh]","input[name=trpr26_KCTravPref_0_KWT_0_fon_0Sh]","input[name=trpr26_KCTravPref_0_KWT_0_fon_1Sh]","input[name=trpr26_KCTravPref_0_KWT_0_fon_2Sh]","input[name=trpr26_KCTravPref_0_KWT_0_fon_1_phct]","input[name=trpr26_KCTravPref_0_KWT_0_fon_1_phac]","input[name=trpr26_KCTravPref_0_KWT_0_fon_1_phnm]","input[name=trpr26_KCTravPref_0_KWT_0_fon_1_phex]","input[name=trpr26_KCTravPref_0_KWT_0_fon_0_phct]","input[name=trpr26_KCTravPref_0_KWT_0_fon_0_phac]","input[name=trpr26_KCTravPref_0_KWT_0_fon_0_phnm]","input[name=trpr26_KCTravPref_0_KWT_0_CCKTA_kbdy]","input[name=trpr26_KCTravPref_0_KWT_0_natl]","input[name=tkdl26_IHkdel_IHadel_rcnm]","input[name=tkdl26_IHkdel_IHadel_ads1]","input[name=tkdl26_IHkdel_IHadel_adap]","input[name=tkdl26_IHkdel_IHadel_adct]","input[name=tkdl26_IHkdel_IHadel_adst]","input[name=tkdl26_IHkdel_IHadel_adzp]","input[name=tkdl26_IHkdel_IHadel_adcn]","input[name=trpr26_TSPrimCom_wtid]","input[name=trpr26_TSPrimCom_wnmSh]","input[name=trpr26_TSPrimCom_fon_0Sh]","input[name=trpr26_TSPrimCom_fon_1Sh]","input[name=trpr26_TSPrimCom_fon_0Sh]","input[name=trpr26_TSPrimCom_fon_1_phct]","input[name=trpr26_TSPrimCom_fon_1_phac]","input[name=trpr26_TSPrimCom_fon_1_phnm]","input[name=trpr26_TSPrimCom_fon_1_phex]","input[name=trpr26_TSPrimCom_fon_0_phct]","input[name=trpr26_TSPrimCom_fon_0_phac]","input[name=trpr26_TSPrimCom_fon_0_phnm]","input[name=ccty]","input[name=ccnu]","input[name=ccmo]","input[name=ccyr]","input[name=cfnm]","input[name=clnm]","input[name=adcm1]","input[name=ads11]","input[name=ads21]","input[name=adap1]","input[name=adct1]","input[name=adst1]","input[name=adzp1]","input[name=adcn1]","input[name=phct1]","input[name=phac1]","input[name=phnm1]","input[name=phex1]","input[name=pasc]","input[name=pas1]","input[name=pas2]","input[name=usremal]","input[name=CardHolder_creditcardCVC]","input[name=new_card_security_code]","input[name=password]","input[name=oldPassword]","input[name=newPassword]","input[name=confirmPassword]","input[name=repeat_password]","input[name=solo_issue_number]","input[name=loginWidget_inpUserPwd]","input[name=stored_card_security_code]","input[name=loginPassword]","input[name=trpr26_FWT_0_PP_pnum]","input[name=trpr26_FWT_1_PP_pnum]","input[name=trpr26_FWT_2_PP_pnum]","input[name=trpr26_FWT_3_PP_pnum]","input[name=trpr26_FWT_4_PP_pnum]","input[name=trpr26_FWT_5_PP_pnum]","input[name=trpr26_FWT_6_PP_pnum]","input[name=trpr27_FWT_0_PP_pnum]","input[name=trpr27_FWT_1_PP_pnum]","input[name=trpr27_FWT_2_PP_pnum]","input[name=trpr27_FWT_3_PP_pnum]","input[name=trpr27_FWT_4_PP_pnum]","input[name=trpr27_FWT_5_PP_pnum]","input[name=trpr27_FWT_6_PP_pnum]","input[name=trpr28_FWT_0_PP_pnum]","input[name=trpr28_FWT_1_PP_pnum]","input[name=trpr28_FWT_2_PP_pnum]","input[name=trpr28_FWT_3_PP_pnum]","input[name=trpr28_FWT_4_PP_pnum]","input[name=trpr28_FWT_5_PP_pnum]","input[name=trpr28_FWT_6_PP_pnum]","input[name=trpr29_FWT_0_PP_pnum]","input[name=trpr29_FWT_1_PP_pnum]","input[name=trpr29_FWT_2_PP_pnum]","input[name=trpr29_FWT_3_PP_pnum]","input[name=trpr29_FWT_4_PP_pnum]","input[name=trpr29_FWT_5_PP_pnum]","input[name=trpr29_FWT_6_PP_pnum]","input[name=SOCSECNUMBER]","input[name=change_pwd]","input[name=pwd]","input[name=ucPayment_txtCCV2Number]","input[name=ucPassenger_txtPhoneNumberP1]","input[name=ucPayment_txtPhoneNumber]","input[name=stored_credit_card]","input[name=cvv]","input[name=creditCards\\[0\\]\\.new_card_security_code]","input[name=creditCards\\[1\\]\\.new_card_security_code]","input[name=creditCards\\[0\\]\\.card_number]","input[name=creditCards\\[1\\]\\.card_number]","input[name=phone]","input[name=storedCreditCardId]","input[name=TripPreferencesWidget_inpTravellerPreferredPhoneNumber]","input[name=card_select]","input[name=ccnum]","input[name=FOPIH_RgWebCC_0_ccnu]","input[name=FOPIH_RgWebELV_0_elva]","input[name=FOPIH_RgWebELV_0_elvb]","input[name=CardHolder_creditcardnumber]","input[name=FOPIH_RgWebCC_1_ccnu]","input[name=FOPIH_RgWebELV_1_elva]","input[name=FOPIH_RgWebELV_1_elvb]","input[name=card_number]","input[name=elv_account_number]","input[name=elv_bank_code_number]","input[name=ucPayment_txtCCNumber]","input[name=cc_num]","input[name=CREDITCARD]","input[name=creditCardNumber]","input[name=cardSecurityCode]","input[name=login\\.password]","input[name=ucPayment\\$txtCCV2Number]","input[name=ucPayment2\\$txtCCV2Number]","input[name=ucPassenger\\$txtPhoneNumberP1]","input[name=ucPayment\\$txtPhoneNumber]","input[name=ucPayment\\$txtCCNumber]","input[name=ucPayment2\\$txtCCNumber]","input[name=options\\.creditCard\\.cardNumber]","input[name=options\\.creditCard\\.newCardSecurityCode]","input[name=options\\.creditCard\\.storedSecurityCode]","input[name=signin-password]","input[name=create-account-password]","input[name=create-account-confirm-password]","input[name=cpf]","input[name=taxID_new]","input[name=taxID_stored]","input[name=retypePassword]","input[name=createPassword]","input[name=userPassword]","input[name=authenticationData\\.password]","input[name=signin-password]","input[name=userPassword]","input[name=createPassword]","input[name=retypePassword]","input[name=options\\.elv\\.ibanNumber]","input[name=giftCardNumber]","input[name=giftCardPinCode]","input[name=payments\\.submittedPayments\\[0\\]\\.billingDetailsForm\\.customerTaxPayerId]","input[name=paymentData\\.InstallmentPayment\\.TaxId]","input[name=paymentData\\.PaymentInfo\\.InstallmentPayment\\.TaxId]","input[name=newpwd1]","input[name=newpwd2]","input[name=changepassword]","input[name=newPassword]","input[name=ConfirmNewPassword]","input[name=passportNumber]","input[name=creditCards\\[0\\]\\.new_card_security_code]","input[name=creditCards\\[0\\]\\.stored_card_security_code]","input[name=creditCards\\[0\\]\\.storedCreditCardPaymentInstrumentId]","input[name=storedCreditCardPaymentInstrumentId]","input[name=payments\\.submittedPayments\\[0\\]\\.storedPayment\\.spsId]","input[name=paymentData\\.PaymentInfo\\.CreditCardPayment\\.CCV]","input[name=paymentData\\.Payment\\.CCV]","input[name=paymentData\\.PaymentInfo\\.SavedCard]"],maskType:3}]},serializer:{json:{defaultToBuiltin:!0,parsers:[],stringifiers:[]}}},core:{modules:{performance:{enabled:!0,events:[{name:"load",target:window},{name:"unload",target:window}]},replay:{enabled:!0,events:[{name:"load",target:window},{name:"unload",target:window},{name:"click",recurseFrames:!0},{name:"focus",target:"input, select, textarea",recurseFrames:!0},{name:"blur",target:"input, select, textarea",recurseFrames:!0},{name:"change",target:a,recurseFrames:!0},{name:"resize",target:window},{name:"scroll",target:window},{name:"hashchange",target:window},{name:"orientationchange",target:window},{name:"touchend"}]}},framesBlacklist:[".tl_block"],sessionData:{sessionCookieName:"TLTSID"}},modules:{performance:{calculateRenderTime:!0,filter:{navigationStart:!0,unloadEventStart:!0,unloadEventEnd:!0,redirectStart:!0,redirectEnd:!0,fetchStart:!0,domainLookupStart:!0,domainLookupEnd:!0,connectStart:!0,connectEnd:!0,secureConnectionStart:!0,requestStart:!0,responseStart:!0,responseEnd:!0,domLoading:!0,domInteractive:!0,domContentLoadedEventStart:!0,domContentLoadedEventEnd:!0,domComplete:!0,loadEventStart:!0,loadEventEnd:!0}}}},collectComments)}(),UDOAjaxUtils.registerUDOListener(tealiumUdoListener),require(["jquery","applicationViewLogging"],function(a,b){"use strict";function c(){var c,d,e;d=a("#frame-page-performance-model"),void 0!==d&&""!==d.text()&&(e=JSON.parse(d.text()),void 0!==e&&(c=b.buildPerfEventLogArray(e.entries),c.push("totalTime="+e.totalTime),c.push("staticPage=true"),dctk.logging.logTrxEvent("framePagePerformanceMetrics",c)))}c()}),define("basicEconomyView",["jquery","handlebars","backbone"],function(a,b,c){"use strict";function d(a,b,c){c.render(a,b),f(a,b)}function e(a){return a.length>1?"Mixed":a[0].airlineCode}function f(a,b){var c,d;d=a.find(".t-select-btn"),c=e(b),d.attr("data-omniture-rfrr",d.attr("data-omniture-rfrr")+".BasicEconomy."+c)}return c.View.extend({template:b.templates.basicEconomy,initialize:function(a){var b=this;d(a.$basicEconomyElement,a.rules,b)},render:function(a,b){var c,d={airlineShortName:b[0].airlineName,omnitureSuffix:e(b),rules:b[0].ruleLocIds};c=this.template(d),a.append(c),a.removeClass("hide"),a.parent().removeClass("hide")}})});